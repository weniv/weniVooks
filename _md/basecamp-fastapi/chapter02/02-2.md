---
chapter: FastAPI로 기본 API 만들기
title: 요청 본문(Request Body) 처리
date: 2024-09-20
---

# 1. Thunder Client

Thunder Client는 VSCode의 익스텐션으로, API 테스트를 쉽게 할 수 있도록 도와줍니다. Thunder Client를 사용하면 브라우저를 열고 URL을 입력하지 않더라도, .html 파일을 생성하지 않고도 아래와 같이 GET과 POST 등에 API 테스트를 할 수 있습니다.

::img{src='/images/basecamp-django/chapter05/05-1.png'}

설치는 VSCode의 익스텐션 탭에서 Thunder Client를 검색하여 설치하면 됩니다. 설치가 완료되면 왼쪽 사이드바에 번개모양 아이콘이 생깁니다.

# 2. POST 요청 처리하기

POST 요청은 서버에 새로운 데이터를 생성하거나 기존 데이터를 수정할 때 주로 사용됩니다. FastAPI에서 POST 요청을 처리하는 방법을 살펴보겠습니다.

```python
from fastapi import FastAPI

app = FastAPI()


@app.post("/items")
async def create_item(item: dict):
    return {"item": item}
```

이 코드는 `/items` 경로로 들어오는 POST 요청을 처리합니다. `item`은 요청 본문의 JSON 데이터를 파이썬 딕셔너리로 변환한 것입니다.

Thunder Client를 사용하여 POST 요청을 보내보겠습니다. Thunder Client클릭한 다음 New Request를 클릭하고 POST에 `127.0.0.1:8000/items`를 입력하고, Body 탭에서 JSON을 선택하고 다음과 같이 입력하세요.

```json
{
    "name": "item1",
    "price": 100
}
```

다음과 같이 응답이 왔다면 정상입니다.

```json
{
  "item": {
    "name": "item1",
    "price": 100
  }
}
```

실제로 구동이 되었는지 확인해보기 위해 price에 100을 더해주는 코드를 추가해보겠습니다.

```python
from fastapi import FastAPI

app = FastAPI()


@app.post("/items")
async def create_item(item: dict):
    item["price"] += 100
    return {"item": item}
```

다시 Thunder Client에서 동일한 POST 요청을 보내보면, price가 100이 더해진 것을 확인할 수 있습니다.

# 3. Pydantic 모델을 사용한 데이터 검증

Pydantic은 FastAPI와 함께 사용되는 데이터 검증 라이브러리입니다. Pydantic 모델을 사용하면 입력 데이터의 구조와 타입을 명확히 정의하고 자동으로 검증할 수 있습니다.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    price: float
    is_offer: bool = None

@app.post("/items")
async def create_item(item: Item):
    return {"item": item}
```

이 예제에서 `Item` 클래스는 Pydantic 모델입니다. `name`과 `price`는 필수 필드이며, `is_offer`는 선택적 필드입니다. `is_offer`는 선택적 필드로 설정하기 위해 기본값을 `None`으로 설정했습니다. 이번에는 Thunder Client를 사용하여 POST 요청을 보낼 때 price에 문자열을 입력해보겠습니다.

```json
{
    "name": "item1",
    "price": "100"
}
```

이 경우 FastAPI는 요청을 거부하고 다음과 같은 에러 메시지를 반환합니다.

# 4. 요청 본문과 경로 매개변수

요청 본문과 경로 매개변수를 함께 사용할 수 있습니다. 이는 특정 리소스에 대한 정보를 업데이트할 때 유용합니다.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()


class Item(BaseModel):
    name: str
    price: float


@app.put("/items/{item_id}")
async def update_item(item_id: int, item: Item):
    return {"item_id": item_id, "item": item}
```

이 엔드포인트는 URL에서 `item_id`를 받고, 요청 본문에서 `Item` 객체를 받습니다. Thunder Client를 사용하여 PUT 요청을 보내보겠습니다. URL에 `127.0.0.1:8000/items/1`을 입력하고, Body 탭에서 JSON을 선택하고 다음과 같이 입력하세요.

```json
{
    "name": "item1",
    "price": 100
}
```

# 5. 요청 본문의 중첩된 모델

Pydantic 모델은 중첩될 수 있어, 복잡한 데이터 구조도 쉽게 처리할 수 있습니다.

```python
from fastapi import FastAPI
from pydantic import BaseModel
from typing import List

app = FastAPI()


class ItemDetail(BaseModel):
    description: str
    weight: float


class Item(BaseModel):
    name: str
    price: float
    details: ItemDetail


@app.post("/items")
async def create_item(item: Item):
    return {"item": item}
```

이 예제에서 `Item` 모델은 `ItemDetail` 모델을 포함하고 있습니다. Thunder Client를 사용하여 POST 요청을 보내보겠습니다. URL에 `127.0.0.1:8000/items`을 입력하고, Body 탭에서 JSON을 선택하고 다음과 같이 입력하세요.

```json
{
    "name": "item1",
    "price": 100,
    "details": {
        "description": "This is an item",
        "weight": 10
    }
}
```

# 6. 명시적 선택 필드

Pydantic 모델에서 선택적 필드와 기본값을 정의할 수 있습니다.

```python
from fastapi import FastAPI
from pydantic import BaseModel
from typing import Optional

app = FastAPI()


class Item(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    tax: float = 10.5


@app.post("/items")
async def create_item(item: Item):
    return {"item": item}
```

여기서 `description`은 선택적 필드이고, `tax`는 기본값이 설정된 필드입니다. 앞서 살펴본 것처럼 None을 주어 선택적 필드를 설정할 수 있습니다만, `Optional`을 사용하여 선택적 필드를 명시적으로 표현하는 것을 권합니다. Thunder Client를 사용하여 POST 요청을 보내보겠습니다. URL에 `127.0.0.1:8000/items`을 입력하고, Body 탭에서 JSON을 선택하고 다음과 같이 입력하세요.

```json
{
    "name": "item1",
    "price": 100
}
```

이번에는 값을 모두 입력해보겠습니다.

```json
{
    "name": "item1",
    "description": "This is an item",
    "price": 100,
    "tax": 5.5
}
```

응답이 다른 것을 확인할 수 있습니다.

# 연습문제

1. 사용자 정보를 저장하는 POST 엔드포인트를 만들어보세요. 사용자 정보는 이름, 이메일, 나이를 포함해야 합니다. Pydantic 모델을 사용하여 데이터를 검증하세요.

2. 블로그 포스트를 생성하는 엔드포인트를 만들어보세요. 블로그 포스트는 제목, 내용, 작성자 정보(이름, 이메일)를 포함해야 합니다. 중첩된 Pydantic 모델을 사용하세요.
