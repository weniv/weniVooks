---
chapter: FastAPI로 기본 API 만들기
title: 쿼리 매개변수 처리
date: 2024-09-21
---

# 1. 쿼리 매개변수 소개

쿼리 매개변수는 URL의 '?' 뒤에 오는 키-값 쌍입니다. 예를 들어, `http://example.com/items?skip=0&limit=10`에서 `skip=0`과 `limit=10`이 쿼리 매개변수입니다. FastAPI에서는 이러한 쿼리 매개변수를 쉽게 처리할 수 있습니다.

# 2. 선택적 쿼리 매개변수

선택적 쿼리 매개변수는 사용자가 제공하지 않아도 되는 매개변수입니다. FastAPI에서는 이를 기본값을 설정하거나 `Optional`을 사용하여 구현할 수 있습니다.

```python
from fastapi import FastAPI
from typing import Optional

app = FastAPI()

@app.get("/items")
async def read_items(skip: int = 0, limit: int = 10):
    return {"skip": skip, "limit": limit}
```

이 예제에서 `skip`과 `limit`은 선택적 쿼리 매개변수입니다. 사용자가 값을 제공하지 않으면 기본값이 사용됩니다.

아래 URL을 통해 이 함수에 접근할 수 있습니다.

- `http://127.0.0.1:8000/items`: 기본값인 `skip=0`과 `limit=10`이 사용됩니다.
- `http://127.0.0.1:8000/items?skip=5`: `skip=5`와 기본값인 `limit=10`이 사용됩니다.
- `http://127.0.0.1:8000/items?skip=5&limit=20`: `skip=5`와 `limit=20`이 사용됩니다.

`skip`과 `limit`의 이름을 변경하거나 기본값을 변경 또는 타입힌트를 변경하여 어떤 값이 출력되는지 확인해보세요.

```python
from fastapi import FastAPI
from typing import Optional

app = FastAPI()


@app.get("/items")
async def read_items(hello: str = "world", limit: int = 10):
    return {"hello": hello, "limit": limit}
```

# 3. 필수 쿼리 매개변수

필수 쿼리 매개변수는 사용자가 반드시 제공해야 하는 매개변수입니다. FastAPI에서는 기본값을 설정하지 않음으로써 필수 매개변수를 정의할 수 있습니다.

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/items")
async def read_items(item_id: int):
    return {"item_id": item_id}
```

이 예제에서 `item_id`는 필수 쿼리 매개변수입니다. 사용자가 이 값을 제공하지 않으면 FastAPI는 자동으로 오류를 반환합니다.

아래 URL을 통해 이 함수에 접근할 수 있습니다.

- `http://127.0.0.1:8000/items?item_id=5`: `item_id=5`를 제공하면 `{"item_id": 5}`가 반환됩니다.
- `http://127.0.0.1:8000/items`: `item_id`를 제공하지 않으면 오류가 발생합니다.

# 4. 여러 쿼리 매개변수 사용하기

여러 개의 쿼리 매개변수를 동시에 사용할 수 있습니다. 선택적 매개변수와 필수 매개변수를 조합하여 사용할 수 있습니다.

```python
from fastapi import FastAPI
from typing import Optional

app = FastAPI()

@app.get("/items")
async def read_items(item_id: int, q: Optional[str] = None):
    results = {"item_id": item_id}
    if q:
        results.update({"q": q})
    return results
```

이 예제에서 `item_id`는 필수 매개변수이고, `q`는 선택적 매개변수입니다.

# 5. 타입 변환 및 검증

FastAPI는 쿼리 매개변수의 타입을 자동으로 변환하고 검증합니다. 예를 들어, `int`로 선언된 매개변수에 문자열이 입력되면 FastAPI는 자동으로 정수로 변환을 시도하고, 실패하면 오류를 반환합니다.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items")
async def read_items(item_id: int, price: float):
    return {"item_id": item_id, "price": price}
```

이 예제에서 `item_id`는 정수로, `price`는 부동소수점 숫자로 자동 변환됩니다. 추가적인 검증이 필요하다면 Pydantic 모델을 사용할 수 있습니다. 예를 들어, 숫자는 1부터 10까지만 입력이 가능하다고 가정하면 다음과 같이 작성할 수 있습니다.

```python
from fastapi import FastAPI, Query
from pydantic import BaseModel, Field

app = FastAPI()


class Item(BaseModel):
    item_id: int = Field(..., ge=1, le=10)
    price: float = Field(..., gt=0)


@app.get("/items")
async def read_items(
    item_id: int = Query(..., ge=1, le=10), price: float = Query(..., gt=0)
):
    item = Item(item_id=item_id, price=price)
    return {"item_id": item.item_id, "price": item.price}
```


# 6. 불리언 타입 쿼리 매개변수

불리언 타입의 쿼리 매개변수도 사용할 수 있습니다. FastAPI는 다양한 형태의 불리언 값을 인식합니다.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items")
async def read_items(item_id: int, is_available: bool = True):
    return {"item_id": item_id, "is_available": is_available}
```

이 엔드포인트는 `http://example.com/items?item_id=123&is_available=true` 또는 `http://example.com/items?item_id=123&is_available=1`과 같은 URL을 처리할 수 있습니다.

# 연습문제

1. 상품 검색 API를 만들어보세요. 이 API는 다음과 같은 쿼리 매개변수를 받아야 합니다.

   - `name` (선택): 상품 이름으로 검색 (문자열)
   - `min_price` (선택): 최소 가격 (숫자)
   - `max_price` (선택): 최대 가격 (숫자)
   - `available` (선택): 재고 여부 (불리언)

2. 사용자 목록을 반환하는 API를 만들어보세요. 이 API는 다음과 같은 쿼리 매개변수를 받아야 합니다.
   - `page` (선택): 페이지 번호 (정수, 기본값 1)
   - `size` (선택): 페이지당 사용자 수 (정수, 기본값 10)
   - `sort_by` (선택): 정렬 기준 ('name' 또는 'age', 기본값 'name')
