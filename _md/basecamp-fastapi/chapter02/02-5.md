---
chapter: FastAPI로 기본 API 만들기
title: 응답 모델 사용하기
date: 2024-09-22
---

# 1. 응답 모델 소개

응답 모델은 API가 반환하는 데이터의 구조를 정의합니다. FastAPI에서는 Pydantic 모델을 사용하여 응답 데이터의 형식을 명확히 지정할 수 있습니다. API 문서화 또한 자동으로 이루어집니다.

# 2. 기본 응답 모델 사용하기

응답 모델을 사용하려면 먼저 Pydantic 모델을 정의하고, 이를 엔드포인트의 `response_model` 매개변수에 지정합니다.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()


class Item(BaseModel):
    name: str
    price: float
    is_offer: bool = None


@app.get("/items/{item_id}", response_model=Item)
async def read_item(item_id: int):
    return {"name": "Foo", "price": 45.2, "is_offer": True}
```

이 예제에서 `Item` 모델은 응답의 구조를 정의합니다. FastAPI는 반환된 데이터를 이 모델에 맞게 검증하고 직렬화합니다. 직렬화란 파이썬 객체를 JSON 형식으로 변환하는 과정을 의미합니다. 만약 반환된 데이터가 모델과 일치하지 않는다면 FastAPI는 에러를 반환합니다. 예를 들어, 필수 필드인 `name`이 누락되었다면 FastAPI는 애러가 발생합니다.

# 3. 상태 코드 설정

FastAPI에서는 `status_code` 매개변수를 사용하여 응답의 HTTP 상태 코드를 설정할 수 있습니다.

```python
from fastapi import FastAPI, status
from pydantic import BaseModel

app = FastAPI()


class Item(BaseModel):
    name: str
    price: float


@app.post("/items", response_model=Item, status_code=status.HTTP_201_CREATED)
async def create_item(item: Item):
    return item
```

이 예제에서는 아이템 생성 시 201 Created 상태 코드를 반환합니다. 썬더 클라이언트로 아래 URL에 POST 요청을 보내보세요.

```
POST http://127.0.0.1:8000/items
Content-Type: application/json

{
    "name": "item1",
    "price": 100
}
```

아래 이미지처럼 201 Created 상태 코드를 확인할 수 있습니다.

::img{src="/images/basecamp-fastapi/chapter02/02-4-1.png"}

# 4. 응답 모델의 필드 제어

때로는 모델의 일부 필드만 응답에 포함시키고 싶을 수 있습니다. FastAPI는 이를 위한 몇 가지 옵션을 제공합니다.

## 4.1 응답에서 특정 필드 제외하기

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()


class Item(BaseModel):
    name: str
    price: float
    description: str = None
    tax: float = None


@app.get("/items/{item_id}", response_model=Item, response_model_exclude={"tax"})
async def read_item(item_id: int):
    return {
        "name": "Foo",
        "price": 45.2,
        "description": "This is an item",
        "tax": 3.2
    }
```

이 예제에서는 `tax` 필드가 응답에서 제외됩니다.

## 4.2 응답에 특정 필드만 포함하기

```python
@app.get("/items/{item_id}", response_model=Item, response_model_include={"name", "price"})
async def read_item(item_id: int):
    return {
        "name": "Foo",
        "price": 45.2,
        "description": "This is an item",
        "tax": 3.2
    }
```

이 예제에서는 `name`과 `price` 필드만 응답에 포함됩니다.

# 5. 여러 가지 응답 모델 사용하기

때로는 하나의 엔드포인트가 여러 가지 다른 응답을 반환해야 할 수 있습니다. 이런 경우 Union 타입을 사용할 수 있습니다.

```python
from fastapi import FastAPI
from pydantic import BaseModel
from typing import Union

app = FastAPI()

class Item(BaseModel):
    name: str
    price: float

class Message(BaseModel):
    message: str

@app.get("/items/{item_id}", response_model=Union[Item, Message])
async def read_item(item_id: int):
    if item_id == 1:
        return {"name": "Foo", "price": 45.2}
    else:
        return {"message": "Item not found"}
```

이 예제에서는 아이템이 존재하면 `Item` 모델을, 그렇지 않으면 `Message` 모델을 반환합니다.

# 연습문제

1. 사용자 정보를 반환하는 API를 만들어보세요. 응답 모델은 다음 필드를 포함해야 합니다: id, username, email. 그러나 실제 데이터베이스에는 password 필드도 있다고 가정하고, 이 필드는 응답에서 제외되어야 합니다.

2. 상품 목록을 반환하는 API를 만들어보세요. 각 상품은 id, name, price, stock을 가지고 있습니다. API는 두 가지 모드를 가집니다:
   - 기본 모드: id, name, price만 반환
   - 상세 모드: 모든 필드 반환
     쿼리 파라미터를 사용하여 모드를 선택할 수 있도록 구현해보세요.