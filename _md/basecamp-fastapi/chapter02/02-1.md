---
chapter: FastAPI로 기본 API 만들기
title: 첫 번째 API 엔드포인트 생성
date: 2024-09-19
---

# 1. 기본 라우팅 개념 소개

FastAPI에서 라우팅은 클라이언트의 요청을 적절한 함수(엔드포인트)로 연결하는 과정입니다. 쉽게말해 유저가 브라우저에 URL을 입력하면 적절한 함수가 실행되어 사용자가 원하는 정보를 볼 수 있게 하는 것입니다. 또는 유저가 ID, PW를 입력하여 로그인이 되게 할 수도 있습니다. 또는 화면이 아니라 데이터만 요청하여 받아볼 수도 있습니다.

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/")
def read_root():
    return {"Hello": "World"}
```

여기서 `@app.get("/")`는 데코레이터로, HTTP GET 요청이 루트 경로("/")로 왔을 때 아래의 함수를 실행하라는 의미입니다. 이 강의에서는 데커레이터와 같은 파이썬 기본 문법을 설명하지는 않습니다. 혹시 코드가 이해가 안된다면 파이썬 문법을 다시 공부하시는 것을 권합니다.

# 2. 요청 처리하기

FastAPI는 GET 요청을 비롯하여 POST, DELETE, PUT 등의 요청을 처리할 수 있습니다. 우선 FastAPI에서 GET 요청을 처리하는 방법을 살펴보겠습니다.

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/")
def read_root():
    return {"Hello": "World"}


@app.get("/about")
def about():
    return {"message": "about page"}


@app.get("/contact")
def contact():
    return {"message": "contact page"}


@app.get("/notice")
def notice():
    return {
        "notice": [
            {"title": "공지사항1", "content": "내용1"},
            {"title": "공지사항2", "content": "내용2"},
            {"title": "공지사항3", "content": "내용3"},
        ]
    }

```

이 코드를 `main.py` 파일에 저장하고 다음 명령어로 서버를 실행합니다.

```bash
uvicorn main:app --reload
```

브라우저에서 위에서 정의한 URL을 차례대로 접속합니다.

1. http://localhost:8000/
2. http://localhost:8000/about
3. http://localhost:8000/contact
4. http://localhost:8000/notice

각 URL에 접속하면 각각의 응답을 받게 됩니다. 이러한 응답을 Front-end 개발자가 받아서 화면을 구성할 수 있습니다.

또한 http://localhost:8000/docs 에 접속하면 FastAPI가 자동으로 생성한 API 문서를 확인할 수 있습니다. 이 문서는 Swagger를 사용하여 생성되며, API의 엔드포인트, 요청/응답 형식, 파라미터 등을 확인할 수 있습니다. 좀 더 상세한 기능을 제공하는 ReDoc 문서는 http://localhost:8000/redoc 에서 확인할 수 있으며 http://localhost:8000/openapi.json 에서 JSON 형식으로 확인할 수도 있습니다.

이 문서를 더 상세하게 작성하고 싶다면 아래와 같은 형식의 코드를 추가하면 됩니다.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/", tags=["Root"], summary="Root API", description="Hello World를 반환합니다.")
def read_root():
    return {"Hello": "World"}
```

이제 http://localhost:8000/docs 에 접속하면 위에서 작성한 설명이 문서에 추가된 것을 확인할 수 있습니다.

# 3. 요청에 다양한 방식으로 응답
## 3.1 HTML 응답하기

요청에 위와 같이 JSON 형태로 응답하는 것이 일반적입니다. 다만, 아래와 같이 HTML 형태로 응답할 수도 있습니다.

```python
from fastapi import FastAPI
from fastapi.responses import HTMLResponse

app = FastAPI()

@app.get("/", response_class=HTMLResponse)
def index():
    return '<h1>hello world 1</h1>'

@app.get("/about", response_class=HTMLResponse)
def about():
    return '<h1>hello world 2</h1>'

@app.get("/contact", response_class=HTMLResponse)
def contact():
    return '<h1>hello world 3</h1>'

@app.get("/notice", response_class=HTMLResponse)
def notice():
    return '<h1>hello world 4</h1>'
```

이번에도 순서대로 URL에 접속하여 응답을 확인해보세요.

1. `http://localhost:8000/`
2. `http://localhost:8000/about`
3. `http://localhost:8000/contact`
4. `http://localhost:8000/notice`

각 URL에 접속하면 아래와 같이 HTML 형태의 응답을 받게 됩니다.

::img{src="/images/basecamp-fastapi/chapter02/02-1.png"}

## 3.2 Template으로 응답하기
잘 사용되진 않지만 `.html` 파일을 사용하여 응답할 수도 있습니다. 템플릿으로 응답을 보내기 위해서는 `jinja2`가 필요합니다. Ctrl+C로 서버를 중지하고 다음 명령어로 `jinja2`를 설치합니다.

```bash
pip install jinja2
```

main.py 파일을 다음과 같이 수정합니다.

```python
from fastapi import FastAPI
from fastapi import Request
from fastapi.templating import Jinja2Templates


app = FastAPI(docs_url="/documentation", redoc_url=None)

templates = Jinja2Templates(directory="templates")


@app.get("/")
def index(request: Request):
    return templates.TemplateResponse("index.html", {"request": request})
```

여기서 설정한 파일을 만듭니다. 파일은 `01_3_basic > templates` 폴더에 저장합니다.

```html
<h1>hello world</h1>
<p>안녕</p>
```

다시 아래 명령어를 통해 서버를 실행합니다.

```bash
uvicorn main:app --reload
```

`127.0.0.1:8000`에 접속하면 html 파일이 렌더링된 화면을 확인할 수 있습니다. jinja2에 자세한 사용법은 이 강의의 범위를 벗어나므로 공식문서나 ChatGPT와 같은 LLM 참고하시기 바랍니다. FastAPI는 아키텍처가 단순하여 LLM을 사용하더라도 완성도 높은 코드를 작성할 수 있습니다.

설치한 `jinja2`는 템플릿을 사용하지 않을 경우 필요하지 않습니다. 앞으로 할 실습에서는 템플릿을 사용하지 않을 것이므로, `templates` 폴더와 `jinja2`를 삭제하셔도 됩니다. 남겨두셔도 문제는 되지 않습니다.


# 3. 경로 매개변수 사용하기

경로 매개변수를 사용하면 URL의 일부를 변수로 사용할 수 있습니다. 이를 통해 동적인 라우팅이 가능해집니다. `main.py` 파일을 다음과 같이 수정해보겠습니다.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```

이 예제에서 `{item_id}`는 경로 매개변수입니다. `item_id: int`는 이 매개변수가 정수형이어야 함을 명시합니다. 브라우저에서 `http://127.0.0.1:8000/items/5`에 접속하면 `{"item_id": 5}`라는 응답을 받게 됩니다.

여기서 타입힌트를 안쓰면 어떻게 될까요? 문자열로 반환합니다. 다만 FastAPI는 타입힌트를 통해 자동으로 데이터 검증을 수행합니다. 따라서 타입힌트를 사용하지 않으면 FastAPI가 경로 매개변수의 타입을 검증하지 않습니다. 따라서 올바른 타입으로 데이터를 받기 위해서, 검증을 위해서 타입힌트를 사용하는 것을 권합니다.

# 4. 여러 경로 매개변수 사용하기

여러 개의 경로 매개변수를 동시에 사용할 수도 있습니다.

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/{user_id}/items/{item_id}")
async def read_user_item(user_id: int, item_id: str):
    return {"user_id": user_id, "item_id": item_id}
```

이 엔드포인트는 `http://localhost:8000/users/1/items/foo`와 같은 URL에 응답하며, {"user_id": 1, "item_id": "foo"}를 반환합니다.

# 5. 연습문제

1. "hello/{name}" 경로에 대한 GET 요청을 처리하는 엔드포인트를 만들어보세요. 이 엔드포인트는 주어진 이름을 사용하여 인사말을 반환해야 합니다.

2. "/calculate/{operation}/{a}/{b}" 형식의 경로를 처리하는 엔드포인트를 만들어보세요. 여기서 operation은 "add", "subtract", "multiply", "divide" 중 하나이며, a와 b는 정수입니다. 해당 연산의 결과를 반환해야 합니다.