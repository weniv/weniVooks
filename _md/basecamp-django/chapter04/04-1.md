---
chapter: Form과 인증
title: django의 Form 시스템
date: 2024-08-06
---
폼은 웹 페이지에서 사용자로부터 정보를 수집하는 인터페이스입니다. 사용자로부터 데이터를 입력받아야 할 때마다 폼을 사용하며, 이는 로그인, 회원가입, 게시글 작성 등 다양한 상황에서 필요합니다. 폼을 사용하면 데이터 유효성 검사, 보안 강화, 코드 재사용성 증가 등 많은 이점을 얻을 수 있어 웹 개발에서 중요한 요소로 활용됩니다. 

# 1. 개발 환경 설정
아래 코드를 복사해서, 작업할 폴더의 터미널에 `shift + insert`합니다. 
```bash
mkdir db
cd db
python -m venv venv
.\venv\Scripts\activate
pip install django
pip install pillow
pip freeze > requirements.txt
django-admin startproject tutorialdjango .
python manage.py migrate
python manage.py startapp blog
```
`db` 폴더를 생성하고, 가상환경 설치, `django`,`pillow` 라이브러리 설치, blog앱 생성까지 완료되었습니다.
`pip freeze > requirements.txt`는 `requirements`파일을 만들어 줍니다.
`requirements`파일은 가상환경에 설치한 라이브러리와 그 버전을 모두 가지고 있습니다. 나중에 이 `requirements`파일로
다른 가상환경에 설치 할 수도 있습니다. 물론 버전도 같게요.

# 2. 프로젝트 구조 설정
## 2.1 settings.py 설정

`tutorialdjango/settings.py` 파일을 다음과 같이 수정합니다.

```python
ALLOWED_HOSTS = ["*"]

INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "blog",
]

STATIC_URL = "static/"
STATICFILES_DIRS = [BASE_DIR / "static"]

MEDIA_URL = "/media/"
MEDIA_ROOT = BASE_DIR / "media"
```

이 설정으로 정적 파일과 미디어 파일의 경로를 지정하고, `blog` 앱을 프로젝트에 등록합니다.

## 2.2 정적 파일 및 미디어 디렉토리 생성

```bash
mkdir static
mkdir media
```

# 3. URL 설정

## 3.1 프로젝트 URL 설정

`tutorialdjango/urls.py` 파일을 다음과 같이 수정합니다.

```python
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path("admin/", admin.site.urls),
    path("blog/", include("blog.urls")),
]

urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

## 3.2 앱 URL 설정

`blog/urls.py` 파일을 생성하고 다음과 같이 작성합니다.

```python
from django.urls import path
from . import views

urlpatterns = [
    path("", views.blog_list, name="blog_list"),
    path("<int:pk>/", views.blog_detail, name="blog_detail"),
    path("create/", views.blog_create, name="blog_create"),
    path("<int:pk>/update/", views.blog_update, name="blog_update"),
    path("<int:pk>/delete/", views.blog_delete, name="blog_delete"),
]
```

# 4. 모델 정의

`blog/models.py` 파일에 다음과 같이 `Post` 모델을 정의합니다.

```python
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=100)
    contents = models.TextField()
    main_image = models.ImageField(upload_to="blog/%Y/%m/%d/", blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.title
```

모델을 정의한 후, 다음 명령어로 데이터베이스에 반영합니다.

```bash
python manage.py makemigrations
python manage.py migrate
```

# 5. 관리자 페이지 설정

`blog/admin.py` 파일에 다음 코드를 추가하여 관리자 페이지에서 `Post` 모델을 관리할 수 있게 합니다.

```python
from django.contrib import admin
from .models import Post

admin.site.register(Post)
```

관리자 계정을 생성합니다.

```bash
python manage.py createsuperuser
```

# 6. 폼 정의

`blog/forms.py` 파일을 생성하고 다음과 같이 `PostForm`을 정의합니다.

```python
from django import forms
from .models import Post

class PostForm(forms.ModelForm):
    title = forms.CharField(max_length=100)
    contents = forms.CharField(widget=forms.Textarea)

    class Meta:
        model = Post
        fields = ["title", "contents", "main_image"]
```

# 7. 뷰 구현

`blog/views.py` 파일에 다음과 같이 뷰를 구현합니다.

```python
from django.shortcuts import render, redirect, get_object_or_404
from django.db.models import Q
from .models import Post
from .forms import PostForm

def blog_list(request):
    if request.GET.get("q"):
        db = Post.objects.filter(
            Q(title__contains=request.GET.get("q"))
            | Q(contents__contains=request.GET.get("q"))
        ).distinct()
    else:
        db = Post.objects.all()
    context = {"object_list": db}
    return render(request, "blog/blog_list.html", context)

def blog_detail(request, pk):
    post = Post.objects.get(pk=pk)
    context = {"object": post}
    return render(request, "blog/blog_detail.html", context)

def blog_create(request):
    if request.method == "GET":
        form = PostForm()
        context = {"form": form}
        return render(request, "blog/blog_create.html", context)
    elif request.method == "POST":
        form = PostForm(request.POST, request.FILES)
        if form.is_valid():
            post = form.save()
            return redirect("blog_list")
        else:
            context = {
                "form": form,
                "error": "입력이 잘못되었습니다. 알맞은 형식으로 다시 입력해주세요!",
            }
            return render(request, "blog/blog_create.html", context)

def blog_update(request, pk):
    post = get_object_or_404(Post, pk=pk)
    if request.method == "POST":
        form = PostForm(request.POST, request.FILES, instance=post)
        if form.is_valid():
            form.save()
            return redirect("blog_detail", pk=post.pk)
    else:
        form = PostForm(instance=post)
        context = {"form": form, "pk": pk}
        return render(request, "blog/blog_update.html", context)

def blog_delete(request, pk):
    post = get_object_or_404(Post, pk=pk)
    post.delete()
    return redirect("blog_list")
```

# 8. 템플릿 작성

## 8.1 blog_list.html

```html
<h1>게시판</h1>
<form action="" method="get">
    <input type="search" name="q">
    <button type="submit">검색</button>
</form>
<ul>
    {% for post in object_list %}
    <li>
        <a href="{% url 'blog_detail' post.id %}">{{ post.title }}</a>
        <p>{{ post.contents }}</p>
    </li>
    {% endfor %}
</ul>
```

## 8.2 blog_detail.html

```html
<h1>게시판</h1>

<p>{{ object.title }}</p>
<p>{{ object.contents }}</p>
<p>{{ object.created_at }}</p>
<p>{{ object.updated_at }}</p>
<p>{{ object.id }}</p>
{% if object.main_image %}
<img src="{{ object.main_image.url }}" alt="">
{% endif %}

<form action="{% url 'blog_delete' object.id %}" method="post">
    {% csrf_token %}
    <button type="submit">삭제하기</button>
</form>
<a href="{% url 'blog_update' object.id %}">수정</a>

<a href="{% url 'blog_list' %}">뒤로가기</a>
```

## 8.3 blog_create.html

```html
<p style="color:red;">{{ error }}</p>
<form action="{% url 'blog_create' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form }}
    <button type="submit">저장</button>
</form>
```

## 8.4 blog_update.html

```html
<form action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form }}
    <button type="submit">저장</button>
</form>
```

# 9. 서버 실행

모든 설정이 완료되면 다음 명령어로 서버를 실행합니다.

```bash
python manage.py runserver
```

이제 `http://localhost:8000/blog/`에서 블로그 애플리케이션을 확인할 수 있습니다.