---
chapter: Model과 DataBase
title: Django ORM 실습
date: 2024-07-23
---
# 1. Django ORM QuerySet

Django의 ORM은 개발자가 데이터베이스를 쉽게 다룰 수 있게 해주는 도구입니다. SQL 대신 간단한 Python 코드를 사용하여 데이터를 저장하고, 불러오는 등 데이터베이스를 조작할 수 있습니다. ORM을 이용하면 개발 시간이 단축되고, 코드를 이해하고 관리하기가 더 쉬워집니다. 또한, 다양한 종류의 데이터베이스를 같은 방식으로 다룰 수 있어 매우 편리합니다. 주로 view에서 사용됩니다. 

# 2. 기본 Query

```python
# 모든 Post 객체 가져오기
all_posts = Post.objects.all()

# all_posts의 타입 확인
print(type(all_posts))  # <class 'django.db.models.query.QuerySet'>

# all_posts의 사용 가능한 메서드와 속성 확인
print(dir(all_posts))
```

`all()` 메서드는 모든 객체를 반환합니다. `type()`과 `dir()` 함수는 Python 내장 함수로, 객체의 타입과 사용 가능한 속성 및 메서드를 확인하는 데 사용됩니다.

# 3. Read 연산

```python
# 모든 Post 객체 가져오기
all_posts = Post.objects.all()

# ID의 역순으로 정렬 (최신 글이 위에 오도록)
latest_posts = Post.objects.all().order_by('-id')

# 특정 ID의 Post 객체 가져오기
specific_post = Post.objects.get(id=1)

# 조건에 맞는 Post 객체들 가져오기
filtered_posts = Post.objects.filter(title__contains='Django')
```

`get()`은 단일 객체를 반환하며, 결과가 없거나 여러 개일 경우 예외를 발생시킵니다. `filter()`는 조건에 맞는 모든 객체를 쿼리셋으로 반환합니다.
쿼리셋은 인덱싱과 슬라이싱이 가능하지만, 음수 인덱싱은 지원되지 않습니다.

## 3.1 주요 필터 조건

- `__eq`: 같음 (=)
- `__ne`: 같지 않음 (<>)
- `__lt`: 작음 (<)
- `__le`: 작거나 같음 (<=)
- `__gt`: 큼 (>)
- `__ge`: 크거나 같음 (>=)
- `__contains`: 포함

```python
# ID가 3보다 작은 Post 객체들
posts = Post.objects.filter(id__lt=3)

# 제목에 'Django'가 포함된 Post 객체들
django_posts = Post.objects.filter(title__contains='Django')

# 대소문자 상관없이 정확하게 일치하는 항목 찾기
User.objects.filter(username__iexact='john')
```

# 4. Create 연산

```python
# 새 Post 객체 생성 및 저장
new_post = Post.objects.create(title="새 글", content="내용")

# 또는
new_post = Post(title="새 글", content="내용")
new_post.save()
```

# 5. Delete 연산

```python
# 특정 Post 객체 삭제
post_to_delete = Post.objects.get(id=3)
post_to_delete.delete()

# 조건에 맞는 모든 Post 객체 삭제
Post.objects.filter(title__contains='임시').delete()
```
특정 객체를 하나씩 삭제할 수도 있고, 여러 객체를 한번에 삭제할 수도 있습니다.

# 6. Update 연산

```python
post_to_update = Post.objects.get(id=1)
post_to_update.title = "수정된 제목"
post_to_update.save()
```