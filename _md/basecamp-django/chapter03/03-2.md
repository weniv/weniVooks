---
chapter: Model과 DataBase
title: Django ORM 실습
date: 2024-07-23
---
Django ORM(Object-Relational Mapping)을 사용하면 데이터베이스 작업을 Python 코드로 수행할 수 있습니다.
이를 통해 SQL 쿼리를 직접 작성하지 않고도 데이터베이스를 조작할 수 있습니다.

# 1. Python Shell 실행

먼저, Django 프로젝트의 Python Shell을 실행합니다.

```bash
python manage.py shell
```

# 2. 모델 임포트

Shell에서 Post 모델을 임포트합니다.

```python
from blog.models import Post
```

# 3. 데이터 조회 (Read)

## 3.1 모든 게시물 조회
```python
Post.objects.all()
```

## 3.2 특정 게시물 조회
```python
Post.objects.get(id=1)
```

## 3.3 필터링
```python
Post.objects.filter(title__contains='django')
```

## 3.4 정렬
```python
Post.objects.all().order_by('-created_at')
```

# 4. 데이터 생성 (Create)

```python
new_post = Post.objects.create(title='새 게시물', content='ORM으로 생성된 게시물입니다.')
new_post.save()
```

# 5. 데이터 수정 (Update)

```python
post = Post.objects.get(id=1)
post.title = '수정된 제목'
post.save()
```

# 6. 데이터 삭제 (Delete)

```python
post = Post.objects.get(id=1)
post.delete()
```

# 7. 고급 쿼리

## 7.1 AND 조건
```python
Post.objects.filter(title__contains='django', content__contains='ORM')
```

## 7.2 조건
```python
from django.db.models import Q
Post.objects.filter(Q(title__contains='django') | Q(content__contains='ORM'))
```

## 7.3 개수 세기
```python
Post.objects.count()
```

## 7.4 특정 필드만 선택
```python
Post.objects.values('title', 'created_at')
```

## 7.5 중복 제거
```python
Post.objects.values('title').distinct()
```

## 7.6슬라이싱
```python
Post.objects.all()[:5]  # 처음 5개
```

# 8. 관계 쿼리 (ForeignKey가 있는 경우)

```python
# 특정 게시물의 모든 댓글 가져오기
post = Post.objects.get(id=1)
post.comment_set.all()

# 댓글이 있는 모든 게시물 가져오기
Post.objects.filter(comment__isnull=False).distinct()
```

# 9. 트랜잭션 사용

```python
from django.db import transaction

with transaction.atomic():
    # 여러 데이터베이스 작업 수행
    post1 = Post.objects.create(title='제목1', content='내용1')
    post2 = Post.objects.create(title='제목2', content='내용2')
    # 모든 작업이 성공적으로 완료되면 커밋, 그렇지 않으면 롤백
```