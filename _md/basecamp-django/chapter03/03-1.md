---
chapter: Model과 DataBase
title: 모델(Model) 실습
date: 2024-07-22
---
장고에서 **모델**(Model)은 **데이터베이스의 구조를 정의**하고 **데이터를 관리**하는 일을 합니다. 파이썬 클래스로 표현한 데이터베이스의 설계도라고 생각하면 좋습니다.
모델을 사용하면 복잡한 데이터베이스 작업을 쉽게 할 수 있습니다. 데이터를 저장하거나, 수정하는 등의 데이터베이스 작업을 SQL문법이 아닌 간단한 파이썬 코드로 할 수 있습니다. 모델 실습을 통해 우리는 데이터의 구조를 정의하고, 이를 데이터베이스와 연결하는 방법을 배우게 됩니다. 이제 모델을 직접 만들고 사용해 보면서, 장고에서 데이터를 어떻게 구조화하고 관리하는지 알아봅시다.

# 1. 개발 환경 설정
개발 환경 설정이 익숙해지셨다면, 아래 코드를 이용해서 단시간에 환경 설정을 마무리할 수 있습니다. 아래 코드를 복사해서, 작업할 폴더의 터미널에 `shift + insert`를 하면 자동으로 설치가 완료됩니다. 마지막 코드에서는 `enter`를 입력해 주어야 합니다.

```bash
mkdir db
cd db
python -m venv venv
.\venv\Scripts\activate
pip install django pillow
django-admin startproject tutorialdjango .
python manage.py migrate
python manage.py startapp main
python manage.py startapp blog
```
이 실습에서는 mysite 폴더 대신 `db` 폴더를 생성하고, `pillow` 라이브러리를 추가합니다. 
`pillow`는 이 실습에 포함되어 있는 이미지 데이터를 다루기 위해서 필요한 라이브러리입니다.
위 코드를 통해서 앱을 생성하는 것까지 완료할 수 있습니다.

# 2. 설정 파일 수정
`tutorialdjango/settings.py` 파일을 열고 `ALLOWED_HOSTS`, `INSTALLED_APPS`를 수정해줍니다.

```python
#tutorialdjango > settings.py
ALLOWED_HOSTS = ["*"]

INSTALLED_APPS = [
    ...
    "main",
    "blog",
]
```
# 3. URL 설정
```
'blog/'
'blog/<int:pk>/'
```
위와 같은 url 구조를 위해, 프로젝트 레벨과 앱 레벨의 urls.py 파일을 설정합니다.
1. `tutorialdjango/urls.py` 파일을 다음과 같이 수정합니다.
```python
#tutorialdjango > urls.py
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path("admin/", admin.site.urls),
    path("blog/", include("blog.urls")),
]
```
2. blog 앱에 blog/urls.py 파일을 생성하고 다음 내용을 추가합니다.
```python
# blog > urls.py
from django.urls import path
from . import views

urlpatterns = [
    path("", views.blog_list, name="blog_list"),
    path("<int:pk>/", views.blog_detail, name="blog_detail"),
]
```
# 4. View 설정
blog 앱의 views.py 파일에 View함수를 작성합니다.
```python
# blog > views.py
from django.shortcuts import render
def blog_list(request):
    return render(request, "blog/blog_list.html")
def blog_detail(request, pk):
    return render(request, "blog/blog_detail.html")
```
# 5. 템플릿 작성
1. `settings.py`의 `TEMPLATES`안에 있는 `DIRS`의 경로를 `[BASE_DIR / "templates"]` 로 수정해 줍니다.

```python
# tutorialdjango > settings.py

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [BASE_DIR / "templates"], #이 부분 입니다.
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]
```
2. `templates/blog/`폴더를 만들고, blog_list.html와 blog_detail.html파일을 생성합니다. 각 html파일에 아래 코드를 입력해주세요.
- 블로그 목록 페이지
```html
<!--templates > blog > blog_list.html -->
<h1>게시판</h1>
<ul>
    {% for post in object_list %}
        <li>
            <a href="{% url 'blog_detail' post.pk %}">{{ post.title }}</a>
        </li>
    {% endfor %}
</ul>
```

- 블로그 상세 페이지
```html
<!-- templates > blog > blog_detail.html -->
<h1>blog_detail</h1>
<h2>{{ object.title }}</h2>
<p>{{ object.content }}</p>
<p>{{ object.created_at }}</p>
<p>{{ object.updated_at }}</p>
<a href="{% url 'blog_list' %}">목록</a>
```
# 6. 모델 정의

`blog/models.py` 파일에 다음 내용을 추가합니다.

```python
# blog > models.py
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=100) #글의 제목 (최대 100자)
    content = models.TextField() #글의 내용
    created_at = models.DateTimeField(auto_now_add=True)#글 작성 시간 (자동으로 현재 시간 저장)
    updated_at = models.DateTimeField(auto_now=True)#글 수정 시간 (수정할 때마다 자동으로 갱신)
```
Django에서 모델(Model)은 데이터베이스의 구조를 Python 클래스로 표현한 것입니다. 
위의 class코드를 데이터베이스의 표로 바꿔보면, 아래와 같습니다.
| 필드 이름 | 데이터 타입 | 설명 |
|----------|------------|------|
| title | VARCHAR(100) | 글 제목 (최대 100자) |
| content | TEXT | 글 내용 |
| main_image | VARCHAR | 메인 이미지 파일 경로 (선택 사항) |
| created_at | DATETIME | 글 작성 시간 (자동으로 현재 시간 저장) |
| updated_at | DATETIME | 글 수정 시간 (수정 시 자동 갱신) |

이렇게 모델 클래스가 데이터베이스 테이블로 변환되어 데이터를 저장하고 관리하게 됩니다. 
모델은 우리가 저장하고 사용할 데이터의 형태를 결정하는 아주 중요한 기능입니다.

# 7. 데이터베이스 마이그레이션
모델을 생성했으므로 데이터베이스에 반영해야 합니다.
터미널에서 아래 명령어를 입력합니다. 가상환경이 활성화되어있는지 확인해주세요.
```bash
python manage.py makemigrations
python manage.py migrate
```
:::figure
::img{alt="" src="/images/basecamp-django/chapter03/01-1.png"}
::figcaption[Django 모델 마이그레이션 과정]
:::
Django에서 데이터베이스를 변경할 때는 `makemigrations`와 `migrate`라는 두 단계를 거칩니다.
`makemigrations`는 변경 계획을 세우는 단계입니다. 모델을 수정하면 Django가 이를 감지하고 변경 내용을 담은 Python 파일을 만듭니다.
이 파일은 앱 폴더 안의 'migrations' 폴더에 저장됩니다. 실제 데이터베이스는 아직 그대로입니다.
`migrate`는 이 계획을 실제로 실행하는 단계로, migrate를 실행하면 데이터베이스가 실제로 변경됩니다.

# 8. 관리자 페이지 설정
Django의 `admin 페이지`는 웹사이트의 데이터와 설정을 관리할 수 있는 내장 인터페이스입니다. 개발자와 관리자가 데이터베이스 내용을 쉽게 조작하고 웹사이트를 효율적으로 관리할 수 있게 해줍니다. 이런 admin 페이지를 사용하기 위해서는 슈퍼유저라는 관리자 계정이 필요합니다. `슈퍼유저(Superuser)`는 Django 프로젝트의 관리자 권한을 가진 특별한 사용자입니다. 슈퍼 유저는 관리자 페이지에 접근할 수 있으며, **데이터베이스의 모든 정보를 조회, 생성, 수정, 삭제할 수 있는 권한**을 갖습니다. 그러니, 우리는 수퍼유저 계정의 **보안에 각별히 주의**해야 하며, 프로젝트 관리자만이 이 계정 정보를 알고 있어야 합니다.

1. `blog/admin.py` 파일에 다음 내용을 추가해, admin페이지를 수정합니다. admin 페이지에서 Post 모델을 관리할 수 있도록 하는 것입니다.
```python
#blog > admin.py
from django.contrib import admin
from .models import Post

admin.site.register(Post)
```
2. 아래 명령어를 입력해 관리자 계정을 생성합니다.
```bash
python manage.py createsuperuser
```
`createsuperuser` 명령을 실행한 후
`사용자 이름(Username)`, `이메일 주소(Email address)`, `비밀번호(Password)`, `비밀번호 확인(Password(again))`을 입력합니다.
:::div{.callout}
비밀번호를 입력할 때 보안을 위해서 화면에 아무것도 표시되지 않습니다. 화면에 뜨지 않더라도 그냥 입력하시면 됩니다. 너무 간단한 비밀번호는 거부될 수 있습니다.
:::figure
::img{alt="" src="/images/basecamp-django/chapter03/01-2.png"}
::figcaption[관리자 계정 생성 예시]
:::

3. 서버를 실행한 후 admin 페이지에 접속해서 방금 생성한 `슈퍼유저 계정`을 이용해 로그인을 합니다.
4. admin 페이지에서 Add 버튼을 눌러 게시물을 3개 만들어주세요.
::img{alt="" width="1100" src="/images/basecamp-django/chapter03/01-4.png"}
::img{alt="" src="/images/basecamp-django/chapter03/01-5.png"}
5. 우리가 만든 게시글을 목록으로 볼 수 있습니다.
::img{alt="" src="/images/basecamp-django/chapter03/01-6.png"}

## 8.1 모델 수정
작성한 게시글 목록을 보면, **목록에 적혀있는 제목들이 우리가 작성한 제목이 아닙니다.** 
Django는 우리가 작성한 내용들 중에서 어떤 정보를 보여줘야 할지 모릅니다. 그래서 "Post object (1)", "Post object (2)"처럼 의미 없는 이름을 보여줍니다.
우리가 원하는 건 게시글의 제목을 보는 것입니다. 이때 우리는 `__str__`메서드를 사용할 수 있습니다.
```python
def __str__(self):
    return self.title
```
Django는 게시물 목록을 볼 때 `__str__`메서드를 소환해서, 게시물을 어떻게 보여줄지 결정합니다.
위 코드는 Django에게 게시글을 목록에 보여줄 때는 `title`을 사용하라고 설정하는 것입니다.
`self.title` 뿐만 아니라 단순 문자열이나, f-string 등을 사용해 반환하라고 시킬 수 있습니다.
아래는 수정한 models.py 파일입니다.
```python
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=100) #글의 제목 (최대 100자)
    content = models.TextField() #글의 내용
    created_at = models.DateTimeField(auto_now_add=True)#글 작성 시간 (자동으로 현재 시간 저장)
    updated_at = models.DateTimeField(auto_now=True)#글 수정 시간 (수정할 때마다 자동으로 갱신)

    def __str__(self):
        return self.title
```
models.py를 수정하면 아래 이미지처럼 원하는 데로 우리가 작성한 제목이 목록에 보입니다.
::img{alt="" src="/images/basecamp-django/chapter03/01-7.png"}

## 8.2 관리자 페이지 수정
관리자페이지는 사용자가 원하는 데로, 커스터마이징을 할 수 있습니다.
아래 코드로 admin.py 파일을 수정해 줍니다.
```python
# blog > admin.py
from django.contrib import admin
from .models import Post

class PostAdmin(admin.ModelAdmin):
    list_display = ["id", "title", "created_at", "updated_at"]

admin.site.register(Post, PostAdmin)
```
기존 게시글 목록에서는 제목만 볼 수 있었습니다. 하지만 위 코드로 수정하게 되면, 제목뿐만이 아니라, 게시물 번호, 작성날짜, 수정날짜를 목록에서 볼 수 있습니다.
각 코드에 대해서 간단히 설명하면,
1. `PostAdmin`이라는 커스텀 관리자 클래스를 정의합니다. `admin.ModelAdmin`을 상속받아 Django의 기본 관리 기능을 그대로 가져오면서, 우리가 원하는 기능을 더할 수 있습니다.
2. `admin.ModelAdmin`의 `list_display` 속성을 사용합니다. list_display 속성은 관리자 페이지에서 목록에 보여질 필드를 지정할 수 있습니다.
보여질 필드를 지정했기 때문에 이제 `id`, `title`, `created_at`, `updated_at`을 볼수 있습니다.
3. `admin.site.register(Post, PostAdmin)`는 django 관리자 사이트에 `Post`모델을 등록하고, 이 모델에 대한 설정을 `PostAdmin` 클래스로 사용하라고 지정하는 것입니다.

아래는 위의 과정을 간단하게 시각화 한 것입니다.
::img{alt="" src="/images/basecamp-django/chapter03/01-8.png"}
`admin.ModelAdmin(상속받은 기본 클래스)`과 `list_display(속성 커스텀 설정)`가 결합되어 `PostAdmin`을 만듭니다.
`admin.site.register`함수를 통해 `Post`모델과 `PostAdmin`클래스가 결합되어 admin페이지로 보내집니다.        
::img{alt="" src="/images/basecamp-django/chapter03/01-9.png"}
코드를 수정했을 때 보여지는 화면입니다. ID와 제목, 생성날짜와 수정날짜가 보이는 것을 확인할 수 있습니다.


# 9. 모델 사용하기
모델의 내용을 템플릿에서 보여줄 수 있게 View와 템플릿을 수정합니다.
- blog > view.py
```python
from django.shortcuts import render
from .models import Post #사용할 모델을 불러오는 코드입니다.


def blog_list(request):
    blogs = Post.objects.all()
    context = {
        "object_list": blogs,
    }
    return render(request, "blog/blog_list.html", context)

def blog_detail(request, pk):
    blogs = Post.objects.get(pk=pk)
    context = {
        "object": blogs,
    }
    return render(request, "blog/blog_detail.html", context)
```
- templates > blog > blog_list.html
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <h1>게시판</h1>
    <ul>
        {% for post in object_list %}
            <li>
                <a href="{% url 'blog_detail' post.pk %}">{{ post.title }}</a>
            </li>
        {% endfor %}
    </ul>
    <p>{% url 'blog_list' %}</p>
    <p>{% url 'blog_detail' 1 %}</p>
</body>
</html>
```
- templates > blog > blog_detail.html
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <title>blog_detail</title>
</head>
<body>
    <h1>blog_detail</h1>
    <h2>{{ object.title }}</h2>
    <p>{{ object.content }}</p>
    <p>{{ object.created_at }}</p>
    <p>{{ object.updated_at }}</p>
    <a href="{% url 'blog_list' %}">목록</a>
</body>
</html>
```
뷰 코드를 수정하면서 우리는 다음과 같은 새로운 코드를 보게 됩니다.
```python
blogs = Post.objects.all()
blogs = Post.objects.get(pk=pk)
```
이 코드는 장고에서 사용하는 ORM쿼리 입니다. ORM 쿼리에 대해서는 다음 장에서 알아보도록 하겠습니다.