---
chapter: Model과 DataBase
title: 모델(model) 실습
date: 2024-07-22
---
<!-- 모델 설명 추가 -->
# 1. 개발 환경 설정

개발 환경 설정이 익숙해지셨다면, 아래 코드를 이용해서 단시간에 환경 세팅을 마무리 할 수 있습니다.
아래 코드를 복사해서, 작업할 폴더의 터미널에 `shift + insert`를 하면 
자동으로 설치가 완료 됩니다. 마지막 코드에서는 `enter`를 눌러야합니다.

```bash
mkdir db
cd db
python -m venv venv
.\venv\Scripts\activate
pip install django pillow
django-admin startproject tutorialdjango .
python manage.py migrate
python manage.py startapp main
python manage.py startapp blog
```
이 실습에서는 mysite폴더 대신 `db` 폴더를 생성하고, `pillow` 라이브러리를 추가합니다. 
`pillow`는 이 실습에 포함되어 있는 이미지 데이터를 다루기 위해서 필요한 라이브러리 입니다.
위 코드를 통해서 앱을 생성하는 것까지 완료 할 수 있습니다.

# 2. 설정 파일 수정

`tutorialdjango/settings.py` 파일을 열고 `ALLOWED_HOSTS`, `INSTALLED_APPS`를 수정해줍니다.

```python
ALLOWED_HOSTS = ["*"]

INSTALLED_APPS = [
    ...
    "main",
    "blog",
]
```

# 3. URL 구조 설정

`tutorialdjango/urls.py` 파일을 다음과 같이 수정합니다.

```python
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path("admin/", admin.site.urls),
    path("blog/", include("blog.urls")),
]
```
# 4. 블로그 앱 설정

## 4.1 모델 정의

`blog/models.py` 파일에 다음 내용을 추가합니다.

```python
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=100) #글의 제목 (최대 100자)
    content = models.TextField() #글의 내용
    main_image = models.ImageField(upload_to='blog/', blank=True, null=True)#메인 이미지 (선택사항)
    created_at = models.DateTimeField(auto_now_add=True)#글 작성 시간 (자동으로 현재 시간 저장)
    updated_at = models.DateTimeField(auto_now=True)#글 수정 시간 (수정할 때마다 자동으로 갱신)

    def __str__(self):
        return self.title
```
Django에서 모델(Model)은 데이터베이스의 구조를 Python 클래스로 표현한 것입니다. 
<!-- models에서 model을 불러옵니다. 이미 정의되어 있는 것을 가져와서 쓴다고 생각하면 됩니다.
위 코드의 Feild는 모델 필드를 이야기 하며, 모델 필드는 데이터베이스에 저장할 정보의 종류를 정의합니다. 
테이블 형식 예시 이미지
자주 사용되는 model field로는 `ImageField`, `IntegerField`, `SlugField`, `TextField`, `URLField` 등이 있습니다. -->



## 4.2 URL 설정

`blog/urls.py` 파일을 생성하고 다음 내용을 추가합니다.

```python
from django.urls import path
from . import views

urlpatterns = [
    path("", views.blog_list, name="blog_list"),
    path("<int:pk>/", views.blog_detail, name="blog_detail"),
    path("create/<str:title>/", views.blog_create, name="blog_create"),
    path("delete/<int:pk>/", views.blog_delete, name="blog_delete"),
]
```

## 4.3 뷰 작성

`blog/views.py` 파일에 다음 내용을 추가합니다.

```python
from django.shortcuts import render, redirect
from .models import Post
from django.db.models import Q

def blog_list(request):
    if request.GET.get("q"):
        q = request.GET.get("q")
        blogs = Post.objects.filter(
            Q(title__icontains=q) | Q(content__icontains=q)
        ).distinct()
    else:
        blogs = Post.objects.all()
    context = {
        "object_list": blogs,
    }
    return render(request, "blog/blog_list.html", context)

def blog_detail(request, pk):
    blog = Post.objects.get(pk=pk)
    context = {"object": blog}
    return render(request, "blog/blog_detail.html", context)

def blog_create(request, title):
    content = f"hello world {title}"
    q = Post.objects.create(title=title, content=content)
    q.save()
    return redirect("blog_list")

def blog_delete(request, pk):
    q = Post.objects.get(pk=pk)
    q.delete()
    return redirect("blog_list")
```
blog_list 함수의 아래 코드는
```python
blogs = Post.objects.filter(
            Q(title__icontains=q) | Q(content__icontains=q)
        ).distinct()
```
장고의 ORM 쿼리를 나타냅니다. 자세한 사항은 3-2를 참고해 주세요.

# 5. 템플릿 작성

## 5.1 블로그 목록 페이지

`templates/blog/blog_list.html` 파일을 생성하고 다음 내용을 추가합니다.

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>블로그 목록</title>
</head>
<body>
    <h1>게시판</h1>
    <form action="" method="get">
        <input name="q" type="search">
        <button type="submit">검색</button>
    </form>
    <ul>
        {% for post in object_list %}
            <li>
                <a href="{% url 'blog_detail' post.pk %}">{{ post.title }}</a>
            </li>
        {% endfor %}
    </ul>
</body>
</html>
```

## 5.2 블로그 상세 페이지

`templates/blog/blog_detail.html` 파일을 생성하고 다음 내용을 추가합니다.

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <title>블로그 상세</title>
</head>
<body>
    <h1>블로그 상세</h1>
    <h2>{{ object.title }}</h2>
    <p>{{ object.content }}</p>
    <p>작성일: {{ object.created_at }}</p>
    <p>수정일: {{ object.updated_at }}</p>
    {% if object.main_image %}
        <img src="{{ object.main_image.url }}" alt="메인 이미지">
    {% endif %}
    <a href="{% url 'blog_list' %}">목록으로</a>
</body>
</html>
```

# 6. 데이터베이스 마이그레이션
::img{alt="" src="/images/basecamp-django/chapter03/01-1.png"}
모델을 생성했으므로 데이터베이스에 반영해야 합니다.
Django에서 데이터베이스를 변경할 때는 `makemigrations`와 `migrate`라는 두 단계를 거칩니다.
`makemigrations`는 변경 계획을 세우는 단계입니다. 모델을 수정하면 Django가 이를 감지하고 변경 내용을 담은 Python 파일을 만듭니다.
이 파일은 앱 폴더 안의 'migrations' 폴더에 저장됩니다. 실제 데이터베이스는 아직 그대로입니다.
`migrate`는 이 계획을 실제로 실행하는 단계로, 이때 데이터베이스가 실제로 변경됩니다.

```bash
python manage.py makemigrations
python manage.py migrate
```
# 7. 관리자 페이지 설정

`blog/admin.py` 파일에 다음 내용을 추가합니다.

```python
from django.contrib import admin
from .models import Post

class PostAdmin(admin.ModelAdmin):
    list_display = ["id", "title", "created_at", "updated_at"]

admin.site.register(Post, PostAdmin)
```

관리자 계정을 생성합니다.

```bash
python manage.py createsuperuser
```
`createsuperuser` 명령을 실행한 후
사용자 이름 (Username), 이메일 주소 (Email address), 비밀번호 (Password), 비밀번호 확인 (Password (again))
을 입력합니다.
:::div{.callout}
비밀번호를 입력할 때 보안을 위해서 화면에 아무것도 표시되지 않습니다. 화면에 뜨지 않더라도 그냥 입력하시면 됩니다.      
너무 간단한 비밀번호는 거부될 수 있습니다.
:::