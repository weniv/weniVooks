---
chapter: Model과 DataBase
title: 모델(model) 실습
date: 2024-07-22
---
장고에서 모델은 데이터베이스의 구조를 정의하고 데이터를 관리하는 핵심 요소입니다. 모델은 우리가 다루는 데이터의 형태를 파이썬 클래스로 표현한 것으로, 데이터베이스 테이블의 설계도라고 볼 수 있습니다. 모델을 사용하면 복잡한 데이터베이스 작업을 쉽게 할 수 있어요. 글을 저장하거나, 모든 글 목록을 가져오거나, 특정 글을 수정하는 등의 작업을 간단한 파이썬 코드로 할 수 있습니다. 모델 실습을 통해 우리는 데이터의 구조를 정의하고, 이를 데이터베이스와 연결하는 방법을 배우게 됩니다. 이제 실습을 통해 모델을 직접 만들고 사용해보면서, 장고에서 데이터를 어떻게 구조화하고 관리하는지 알아봅시다.

# 1. 개발 환경 설정

개발 환경 설정이 익숙해지셨다면, 아래 코드를 이용해서 단시간에 환경 세팅을 마무리 할 수 있습니다.
아래 코드를 복사해서, 작업할 폴더의 터미널에 `shift + insert`를 하면 
자동으로 설치가 완료 됩니다. 마지막 코드에서는 `enter`를 입력해주어야합니다.

```bash
mkdir db
cd db
python -m venv venv
.\venv\Scripts\activate
pip install django pillow
django-admin startproject tutorialdjango .
python manage.py migrate
python manage.py startapp main
python manage.py startapp blog
```
이 실습에서는 mysite폴더 대신 `db` 폴더를 생성하고, `pillow` 라이브러리를 추가합니다. 
`pillow`는 이 실습에 포함되어 있는 이미지 데이터를 다루기 위해서 필요한 라이브러리 입니다.
위 코드를 통해서 앱을 생성하는 것까지 완료 할 수 있습니다.

# 2. 설정 파일 수정

`tutorialdjango/settings.py` 파일을 열고 `ALLOWED_HOSTS`, `INSTALLED_APPS`를 수정해줍니다.

```python
#tutorialdjango > settings.py
ALLOWED_HOSTS = ["*"]

INSTALLED_APPS = [
    ...
    "main",
    "blog",
]
```
# 3. URL 설정
```
'blog/'
'blog/<int:pk>/'
```
위와 같은 url구조를 위해, 프로젝트 레벨과 앱 레벨의 urls.py 파일을 설정합니다.
1. `tutorialdjango/urls.py` 파일을 다음과 같이 수정합니다.
```python
#tutorialdjango > urls.py
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path("admin/", admin.site.urls),
    path("blog/", include("blog.urls")),
]
```
2. blog앱에 `blog/urls.py` 파일을 생성하고 다음 내용을 추가합니다.
```python
# blog > urls.py
from django.urls import path
from . import views

urlpatterns = [
    path("", views.blog_list, name="blog_list"),
    path("<int:pk>/", views.blog_detail, name="blog_detail"),
]
```
# 4. 뷰 설정
blog 앱의 views.py 파일에 뷰 함수를 작성합니다.
```python
# blog > views.py
from django.shortcuts import render
def blog_list(request):
    return render(request, "blog/blog_list.html")
def blog_detail(request, pk):
    return render(request, "blog/blog_detail.html")
```
# 5. 템플릿 작성
1. `settings.py`의 `TEMPLATES`안에 있는 `DIRS`의 경로를 `[BASE_DIR / "templates"]` 로 수정해 줍니다.

```python
# tutorialdjango > settings.py

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [BASE_DIR / "templates"], #이 부분 입니다.
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]
```
2. `templates/blog/`폴더를 만들고, blog_list.html와 blog_detail.html 파일을 생성합니다. 각 html파일에 아래 코드를 입력해주세요.
- 블로그 목록 페이지
```html
<!--templates > blog > blog_list.html -->
<h1>게시판</h1>
<ul>
    {% for post in object_list %}
        <li>
            <a href="{% url 'blog_detail' post.pk %}">{{ post.title }}</a>
        </li>
    {% endfor %}
</ul>
```

- 블로그 상세 페이지
```html
<!-- templates > blog > blog_detail.html -->
<h1>blog_detail</h1>
<h2>{{ object.title }}</h2>
<p>{{ object.content }}</p>
<p>{{ object.created_at }}</p>
<p>{{ object.updated_at }}</p>
<a href="{% url 'blog_list' %}">목록</a>
```
# 6. 모델 정의

`blog/models.py` 파일에 다음 내용을 추가합니다.

```python
# blog > models.py
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=100) #글의 제목 (최대 100자)
    content = models.TextField() #글의 내용
    main_image = models.ImageField(upload_to='blog/', blank=True, null=True)#메인 이미지 (선택사항)
    created_at = models.DateTimeField(auto_now_add=True)#글 작성 시간 (자동으로 현재 시간 저장)
    updated_at = models.DateTimeField(auto_now=True)#글 수정 시간 (수정할 때마다 자동으로 갱신)

    def __str__(self):
        return self.title
```
Django에서 모델(Model)은 데이터베이스의 구조를 Python 클래스로 표현한 것입니다. 
위의 class코드를 데이터베이스의 표로 바꿔보면, 아래와 같습니다.
| 필드 이름 | 데이터 타입 | 설명 |
|----------|------------|------|
| title | VARCHAR(100) | 글 제목 (최대 100자) |
| content | TEXT | 글 내용 |
| main_image | VARCHAR | 메인 이미지 파일 경로 (선택 사항) |
| created_at | DATETIME | 글 작성 시간 (자동으로 현재 시간 저장) |
| updated_at | DATETIME | 글 수정 시간 (수정 시 자동 갱신) |

이렇게 모델 클래스가 데이터베이스 테이블로 변환되어 데이터를 저장하고 관리하게 됩니다. 
모델은 우리가 저장하고 사용할 데이터의 형태를 결정하는 아주 중요한 기능입니다.

# 7. 데이터베이스 마이그레이션
모델을 생성했으므로 데이터베이스에 반영해야 합니다.
터미널에서 아래 명령어를 입력합니다. 가상환경이 활성화되어있는지 확인해주세요.
```bash
python manage.py makemigrations
python manage.py migrate
```
:::figure
::img{alt="" src="/images/basecamp-django/chapter03/01-1.png"}
::figcaption[Django 모델 마이그레이션 과정]
:::
Django에서 데이터베이스를 변경할 때는 `makemigrations`와 `migrate`라는 두 단계를 거칩니다.
`makemigrations`는 변경 계획을 세우는 단계입니다. 모델을 수정하면 Django가 이를 감지하고 변경 내용을 담은 Python 파일을 만듭니다.
이 파일은 앱 폴더 안의 'migrations' 폴더에 저장됩니다. 실제 데이터베이스는 아직 그대로입니다.
`migrate`는 이 계획을 실제로 실행하는 단계로, migrate를 실행하면 데이터베이스가 실제로 변경됩니다.

# 8. 관리자 페이지 설정
Django의 `admin 페이지`는 웹사이트의 데이터와 설정을 관리할 수 있는 내장 인터페이스입니다. 개발자와 관리자가 데이터베이스 내용을 쉽게 조작하고 웹사이트를 효율적으로 관리할 수 있게 해줍니다. 이런 admin 페이지를 사용하기 위해서는 슈퍼유저라는 관리자 계정이 필요합니다. `슈퍼유저(Superuser)`는 Django 프로젝트의 관리자 권한을 가진 특별한 사용자입니다. 슈퍼 유저는 관리자 페이지에 접근할 수 있으며, **데이터베이스의 모든 정보를 조회, 생성, 수정, 삭제할 수 있는 권한**을 갖습니다. 그러니, 우리는 수퍼유저 계정의 **보안에 각별히 주의**해야 하며, 프로젝트 관리자만이 이 계정 정보를 알고 있어야 합니다.
1. 아래 명령어를 입력해 관리자 계정을 생성합니다.
```bash
python manage.py createsuperuser
```
`createsuperuser` 명령을 실행한 후
`사용자 이름(Username)`, `이메일 주소(Email address)`, `비밀번호(Password)`, `비밀번호 확인(Password(again))`을 입력합니다.
:::div{.callout}
비밀번호를 입력할 때 보안을 위해서 화면에 아무것도 표시되지 않습니다. 화면에 뜨지 않더라도 그냥 입력하시면 됩니다. 너무 간단한 비밀번호는 거부될 수 있습니다.
::img{alt="" src="/images/basecamp-django/chapter03/01-2.png"}
:::
2. `blog/admin.py` 파일에 다음 내용을 추가해, admin페이지를 수정합니다. admin 페이지에서 Post 모델을 관리할 수 있도록 하는 것입니다.
```python
from django.contrib import admin
from .models import Post

class PostAdmin(admin.ModelAdmin):
    list_display = ["id", "title", "created_at", "updated_at"]

admin.site.register(Post, PostAdmin)
```
3. 서버를 실행한 후 admin 페이지에 접속해서 방금 생성한 슈퍼유저 계정을 이용해 로그인을 합니다.
::img{alt="" width="550" src="/images/basecamp-django/chapter03/01-3.png"}
<!-- admin 페이지 이미지 -->
4. admin 페이지에서 게시물을 3개 만들어주세요.
<!-- 게시글 추가 이미지 -->

# 9. 기능 추가

## 9.1 게시물 생성
urls.py와 views.py를 수정하여 게시물 생성 기능을 추가합니다.
```python
#blog > urls.py
path("create/<str:title>/", views.blog_create, name="blog_create"),
```
```python
#blog > views.py
def blog_create(request, title):
    contents = f"hello world {title}"
    Post.objects.create(title=title, content=contents)
    return redirect("blog_list")
```
## 9.2 게시물 삭제
urls.py와 views.py를 수정하여 게시물 삭제 기능을 추가합니다.
```python
# blog > urls.py
path("delete/<int:pk>/", views.blog_delete, name="blog_delete"),
```
```python
#blog > views.py
def blog_delete(request, pk):
    post = Post.objects.get(pk=pk)
    post.delete()
    return redirect("blog_list")
```
## 9.3 이미지 업로드
models.py에 이미지 필드를 추가하고, settings.py와 urls.py를 수정합니다.
```python
#blog > models.py
main_image = models.ImageField(upload_to='blog/', blank=True, null=True)
```
```python
#tutorialdjango > settings.py
MEDIA_URL = "/media/"
MEDIA_ROOT = BASE_DIR / "media"
```
```python
# tutorialdjango > urls.py
from django.conf import settings
from django.conf.urls.static import static
urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```
blog_detail.html에 이미지 표시 로직을 추가하고, blog_list.html에 검색 폼을 추가합니다.
```html
<!-- blog_detail.html -->
{% if object.main_image %}
    <img src="{{ object.main_image.url }}" alt="">
{% endif %}
```
```html
<!-- blog_list.html -->
<form action="" method="get">
    <input name="q" type="search">
    <button type="submit">검색</button>
</form>
```
## 9.4 검색 기능
views.py의 blog_list 함수에 검색 로직을 추가합니다.
```python
#blog > views.py
from django.db.models import Q
def blog_list(request):
    if request.GET.get("q"):
        q = request.GET.get("q")
        blogs = Post.objects.filter(
            Q(title__icontains=q) | Q(content__icontains=q)
        ).distinct()
    else:
        blogs = Post.objects.all()
    context = {"object_list": blogs}
    return render(request, "blog/blog_list.html", context)
```