---
chapter: Model과 DataBase
title: DB 모델 관계 실습
date: 2024-08-02
---
데이터베이스에서 **모델 관계**는 서로 다른 테이블 간의 연결을 의미하며, 이는 데이터의 구조와 의미를 정의하고 일관성을 유지하는 데 중요한 역할을 합니다. Django에서는 주로 `일대다(1:N)`, `다대다(N:M)`, `일대일(1:1)` 세 가지 유형의 관계를 다룹니다.       
`일대다(1:N)` 관계의 예로는 **학교와 학생의 관계**를 들 수 있습니다. 한 학교에는 여러 학생이 있지만 각 학생은 하나의 학교에만 속하는 것처럼, '일(1)' 쪽의 하나의 레코드가 '다(N)' 쪽의 여러 레코드와 연결될 수 있습니다. Django에서는 이를 `ForeignKey` 필드를 사용하여 구현합니다.     
`다대다(N:M)` 관계는 **학생과 수업의 관계**로 설명할 수 있습니다. 한 학생이 여러 수업을 들을 수 있고 한 수업에 여러 학생이 참여할 수 있듯이, 양쪽 모델의 인스턴스가 서로 여러 개의 인스턴스와 연결될 수 있습니다. Django에서는 이러한 관계를 `ManyToManyField`를 사용하여 구현합니다.       
마지막으로 `일대일(1:1)` 관계는 **사용자와 사용자 프로필의 관계**를 예로 들 수 있습니다. 각 사용자는 하나의 프로필만을 가지며 각 프로필은 하나의 사용자에만 속하는 것처럼, 한 모델의 각 인스턴스가 다른 모델의 인스턴스와 단 하나씩만 연결됩니다. Django에서는 이를 `OneToOneField`를 사용하여 구현합니다.      
이제 실습을 통해 이러한 각 관계 유형을 Django에서 어떻게 구현하고 활용하는지 자세히 알아보겠습니다.     

# 1. 개발 환경 설정
아래 코드를 복사해서, 작업할 폴더의 터미널에 `shift + insert`합니다. 
```bash
mkdir db
cd db
python -m venv venv
.\venv\Scripts\activate
pip install django
pip install pillow
django-admin startproject tutorialdjango .
python manage.py migrate
python manage.py startapp blog
```
`db` 폴더를 생성하고, 가상환경 설치, `django`,`pillow` 라이브러리 설치, blog앱 생성까지 완료되었습니다.

# 2. settings.py 수정
이제는 `settings.py`를 한번에 수정해 봅시다.
```python
#tutorialdjango > settings.py
ALLOWED_HOSTS = ['*']

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'blog',
]

LANGUAGE_CODE = "ko-kr"
TIME_ZONE = "Asia/Seoul"

STATIC_URL = "static/"
STATICFILES_DIRS = [
    BASE_DIR / "static",
]

MEDIA_ROOT = BASE_DIR / "media"
MEDIA_URL = "/media/"
```
`LANGUAGE_CODE`와 `TIME_ZONE` 설정은 한국어와 한국 시간대를 사용하도록 하는 것 입니다.
장고에서 static과 media를 사용할 수 있도록, 설정을 수정해 줍니다.
```bash
mkdir static
mkdir media
```
프로젝트 디렉토리에 media와 static 폴더도 생성해주세요.

# 3. model.py 수정
```python
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    head_image = models.ImageField(
        upload_to='blog/images/%Y/%m/%d/', blank=True)
    file_upload = models.FileField(
        upload_to='blog/files/%Y/%m/%d/', blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateField(auto_now=True)

    def __str__(self):
        return self.title
```
Post 모델은 블로그 게시물의 구조를 정의하며, 제목(title), 내용(content), 대표 이미지(head_image), 첨부 파일(file_upload), 생성 시간(created_at), 수정 시간(updated_at) 등의 필드를 포함합니다. 이때 대표 이미지와 첨부 파일은 각각 'blog/images/연/월/일/'과 'blog/files/연/월/일/' 형식의 폴더에 저장됩니다. 한 폴더 내에 너무 많은 파일들이 있으면, 특정 파일을 찾기 어려워지고 시스템 성능에도 악영향을 미칠 수 있습니다. 그것을 방지하기 위해 자세한 경로를 사용합니다.

# 4. 관리자 페이지 수정 및 슈퍼유저 생성
`blog/admin.py` 파일을 수정합니다.
```python
#blog > admin.py
from django.contrib import admin
from .models import Post

admin.site.register(Post)
```
`Post` 모델을 Django 관리자 페이지에 등록합니다. 이제 관리자 인터페이스에서 게시물을 쉽게 생성, 조회, 수정, 삭제할 수 있게 됩니다.
데이터베이스에 변경사항을 적용하고 슈퍼유저를 생성합니다.
```bash
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
```

# 5. url.py 수정
- tutorialdjango > urls.py
```python
#tutorialdjango > urls.py
from django.contrib import admin
from django.urls import path, include
from django.conf.urls.static import static
from django.conf import settings

urlpatterns = [
    path("admin/", admin.site.urls),
    path("blog/", include("blog.urls")),
]

urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```
- blog > urls.py
```python
#blog > urls.py
from django.urls import path
from . import views

urlpatterns = [
    path("", views.blog_list, name="blog_list"),
]
```

# 6. view.py 수정
- blog > view.py
```python
#blog > view.py
from django.shortcuts import render
from .models import Post

def blog_list(request):
    posts = Post.objects.all()
    return render(request, "blog/blog_list.html", {"posts": posts})
```
# 7. templates 수정
```
blog/
└── template/
    └── blog/
        └── blog_list.html
```
blog 앱 안에 `template` 파일을 만들어 주세요.
`template > blog > blog_list.html` 파일을 빈 상태로 만들어 주세요.
# 8. 서버 실행 및 테스트
```
python manage.py runserver
```
2. 관리자 페이지(`http://127.0.0.1:8000/admin/`)에 접속해서 블로그 포스트 3개를 만듭니다.

# 9. 모델 관계
## 9.1 개념 설명
::img{alt="" src="/images/basecamp-django/chapter03/04-1.png"}