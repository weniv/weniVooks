---
chapter: 3. SQL 7원칙
title: 7. SQL 7원칙 - Order by 자료 정렬하기
date: 2024-05-10
---

# 수업목표

- 데이터를 `order by`를 통해 정렬할 수 있습니다.

# 개요

5원칙의 `having`까지 완료가 되었다면 여러분들은 필요한 특정 조건의 데이터를 불러오고, 집계까지 완료한것입니다. 이제 마지막으로 데이터를 정렬해서 보기 좋게 구성해야하는데요. SQL에서 정렬을 하는 구문은 바로 `having` 입니다. 흔히 오름차순, 내림차순으로 순서대로 정렬하는 것을 담당하고 있는 `having`에 대해서 알아보겠습니다.

# 데이터를 정렬하는 order by


:::div{.callout}

**업무 1 : 주문 테이블에서 금액별로 정렬**

:::

:::div{.callout}

**업무 2 : 월별 평균 총주문금액을 구하고, 100만원 이하만 남긴 자료를 오름차순으로 정렬**

:::

:::div{.callout}

**업무 3 : 고객별 총주문금액 개수, 합, 평균을 구해줘, 건수가 1건인 자료를 남긴 뒤 내림차순으로 정렬**

:::

`order by` 절은 쿼리 결과를 특정 컬럼을 기준으로 정렬하는 데 사용됩니다. 정렬 순서는 오름차순(ASC, Ascending)이 기본값이며, 컬럼명만 입력하면 ASC를 입력하지 않아도 오름차순이 적용됩니다. 내림차순(DESC, Descending)으로도 정렬할 수 있습니다. 컬럼명 뒤에 DESC를 입력하면 적용이 됩니다. ORDER BY 절은 `select` 문의 가장 마지막에 위치합니다.

**구문:**

```sql
SELECT column1, column2, ...
FROM table_name
ORDER BY column1 공백 또는 ASC 또는 DESC, column2 공백 또는 ASC 또는 DESC], ...;
```

예시:

```sql
-- 총주문금액 오름차순으로 정렬
SELECT * FROM 주문 ORDER BY 총주문금액;

-- 총주문금액 내림차순으로 정렬
SELECT * FROM 주문 ORDER BY 총주문금액 DESC;

-- 총주문금액은 오름차순, 주문ID는 내림차순으로 정렬
SELECT * FROM 주문 ORDER BY 총주문금액, 주문ID DESC;
```

ORDER BY 절은 다음과 같은 특징을 가지고 있습니다.

1. **컬럼 순서 지정:** `order by` 절 뒤에 정렬 기준이 되는 컬럼을 순서대로 나열할 수 있습니다. 이때 각 컬럼마다 정렬 순서(공백(오름차순), ASC(오름차순) 또는 DESC(내림차순))를 지정할 수 있습니다.
2. **컬럼 별칭 사용:** `select` 절에서 지정한 컬럼 별칭을 ORDER BY 절에서 사용할 수 있습니다.
3. **컬럼 번호 사용:** `select` 절에 나열된 컬럼의 순서 번호를 ORDER BY 절에서 사용할 수 있습니다. 단, 이 방식은 가독성이 떨어지므로 권장되지 않습니다.
4. **NULL 값 정렬:** 오름차순 정렬 시 NULL 값은 가장 작은 값으로 취급되어 처음에 나타나고, 내림차순 정렬 시 NULL 값은 가장 큰 값으로 취급되어 마지막에 나타납니다.

**ORDER BY와 GROUP BY의 관계**

`order by` 절은 `group by` 절과 함께 사용될 수 있습니다. 이 경우 `group by` 절 뒤에 `order by` 절이 위치하며, 집계된 결과를 정렬하는 데 사용됩니다.

예시:

```sql
Select 주문연도, count(*) as 연도_시도별_갯수
from 주문
Group by 주문연도 
order by 연도_시도별_갯수 desc
```

위 쿼리는 부서별 평균 급여를 계산하고, 평균 급여가 높은 순서대로 결과를 정렬합니다.

`order by` 절은 쿼리 결과를 원하는 순서로 정렬함으로써 데이터 분석 및 보고서 작성에 유용하게 활용될 수 있습니다. 다양한 정렬 기준과 순서를 조합하여 필요에 맞게 데이터를 정렬할 수 있습니다.

`order by` 절을 마스터하면 SQL 7원칙을 모두 학습한 것입니다. 이제 업무정의부터 `from`, `select`, `where`, `group by`, `having`, `order by` 절을 적절히 활용하여 데이터를 조회, 필터링, 집계, 정렬할 수 있게 되었습니다. 실습을 통해 각 절의 사용법을 익히고, 다양한 쿼리를 작성해 보시기 바랍니다.

# 1) 원하는 자료를 기준으로 정렬하자


:::div{.callout}

**업무 1 : 주문 테이블에서 금액별로 정렬해보자**

:::


`order by`는 정렬을 하는 구문이므로 어느 테이블이든 사용할 수 있습니다. 모든 SQL 문법 중 가장 마지막에 위치하는게 원칙입니다. 

```sql
select *
from 주문
order by 컬럼명 # 기본 오름차순 내림차순을 쓰고 싶을때는 컬럼명 desc를 입력하면 됩니다.
```

실제로 총 주문금액을 넣어서 정렬을 해보겠습니다. 

```sql
select *
from 주문
order by 총주문금액
```

결과는 다음과 같습니다. 생각보다 간단하죠?

![Untitled](/images/basecamp-sql/chapter03-8/Untitled.png)

# 2) 평균 총주문금액을 내림차순으로 정렬하자

## 2.1 예상업무지침 부여

두번째 업무는 다음과 같았습니다.


:::div{.callout}

**업무 2 : 월별 평균 총주문금액을 구하고, 100만원 이하만 남겨주고, 내림차순으로 정렬해줘**

:::

## 2.2 머릿속으로 미리 결과를 예상해보기

내림차순의 경우 큰 숫자부터 정렬이 됩니다.

| 주문연도 | 주문월 | 총주문금액_평균 |
| --- | --- | --- |
| 2023 | 12 | 126400 |
| 2024 | 01 | 246720 |
| 2024 | 02 | 126540 |

| 주문연도 | 주문월 | 총주문금액_평균 |
| --- | --- | --- |
| 2024 | 01 | 246720 |
| 2024 | 02 | 126540 |
| 2023 | 12 | 126400 |

## 2.3 그림을 보고 어떻게 할지 정리하기

![[SQL]7원칙_Order by_1.7.png](/images/basecamp-sql/chapter03-8/Order_by_1.7.png)

## 2.4 코드로 구현해보기

`order by` 는 모든 구문에서 가장 마지막에 사용하면 됩니다. 

1. order by 구문 적용 (내림차순)

```sql
Select 주문연도, 주문월, avg(총주문금액) as 총주문금액_평균
from 주문
Group by 주문연도, 주문월 
having 총주문금액_평균 < 1000000 
order by 총주문금액_평균 desc
```

1. 오름차순인 경우

```sql
Select 주문연도, 주문월, avg(총주문금액) as 총주문금액_평균
from 주문
Group by 주문연도, 주문월 
having 총주문금액_평균 < 1000000 
order by 총주문금액_평균
```

## 2.5 결과 확인하기

![Untitled](/images/basecamp-sql/chapter03-8/Untitled2.png)

# 3) 건수도 내림차순으로 정렬하자

## 3.1 예상업무지침 부여

두번째 업무는 다음과 같습니다. 


:::div{.callout}

**업무 3 : 고객별 총주문금액 개수, 합, 평균을 구해줘, 건수가 1건은 제외해주고, 내림차순으로 정렬해줘
**

:::


## 3.2 머릿속으로 미리 결과를 예상해보기

지난번에 이미 정리된 결과를 얻었는데, 이를 내림차순으로 변경해보겠습니다.

| 시도 | 주문연도 | count(*) |
| --- | --- | --- |
| 강원 | 2024 | 2 |
| 경기 | 2024 | 2 |
| 경상 | 2024 | 3 |
| 세종 | 2024 | 3 |
| 제주 | 2024 | 4 |

## 3.3 그림을 보고 어떻게 할지 정리하기

![[SQL]7원칙_Order by_2.5.png](/images/basecamp-sql/chapter03-8/Order_by_2.5.png)

## 3.4 코드로 구현해보기

`order by` 를 맨 마지막에 입력한 뒤에 정렬을 원하는 컬럼명을 입력한 뒤 desc를 입력합니다.

```sql
Select substr(배송주소,1,2) as 시도, 주문연도, count(*) as 연도_시도별_갯수
from 주문
Group by 시도, 주문연도 
having 연도_시도별_갯수 <> 1 
order by 연도_시도별_갯수 desc
```

## 3.5 결과 확인하기

![Untitled](/images/basecamp-sql/chapter03-8/Untitled4.png)

# Summary

이로써 7원칙에 대한 내용을 마무리 했습니다. 사실 7원칙을 더 잘 다루기 위해서 코딩테스트나 다양한 데이터로 실습을 해보는 것이 중요합니다. 여러 내용의 실습을 진행해 볼 예정이니 잘 따라오시면 좋을것같고, 기초적인 SQL 코딩테스트에서는 7원칙으로도 충분하다는 것을 깨닫게 되실거에요. 감사합니다.