---
chapter: λ°μ΄ν„° κµ¬μ΅°
title: DataFrame(λ°μ΄ν„°ν”„λ μ„) μ‹¬ν™”
date: 2024-12-11
---

# 1. λ°μ΄ν„° κ²°ν•© λ° λ¶„ν•΄

## 1.1 λ°μ΄ν„° κ²°ν•©

### 1.1.1 equals

`equals` λ©”μ„λ“λ” λ°μ΄ν„°ν”„λ μ„μ΄ λ‹¤λ¥Έ λ°μ΄ν„°ν”„λ μ„κ³Ό κ°™μ€μ§€ λΉ„κµν•  μ μμµλ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ df1κ³Ό df2λ” λ‹¤λ¥Έ λ°μ΄ν„°ν”„λ μ„μΈ κ²ƒμ„ ν™•μΈν•μ‹¤ μ μμµλ‹λ‹¤.

```python
df1 = pl.DataFrame(
    {
        "foo": [1, 2, 3],
        "bar": [6.0, 7.0, 8.0],
        "ham": ["a", "b", "c"],
    }
)
df2 = pl.DataFrame(
    {
        "foo": [3, 2, 1],
        "bar": [8.0, 7.0, 6.0],
        "ham": ["c", "b", "a"],
    }
)

# λ°μ΄ν„°ν”„λ μ„1.equals(λ°μ΄ν„°ν”„λ μ„2)
print(df1.equals(df1))
print(df1.equals(df2))
```

```
True
False
```

df1κ³Ό κµ¬μ΅°, κ°’ λ¨λ‘ κ°™μ€ λ°μ΄ν„°ν”„λ μ„μ„ μƒμ„±ν•΄λ³΄κ³  λΉ„κµν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ dfμ™€ df1μ€ κ°™μ€ λ°μ΄ν„°ν”„λ μ„μ„ μ• μ μμµλ‹λ‹¤. μ΄μ²λΌ λ°μ΄ν„°ν”„λ μ„μ μ»¬λΌλ…κ³Ό, κµ¬μ΅°, λ°μ΄ν„° κ°’λ“¤μ΄ λ¨λ‘ κ°™μΌλ©΄ TrueλΌκ³  μ¶λ ¥λ©λ‹λ‹¤.

```python
df = pl.DataFrame(
    {
        "foo": [1, 2, 3],
        "bar": [6.0, 7.0, 8.0],
        "ham": ["a", "b", "c"],
    }
)
print(df.equals(df1))
```

```
True
```

`null_equal=True`(κΈ°λ³Έκ°’)μΌλ΅ μ„¤μ •ν•λ©΄ λ°μ΄ν„°ν”„λ μ„μ— λ„ κ°’μ΄ μλ” κ²½μ° λ™λ“±ν• λ°μ΄ν„°ν”„λ μ„ κ°’μΌλ΅ μΈμ‹ν•©λ‹λ‹¤.

```python
df1 = pl.DataFrame(
    {
        "foo": [1, 2, None],
        "bar": [6.0, 7.0, 8.0],
        "ham": ["a", "b", "c"],
    }
)

print(df1.equals(df1, null_equal=True))
print(df1.equals(df1, null_equal=False))
```

```
True
False
```

μ΄λ²μ—λ” νΉμ • μ»¬λΌμ κ°’μ΄ λ™μΌν•μ§€ ν™•μΈν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ df1μ bar μ»¬λΌμ κ°’κ³Ό df2μ bar μ»¬λΌμ κ°’μ€ λ™μΌν•κΈ° λ•λ¬Έμ— Trueλ΅ μ¶λ ¥λ κ²ƒμ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤.

```python
df2 = pl.DataFrame(
    {
        "foo": [3, 2, 1],
        "bar": [6.0, 7.0, 8.0],
        "ham": ["c", "b", "a"],
    }
)

print(df1['bar'].equals(df2['bar']))
```

```
True
```

### 1.1.2 hstack

`hstack` λ©”μ„λ“λ” μ—¬λ¬ κ°μ Seriesλ¥Ό μν‰μΌλ΅ μ“μ•„ ν™•μ¥λ μƒλ΅μ΄ λ°μ΄ν„°ν”„λ μ„μ„ λ°ν™ν•©λ‹λ‹¤. μ΄λ•, `in_place=True`λ΅ μ„¤μ •ν•μ‹λ©΄ λ°”λ΅ μ›λ³Έμ— λ°μλ©λ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ μ¤λ¥Έμ½μ— apple μ—΄μ΄ μ¶”κ°€λ κ²ƒμ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤.

```python
x = pl.Series("apple", [10, 20, 30])
print(df1.hstack([x]))
```

```
shape: (3, 4)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”† ham β”† apple β”‚
β”‚ --- β”† --- β”† --- β”† ---   β”‚
β”‚ i64 β”† f64 β”† str β”† i64   β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† 6.0 β”† a   β”† 10    β”‚
β”‚ 2   β”† 7.0 β”† b   β”† 20    β”‚
β”‚ 3   β”† 8.0 β”† c   β”† 30    β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”
```

### 1.1.3 vstack

`vstack` λ©”μ„λ“λ” λ°μ΄ν„°ν”„λ μ„μ— λ°μ΄ν„°λ¥Ό μμ§μΌλ΅ μ“μ•„μ„ λ°μ΄ν„°ν”„λ μ„μ„ λλ¦½λ‹λ‹¤. μ΄λ•, `in_place=True`λ΅ μ„¤μ •ν•μ‹λ©΄ λ°”λ΅ μ›λ³Έμ— λ°μλ©λ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ μ•„λμ½μΌλ΅ ν–‰μ κ°’μ΄ μ¶”κ°€λ κ²ƒμ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤.

```python
df2 = pl.DataFrame(
    {
        "foo": [3, 4],
        "bar": [8.0, 9.0],
        "ham": ["c", "d"],
    }
)
print(df1.vstack(df2))
```

```
shape: (5, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”† ham β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ i64 β”† f64 β”† str β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† 6.0 β”† a   β”‚
β”‚ 2   β”† 7.0 β”† b   β”‚
β”‚ 3   β”† 8.0 β”† c   β”‚
β”‚ 3   β”† 8.0 β”† c   β”‚
β”‚ 4   β”† 9.0 β”† d   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

### 1.1.4 extend

`extend` λ©”μ„λ“λ” vstackκ³Ό κ°™μ΄ λ°μ΄ν„°ν”„λ μ„μ΄ μ§€μ›ν•λ” λ©”λ¨λ¦¬λ¥Ό λ‹¤λ¥Έ λ°μ΄ν„°ν”„λ μ„μ κ°’μΌλ΅ μ„Έλ΅λ΅ ν™•μ¥ν•©λ‹λ‹¤.

```python
df1 = pl.DataFrame({"foo": [1, 2, 3], "bar": [4, 5, 6]})
df2 = pl.DataFrame({"foo": [10, 20, 30], "bar": [40, 50, 60]})
print(df1.extend(df2))
```

```python
shape: (6, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”‚
β”‚ --- β”† --- β”‚
β”‚ i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† 4   β”‚
β”‚ 2   β”† 5   β”‚
β”‚ 3   β”† 6   β”‚
β”‚ 10  β”† 40  β”‚
β”‚ 20  β”† 50  β”‚
β”‚ 30  β”† 60  β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

:::div{.callout}
`extend` λ©”μ„λ“λ” λ‹¤λ¥Έ λ°μ΄ν„°ν”„λ μ„μ μ²­ν¬λ¥Ό κΈ°μ΅΄ λ°μ΄ν„°ν”„λ μ„μ μ²­ν¬μ— μ¶”κ°€ν•λ” `vstack`κ³Ό λ‹¬λ¦¬, `extend`λ” λ‹¤λ¥Έ λ°μ΄ν„°ν”„λ μ„μ λ°μ΄ν„°λ¥Ό κΈ°λ³Έ λ©”λ¨λ¦¬ μ„μΉμ— μ¶”κ°€ν•λ―€λ΅ μ¬ν• λ‹Ήμ΄ λ°μƒν•  μ μμµλ‹λ‹¤. μ¬ν• λ‹Ήμ΄ λ°μƒν•μ§€ μ•μΌλ©΄ κ²°κ³Ό λ°μ΄ν„°ν”„λ μ„ κµ¬μ΅°μ— μ¶”κ°€ μ²­ν¬κ°€ μ—†μΌλ―€λ΅ μΏΌλ¦¬κ°€ λ” λΉ¨λΌμ§‘λ‹λ‹¤.

- ν• λ² μ¶”κ°€ν• ν›„ μΏΌλ¦¬λ¥Ό μν–‰ν•λ ¤λ” κ²½μ° `vstack`λ³΄λ‹¤ `extend` λ©”μ„λ“ μ‚¬μ©ν•μ‹λ” κ²ƒμ„ κ¶μ¥λ“λ¦½λ‹λ‹¤.
- nκ°μ ν–‰μ„ μ¶”κ°€ν•κ³  μΏΌλ¦¬λ¥Ό λ‹¤μ‹ μ‹¤ν–‰ν•λ ¤λ” κ²½μ°λ‚ μΏΌλ¦¬λ¥Ό μν–‰ν•κΈ° μ „μ— μ—¬λ¬ λ² μ¶”κ°€ν•λ ¤λ” κ²½μ° `extend`λ³΄λ‹¤ `vstack`μ„ μ¶”μ²λ“λ¦½λ‹λ‹¤.
- μ—¬λ¬ νμΌμ„ μ½μ–΄μ„ λ‹¨μΌ λ°μ΄ν„°ν”„λ μ„μ— μ €μ¥ν•λ ¤λ” κ²½μ°, λ¦¬μ²­ν¬λ¥Ό ν†µν•΄ `vstack` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ‹κΈΈ κ¶μ¥λ“λ¦½λ‹λ‹¤.

:::

### 1.1.5 update

`update` λ©”μ„λ“λ” λ‘ λ°μ΄ν„°ν”„λ μ„μ— κ°™μ€ μ»¬λΌλ…μ΄ μλ” κ²½μ° ν•΄λ‹Ή μ—΄μ λ°μ΄ν„°ν”„λ μ„μ κ°’μ„ λ‹¤λ¥Έ λ°μ΄ν„°ν”„λ μ„μ κ°’μΌλ΅ μ—…λ°μ΄νΈν•©λ‹λ‹¤.

dfμ Bμ—΄μ„ new_dfμ Bμ—΄λ΅ μ—…λ°μ΄νΈν•©λ‹λ‹¤. λ§μ•½, κ°’μ΄ μ—†κ±°λ‚ null κ°’μΈ κ²½μ° df κ°’μ„ μ μ§€ν•©λ‹λ‹¤.

```python
df = pl.DataFrame(
    {
        "A": [1, 2, 3, 4],
        "B": [400, 500, 600, 700],
    }
)

new_df = pl.DataFrame(
    {
        "B": [-66, None, -99],
        "C": [5, 3, 1],
    }
)

# df.update(μƒλ΅μ΄λ°μ΄ν„°ν”„λ μ„)
print(df.update(new_df))
```

```
shape: (4, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ A   β”† B   β”‚
β”‚ --- β”† --- β”‚
β”‚ i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† -66 β”‚
β”‚ 2   β”† 500 β”‚
β”‚ 3   β”† -99 β”‚
β”‚ 4   β”† 700 β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

`how` λ§¤κ°λ³€μλ” μ–΄λ–¤ λ°©μ‹μΌλ΅ λ°μ΄ν„°ν”„λ μ„μ„ μ—…λ°μ΄νΈν•  μ§€ μ΅°μΈ λ°©μ‹μ„ μ§€μ •ν•©λ‹λ‹¤. inner μ΅°μΈμ„ ν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ new_df ν–‰μ΄ 3κ°λ°–μ— μ—†κΈ° λ•λ¬Έμ— 3κ°μ ν–‰λ§ μ¶λ ¥λ©λ‹λ‹¤.

```python
# df.update(new_df, how="μ΅°μΈ μΆ…λ¥")
print(df.update(new_df, how="inner"))
```

```
shape: (3, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ A   β”† B   β”‚
β”‚ --- β”† --- β”‚
β”‚ i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† -66 β”‚
β”‚ 2   β”† 500 β”‚
β”‚ 3   β”† -99 β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

- left : μ™Όμ½ ν…μ΄λΈ”μ λ¨λ“  ν–‰μ„ μ μ§€ν•λ©°, μ¤λ¥Έμ½ ν…μ΄λΈ”μ λ§¤μΉ­λλ” κ°’λ§ μ—…λ°μ΄νΈν•κ³  λ‚λ¨Έμ§€λ” μ›λ κ°’μ„ μ μ§€ν•©λ‹λ‹¤. λ§μ•½, μ—¬λ¬λ² λ§¤μΉ­λλ©΄ ν–‰μ΄ μ¤‘λ³µλ  μ μμµλ‹λ‹¤.
- inner : λ‘ λ°μ΄ν„°ν”„λ μ„μ—μ„ κ³µν†µμΌλ΅ μ΅΄μ¬ν•λ” κ°’, nullμ΄ μ•„λ‹ λ§¤μΉ­λλ” κ°’λ§ κ²°κ³Όμ— ν¬ν•¨λ©λ‹λ‹¤.
- full : μ™Όμ½ ν…μ΄λΈ”μ λ¨λ“  ν–‰μ„ μ μ§€ν•λ©°, μ¤λ¥Έμ½ ν…μ΄λΈ”μ λ§¤μΉ­λλ” κ°’λ§ μ—…λ°μ΄νΈν•κ³  μƒλ΅μ΄ λ°μ΄ν„°κ°€ μλ” κ²½μ° ν–‰μ— μ¶”κ°€ν•©λ‹λ‹¤.

μ΄λ²μ—λ” κ° λ°μ΄ν„°ν”„λ μ„μ—μ„ λ…μ‹μ μΌλ΅ μ΅°μΈν•  μ—΄μ„ μ„¤μ •ν•μ—¬ κ°’μ„ μ—…λ°μ΄νΈν•©λ‹λ‹¤. Bμ μ—΄μ„ κΈ°μ¤€μΌλ΅ full joinμ„ ν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.

```python
# df.update(μƒλ΅μ΄λ°μ΄ν„°ν”„λ μ„, on=["μ»¬λΌλ…"], how="μ΅°μΈ μΆ…λ¥")
print(df.update(new_df, on=["B"], how="full"))
```

- on : μ΅°μΈν•  μ»¬λΌλ…, λ‘ λ°μ΄ν„°ν”„λ μ„μ— ν•΄λ‹Ή μ»¬λΌλ…μ΄ μ΅΄μ¬ν•΄μ•Ό ν•©λ‹λ‹¤. μ—†μ(κΈ°λ³Έκ°’)μΌλ΅ μ„¤μ •ν•λ©΄ κ° λ°μ΄ν„°ν”„λ μ„μ μ•”λ¬µμ μΈ ν–‰ μΈλ±μ¤κ°€ μ΅°μΈ ν‚¤λ΅ μ‚¬μ©λ©λ‹λ‹¤.

```
shape: (7, 2)
β”β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
β”‚ A    β”† B    β”‚
β”‚ ---  β”† ---  β”‚
β”‚ i64  β”† i64  β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1    β”† 400  β”‚
β”‚ 2    β”† 500  β”‚
β”‚ 3    β”† 600  β”‚
β”‚ 4    β”† 700  β”‚
β”‚ null β”† null β”‚
β”‚ null β”† -66  β”‚
β”‚ null β”† -99  β”‚
β””β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”
```

μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ A μ—΄μ κ°’κ³Ό μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ C μ—΄μ κ°’μ΄ κ°™μ€ ν–‰μ„ μ°Ύμ•„ ν•΄λ‹Ή ν–‰μ B κ°’μ„ μ—…λ°μ΄νΈν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.

```python
# df.update(μƒλ΅μ΄λ°μ΄ν„°ν”„λ μ„, left_on=["κΈ°μ΅΄ λ°μ΄ν„°ν”„λ μ„ μ»¬λΌλ…"], right_on=["μƒλ΅μ΄ λ°μ΄ν„°ν”„λ μ„ μ»¬λΌλ…"], how="μ΅°μΈ μΆ…λ¥")
print(df.update(new_df, left_on=["A"], right_on=["C"], how="full"))
```

- left_on : μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ μ—΄μ„ κΈ°μ¤€μΌλ΅ μ΅°μΈν•©λ‹λ‹¤.
- right_on : μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ μ—΄μ„ κΈ°μ¤€μΌλ΅ μ΅°μΈν•©λ‹λ‹¤.

```
shape: (5, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ A   β”† B   β”‚
β”‚ --- β”† --- β”‚
β”‚ i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† -99 β”‚
β”‚ 2   β”† 500 β”‚
β”‚ 3   β”† 600 β”‚
β”‚ 4   β”† 700 β”‚
β”‚ 5   β”† -66 β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

`include_nulls` λ§¤κ°λ³€μλ” left/inner μ΅°μΈμ„ μ„ν• λ§¤κ°λ³€μλ΅ Trueλ΅ μ„¤μ •ν•λ©΄ null κ°’μ„ ν¬ν•¨ν•μ—¬ κ°’ μ—…λ°μ΄νΈν•©λ‹λ‹¤. μ΄λ•, μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ κ°’μ„ μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ null κ°’μΌλ΅ λ®μ–΄μ”λ‹λ‹¤. False(κΈ°λ³Έκ°’)λ΅ μ„¤μ •ν•λ©΄ μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ null κ°’μ€ λ¬΄μ‹λ©λ‹λ‹¤.

```python
print(df.update(new_df, left_on="A", right_on="C", how="full", include_nulls=True))
```

```
shape: (5, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
β”‚ A   β”† B    β”‚
β”‚ --- β”† ---  β”‚
β”‚ i64 β”† i64  β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† -99  β”‚
β”‚ 2   β”† 500  β”‚
β”‚ 3   β”† null β”‚
β”‚ 4   β”† 700  β”‚
β”‚ 5   β”† -66  β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”
```

### 1.1.6 join

`join` λ©”μ„λ“λ” λ‘ λ°μ΄ν„°ν”„λ μ„μ„ νΉμ • μ»¬λΌ κΈ°μ¤€μΌλ΅ μ΅°μΈν•©λ‹λ‹¤. dfμ™€ other_dfλ¥Ό ham μ—΄μ„ κΈ°μ¤€μΌλ΅ μ΅°μΈν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ hamμ μ—΄μ—μ„ κ³µν†µμΌλ΅ μ΅΄μ¬ν•λ” κ°’μ ν–‰λ§ μ¶λ ¥λ κ²ƒμ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤.

```python
df = pl.DataFrame(
    {
        "foo": [1, 2, 3],
        "bar": [6.0, 7.0, 8.0],
        "ham": ["a", "b", "c"],
    }
)
other_df = pl.DataFrame(
    {
        "apple": ["x", "y", "z"],
        "ham": ["a", "b", "d"],
    }
)

# df.join(μƒλ΅μ΄ λ°μ΄ν„°ν”„λ μ„, on="μ»¬λΌλ…")
print(df.join(other_df, on="ham"))
```

```
shape: (2, 4)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”† ham β”† apple β”‚
β”‚ --- β”† --- β”† --- β”† ---   β”‚
β”‚ i64 β”† f64 β”† str β”† str   β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† 6.0 β”† a   β”† x     β”‚
β”‚ 2   β”† 7.0 β”† b   β”† y     β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”
```

λ§μ•½, μ΅°μΈν•  μ—΄μ μ΄λ¦„μ΄ λ‹¤λ¥Ό κ²½μ° onμ΄ μ•„λ‹ left_on, right_onμ„ μ‚¬μ©ν•μ…”μ•Ό ν•©λ‹λ‹¤. df2μ™€ other_df2λ¥Ό μ΅°μΈν•  λ•, dfμ ham1 μ—΄κ³Ό other_df2μ ham2 μ—΄μ„ κΈ°μ¤€μΌλ΅ μ΅°μΈν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.

```python
df2 = pl.DataFrame(
    {
        "foo": [1, 2, 3],
        "bar": [6.0, 7.0, 8.0],
        "ham1": ["a", "b", "c"],
    }
)
other_df2 = pl.DataFrame(
    {
        "apple": ["x", "y", "z"],
        "ham2": ["a", "b", "d"],
    }
)

# df.join(μƒλ΅μ΄ λ°μ΄ν„°ν”„λ μ„, left_on="μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ μ»¬λΌλ…", right_on="μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ μ»¬λΌλ…")
print(df2.join(other_df2, left_on="ham1", right_on="ham2"))
```

```
shape: (2, 4)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”† ham1 β”† apple β”‚
β”‚ --- β”† --- β”† ---  β”† ---   β”‚
β”‚ i64 β”† f64 β”† str  β”† str   β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† 6.0 β”† a    β”† x     β”‚
β”‚ 2   β”† 7.0 β”† b    β”† y     β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”
```

λ‘ λ°μ΄ν„°ν”„λ μ„μ„ μ–΄λ–»κ² μ΅°μΈν• μ§€ μ΅°μΈ λ°©λ²•μ„ μ •ν•  μ μμµλ‹λ‹¤. dfμ™€ other_dfλ¥Ό full joinν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.

```python
# df.join(other_df, on="μ»¬λΌλ…", how="μ΅°μΈλ°©λ²•")
print(df.join(other_df, on="ham", how="full"))
```

- inner : λ‘ λ°μ΄ν„°ν”„λ μ„μ— κ³µν†µμ μΌλ΅ μΌμΉν•λ” κ°’μ΄ μλ” ν–‰μ„ λ°ν™ν•©λ‹λ‹¤.
- left : μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ λ¨λ“  ν–‰κ³Ό μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ μΌμΉν•λ” ν–‰μ„ λ°ν™ν•©λ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ” μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ ν–‰ μμ„λ¥Ό μ μ§€ν•©λ‹λ‹¤.
- full : μ™Όμ½ λλ” μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ— μΌμΉν•λ” ν•­λ©μ΄ μμ„ λ• λ¨λ“  ν–‰μ„ λ°ν™ν•©λ‹λ‹¤.
- semi : μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ—μ„ μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ— μΌμΉν•λ” ν–‰μ΄ μλ” ν–‰μ„ λ°ν™ν•©λ‹λ‹¤.
- anti : μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ—μ„ μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ— μΌμΉν•λ” ν•­λ©μ΄ μ—†λ” ν–‰μ„ λ°ν™ν•©λ‹λ‹¤.
- cross : λ‘ λ°μ΄ν„°ν”„λ μ„μ ν–‰μ λ°μΉ΄λ¥΄νΈ κ³±μ„ λ°ν™ν•©λ‹λ‹¤. μ΄λ•, on λ§¤κ°λ³€μλ” μ‚¬μ©ν•μ§€ μ•μµλ‹λ‹¤.

```python
shape: (4, 5)
β”β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo  β”† bar  β”† ham  β”† apple β”† ham_right β”‚
β”‚ ---  β”† ---  β”† ---  β”† ---   β”† ---       β”‚
β”‚ i64  β”† f64  β”† str  β”† str   β”† str       β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1    β”† 6.0  β”† a    β”† x     β”† a         β”‚
β”‚ 2    β”† 7.0  β”† b    β”† y     β”† b         β”‚
β”‚ null β”† null β”† null β”† z     β”† d         β”‚
β”‚ 3    β”† 8.0  β”† c    β”† null  β”† null      β”‚
β””β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
print(df.join(other_df, on="ham", how="semi"))
```

```
shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”† ham β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ i64 β”† f64 β”† str β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† 6.0 β”† a   β”‚
β”‚ 2   β”† 7.0 β”† b   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

```python
print(df.join(other_df, on="ham", how="anti"))
```

```
shape: (1, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”† ham β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ i64 β”† f64 β”† str β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 3   β”† 8.0 β”† c   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

full, cross μ΅°μΈ κ²°κ³Όλ¥Ό λ³΄λ©΄ μ»¬λΌλ…\_right λΌκ³  μƒλ΅μ΄ μ»¬λΌμ΄ λ§λ“¤μ–΄μ§„ κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤. λ§μ•½, μ»¬λΌλ…\_rightκ°€ μ•„λ‹ λ‹¤λ¥Έ μ ‘λ―Έμ‚¬λ¥Ό μ¶”κ°€ν•κ³  μ‹¶λ‹¤λ©΄ `suffix`λ¥Ό μ΄μ©ν•μ‹λ©΄ λ©λ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ μ ‘λ―Έμ‚¬κ°€ λ³€κ²½λ κ²ƒμ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤.

```python
print(df.join(other_df, on="ham", how="full", suffix="_new"))
```

```python
shape: (4, 5)
β”β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo  β”† bar  β”† ham  β”† apple β”† ham_new β”‚
β”‚ ---  β”† ---  β”† ---  β”† ---   β”† ---     β”‚
β”‚ i64  β”† f64  β”† str  β”† str   β”† str     β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1    β”† 6.0  β”† a    β”† x     β”† a       β”‚
β”‚ 2    β”† 7.0  β”† b    β”† y     β”† b       β”‚
β”‚ null β”† null β”† null β”† z     β”† d       β”‚
β”‚ 3    β”† 8.0  β”† c    β”† null  β”† null    β”‚
β””β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

`coalesce=True`λ΅ μ„¤μ •ν•μ—¬ μ΅°μΈ μ—΄μ„ λ³‘ν•©ν•©λ‹λ‹¤. λ§μ•½, κ³„μ‚°μ‹μ— μν•΄ μ΅°μΈν•λ‹¤λ©΄ λ³‘ν•©μ΄ ν•΄μ λ©λ‹λ‹¤. False(κΈ°λ³Έκ°’, None)λ΅ μ„¤μ •ν•  κ²½μ° μ΅°μΈ μ—΄μ„ λ³‘ν•©ν•μ§€ μ•μµλ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ dfμ ham μ—΄κ³Ό other_dfμ ham μ—΄μ΄ λ³‘ν•©λ κ²ƒμ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤.

```python
print(df.join(other_df, on="ham", how="left", coalesce=True))
```

```python
shape: (3, 4)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo β”† bar β”† ham β”† apple β”‚
β”‚ --- β”† --- β”† --- β”† ---   β”‚
β”‚ i64 β”† f64 β”† str β”† str   β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1   β”† 6.0 β”† a   β”† x     β”‚
β”‚ 2   β”† 7.0 β”† b   β”† y     β”‚
β”‚ 3   β”† 8.0 β”† c   β”† null  β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”
```

:::div{.callout}
λ²”μ£Όν• λ°μ΄ν„°κ°€ μλ” μ—΄μ— λ€ν• μ΅°μΈμ€ `polars.StringCache`λ¥Ό μ‚¬μ©ν•μ‹κΈΈ λ°”λλ‹λ‹¤.

```python
# λ‘ λ°μ΄ν„°ν”„λ μ„μ— λ²”μ£Όν• λ°μ΄ν„°κ°€ μλ” κ²½μ°
df1 = pl.DataFrame({
    "id": [1, 2, 3],
    "category": ["A", "B", "A"]  # λ²”μ£Όν• λ°μ΄ν„°
})

df2 = pl.DataFrame({
    "id": [1, 2, 4],
    "category": ["A", "C", "B"]  # λ²”μ£Όν• λ°μ΄ν„°
})

# λ²”μ£Όν• λ°μ΄ν„°λ¥Ό StringCacheλ¥Ό μ‚¬μ©ν•μ—¬ λ³€ν™
with pl.StringCache():
    # κ° λ°μ΄ν„°ν”„λ μ„μ category μ—΄μ„ λ²”μ£Όν•μΌλ΅ λ³€ν™
    df1 = df1.with_columns(pl.col("category").cast(pl.Categorical))
    df2 = df2.with_columns(pl.col("category").cast(pl.Categorical))

    result = df1.join(df2, on="category", how="left")
    print(result)
```

1. λ©”λ¨λ¦¬ ν¨μ¨μ„±: λ¬Έμμ—΄μ„ μ •μλ΅ μΈμ½”λ”©ν•μ—¬ λ©”λ¨λ¦¬ μ‚¬μ©μ„ μ¤„μ„
2. μ„±λ¥ ν–¥μƒ: λ¬Έμμ—΄ λΉ„κµ λ€μ‹  μ •μ λΉ„κµλ¥Ό μν–‰ν•μ—¬ μ΅°μΈ μ„±λ¥ ν–¥μƒ
3. μΌκ΄€μ„± μ μ§€: μ„λ΅ λ‹¤λ¥Έ λ°μ΄ν„°ν”„λ μ„ κ°„μ— λ²”μ£Όν• λ°μ΄ν„°μ λ§¤ν•‘μ„ μΌκ΄€λκ² μ μ§€

νΉν λ€μ©λ‰ λ°μ΄ν„°μ—μ„ λ²”μ£Όν• μ—΄μ„ κΈ°μ¤€μΌλ΅ μ΅°μΈν•  λ• `StringCache`λ¥Ό μ‚¬μ©ν•λ©΄ μ„±λ¥μ΄ ν¬κ² ν–¥μƒλ  μ μμµλ‹λ‹¤.

:::

`join_nulls=True`λ΅ μ„¤μ •ν•μ—¬ null κ°’λΌλ¦¬ μ΅°μΈμ„ ν—μ©ν•©λ‹λ‹¤. False(κΈ°λ³Έκ°’)μ€ null κ°’λΌλ¦¬ μ΅°μΈμ„ μν–‰ν•μ§€ μ•μµλ‹λ‹¤.

```python
df = pl.DataFrame(
    {
        "foo": [1, 2, 3],
        "bar": [6.0, 7.0, 8.0],
        "ham": ["a", None, "c"],
    }
)
other_df = pl.DataFrame(
    {
        "apple": ["x", "y", "z"],
        "ham": ["a", None, "d"],
    }
)

print(df.join(other_df, on="ham", how="full", join_nulls=True))
```

```python
shape: (4, 5)
β”β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo  β”† bar  β”† ham  β”† apple β”† ham_right β”‚
β”‚ ---  β”† ---  β”† ---  β”† ---   β”† ---       β”‚
β”‚ i64  β”† f64  β”† str  β”† str   β”† str       β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1    β”† 6.0  β”† a    β”† x     β”† a         β”‚
β”‚ 2    β”† 7.0  β”† null β”† y     β”† null      β”‚
β”‚ null β”† null β”† null β”† z     β”† d         β”‚
β”‚ 3    β”† 8.0  β”† c    β”† null  β”† null      β”‚
β””β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
# print(df.join(other_df, on="ham", how="full"))
print(df.join(other_df, on="ham", how="full", join_nulls=False))
```

```python
shape: (5, 5)
β”β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo  β”† bar  β”† ham  β”† apple β”† ham_right β”‚
β”‚ ---  β”† ---  β”† ---  β”† ---   β”† ---       β”‚
β”‚ i64  β”† f64  β”† str  β”† str   β”† str       β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1    β”† 6.0  β”† a    β”† x     β”† a         β”‚
β”‚ null β”† null β”† null β”† y     β”† null      β”‚
β”‚ null β”† null β”† null β”† z     β”† d         β”‚
β”‚ 3    β”† 8.0  β”† c    β”† null  β”† null      β”‚
β”‚ 2    β”† 7.0  β”† null β”† null  β”† null      β”‚
β””β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

`validate`λ” λ‘ λ°μ΄ν„°ν”„λ μ„ κ΄€κ³„κ°€ μ΅°μΈ μ ν•κ³Ό λ™μΌν•μ§€ ν™•μΈν•©λ‹λ‹¤. λ§μ•½, λ‹¤λ¥Έ κ²½μ° μ—λ¬κ°€ λ‚κ² λ©λ‹λ‹¤.

```python
df = pl.DataFrame(
    {
        "foo": [1, 2, 3],
        "bar": [6.0, 7.0, 8.0],
        "ham": ["a", "a" , "c"],
    }
)
other_df = pl.DataFrame(
    {
        "apple": ["x", "y", "z"],
        "ham": ["a", "a", "d"],
    }
)

print(df.join(other_df, on="ham", how="full", validate="m:m"))
# print(df.join(other_df, on="ham", how="full", validate="1:m"))
# print(df.join(other_df, on="ham", how="full", validate="m:1"))
# print(df.join(other_df, on="ham", how="full", validate="1:1"))
```

```
shape: (6, 5)
β”β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ foo  β”† bar  β”† ham  β”† apple β”† ham_right β”‚
β”‚ ---  β”† ---  β”† ---  β”† ---   β”† ---       β”‚
β”‚ i64  β”† f64  β”† str  β”† str   β”† str       β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 1    β”† 6.0  β”† a    β”† x     β”† a         β”‚
β”‚ 2    β”† 7.0  β”† a    β”† x     β”† a         β”‚
β”‚ 1    β”† 6.0  β”† a    β”† y     β”† a         β”‚
β”‚ 2    β”† 7.0  β”† a    β”† y     β”† a         β”‚
β”‚ null β”† null β”† null β”† z     β”† d         β”‚
β”‚ 3    β”† 8.0  β”† c    β”† null  β”† null      β”‚
β””β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
ComputeError: the join keys did not fulfil 1:m validation
ComputeError: the join keys did not fulfil m:1 validation
ComputeError: the join keys did not fulfil 1:1 validation
```

- m:m(many_to_many) : κΈ°λ³Έκ°’, λ‹¤λ€λ‹¤ κ΄€κ³„μΈμ§€ ν™•μΈν•©λ‹λ‹¤. μ–‘μ½ λ°μ΄ν„°ν”„λ μ„ μ΅°μΈ ν‚¤κ°€ κ³ μ ν•μ§€ μ•μµλ‹λ‹¤.
  left_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | a | 3 |
  | c | 2 |
  right_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | a | 2 |
  | e | 3 |
- 1:m(one_to_many) : μ™Όμ½ λ°μ΄ν„° μ…‹μ—μ„ μ΅°μΈ ν‚¤κ°€ κ³ μ ν•μ§€ ν™•μΈν•©λ‹λ‹¤.
  left_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | b | 3 |
  | c | 2 |
  right_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | a | 2 |
  | e | 3 |
- m:1(many_to_one) : μ¤λ¥Έμ½ λ°μ΄ν„° μ…‹μ—μ„ μ΅°μΈ ν‚¤κ°€ κ³ μ ν•μ§€ ν™•μΈν•©λ‹λ‹¤.
  left_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | a | 3 |
  | c | 2 |
  right_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | d | 2 |
  | e | 3 |
- 1:1(one_to_one) : μ™Όμ½ λ° μ¤λ¥Έμ½ λ°μ΄ν„° μ…‹ λ¨λ‘μ—μ„ μ΅°μΈ ν‚¤κ°€ κ³ μ ν•μ§€ ν™•μΈν•©λ‹λ‹¤.
  left_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | b | 3 |
  | c | 2 |
  right_df
  | join_columns | n |
  | ------------ | --- |
  | a | 1 |
  | d | 2 |
  | e | 3 |

### 1.1.7 join_asof

ASOF(As-Of) μ΅°μΈμ€ λ‘ ν…μ΄λΈ”μ„ λ³‘ν•©ν•λ” λ°©λ²• μ¤‘ ν•λ‚λ΅, νΉν μ‹κ³„μ—΄ λ°μ΄ν„°μ—μ„ μ μ©ν•©λ‹λ‹¤. ASOF μ΅°μΈμ€ κΈ°μ¤€ μ—΄μ—μ„ κ°’μ΄ μ •ν™•ν μΌμΉν•μ§€ μ•λ”λΌλ„ κ°€μ¥ κ°€κΉμ΄ μ΄μ „ κ°’κ³Ό λ§¤μΉ­λλ” μ΅°μΈ ν‚¤λ¥Ό μ°Ύμµλ‹λ‹¤. μ΄λ” μ‹κ³„μ—΄ λ°μ΄ν„°μ λΉ„λ™κΈ°μ  νΉμ„±μ„ μ²λ¦¬ν•λ”λ° μ μ©ν•©λ‹λ‹¤.

λ™μΌν• μ΅°μΈ ν‚¤κ°€ μ•„λ‹ κ°€μ¥ κ°€κΉμ΄ μ΅°μΈ ν‚¤λ¥Ό κΈ°μ¤€μΌλ΅ λ§¤μΉ­ν•λ‹¤λ” μ μ„ μ μ™Έν•λ©΄ κΈ°μ΅΄ μ΅°μΈ λ°©λ²•κ³Ό λΉ„μ·ν•©λ‹λ‹¤. μ΄λ•, λ‘ λ°μ΄ν„°ν”„λ μ„ λ¨λ‘ μ΅°μΈ ν‚¤λ¥Ό κΈ°μ¤€μΌλ΅ μ •λ ¬λμ–΄μ•Ό ν•©λ‹λ‹¤.

```python
from datetime import date

gdp = pl.DataFrame(
    {
        "date": pl.date_range(
            date(2016, 1, 1),
            date(2020, 1, 1),
            "1y",
            eager=True,
        ),
        "gdp": [4164, 4411, 4566, 4696, 4827],
    }
)

population = pl.DataFrame(
    {
        "date": [date(2016, 3, 1), date(2018, 8, 1), date(2019, 1, 1)],
        "population": [82.19, 82.66, 83.12],
    }
).sort("date")
```

- date_range(μ‹μ‘λ‚ μ§, μΆ…λ£λ‚ μ§, κ°„κ²©, eager) : μ‹μ‘ λ‚ μ§λ¶€ν„° μΆ…λ£ λ‚ μ§κΉμ§€ μΌμ •ν• κ°„κ²©μΌλ΅ λ‚ μ§ μ‹ν€€μ¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
  - `eager=True`: κ²°κ³Όλ¥Ό μ¦‰μ‹ κ³„μ‚°ν•μ—¬ λ©”λ¨λ¦¬μ— μ €μ¥

```python
# df.join_asof(df2, on="μ»¬λΌλ…", strategy="μ΅°μΈ λ°©λ²•")
print(population.join_asof(gdp, on="date", strategy="backward"))
```

- on: λ‘ λ°μ΄ν„°ν”„λ μ„μ μ΅°μΈν•  μ»¬λΌλ…μ…λ‹λ‹¤. λ§μ•½, λ‘ λ°μ΄ν„°ν”„λ μ„μ μ΅°μΈν•  μ»¬λΌλ…μ΄ λ‹¤λ¥Ό κ²½μ° joinμ—μ„μ™€ κ°™μ΄ on λ€μ‹  left_on, right_onμ„ μ‚¬μ©ν•μ—¬ κ°κ°μ μ΅°μΈν•  μ»¬λΌλ…μ„ μ…λ ¥ν•©λ‹λ‹¤.
- strategy: μ–΄λ–¤ λ°©λ²•μΌλ΅ μ΅°μΈν• μ§€ μ„¤μ •ν•©λ‹λ‹¤.
  - backward(κΈ°λ³Έκ°’) : κ° ν–‰μ— λ€ν•΄ μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ ν–‰μ κ°’μ΄ μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ ν–‰μ κ°’λ³΄λ‹¤ μ‘κ±°λ‚ κ°™μ€ λ§μ§€λ§‰ ν–‰μ„ μ„ νƒν•©λ‹λ‹¤.
  - forward : κ° ν–‰μ— λ€ν•΄ μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ ν–‰μ κ°’μ΄ μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ ν–‰μ κ°’λ³΄λ‹¤ ν¬κ±°λ‚ κ°™μ€ μ²« λ²μ§Έ ν–‰μ„ μ„ νƒν•©λ‹λ‹¤.
  - nearest : κ° ν–‰μ— λ€ν•΄ μ¤λ¥Έμ½ λ°μ΄ν„°ν”„λ μ„μ ν–‰μ κ°’μ΄ μ™Όμ½ λ°μ΄ν„°ν”„λ μ„μ ν–‰μ κ°’μ— κ°€μ¥ κ°€κΉμ΄ κ°’μ„ κ°€μ§„ λ§μ§€λ§‰ ν–‰μ„ μ„ νƒν•©λ‹λ‹¤. nearestμ—λ” λ°μ΄ν„° νƒ€μ…μ΄ λ¬Έμμ—΄μΈ κ²½μ° ASOF μ΅°μΈμ΄ μ§€μ›λμ§€ μ•μµλ‹λ‹¤.

μ¶λ ¥ κ²°κ³Όλ¥Ό ν™•μΈν•΄λ³΄μ‹λ©΄ λ‚ μ§κ°€ μ •ν™•ν μΌμΉν•μ§€ μ•λ” populationμ κ° λ‚ μ§λ” gdpμ—μ„ κ°€μ¥ κ°€κΉμ΄ μ΄μ „ λ‚ μ§μ™€ λ§¤μΉ­λ κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤.

```
shape: (3, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† population β”† gdp  β”‚
β”‚ ---        β”† ---        β”† ---  β”‚
β”‚ date       β”† f64        β”† i64  β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2016-03-01 β”† 82.19      β”† 4164 β”‚
β”‚ 2018-08-01 β”† 82.66      β”† 4566 β”‚
β”‚ 2019-01-01 β”† 83.12      β”† 4696 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”
```

`strategy=β€™forwardβ€™`λ΅ μ„¤μ •ν•λ©΄, populationμ 2016-03-01 λ‚ μ§λ” gdpμ 2016-01-01κ³Ό λ§¤μΉ­λκ³ , populationμ 2018-08-01 λ‚ μ§λ” gdpμ 2018-01-01κ³Ό λ§¤μΉ­λ©λ‹λ‹¤. μ΄μ²λΌ μ •ν™•ν μΌμΉν•μ§€ μ•λ” populationμ κ° λ‚ μ§λ” gdpμ—μ„ κ°€μ¥ κ°€κΉμ΄ μ΄ν›„μ λ‚ μ§μ™€ λ§¤μΉ­λ©λ‹λ‹¤.

```python
print(population.join_asof(gdp, on="date", strategy="forward"))
```

```
shape: (3, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† population β”† gdp  β”‚
β”‚ ---        β”† ---        β”† ---  β”‚
β”‚ date       β”† f64        β”† i64  β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2016-03-01 β”† 82.19      β”† 4411 β”‚
β”‚ 2018-08-01 β”† 82.66      β”† 4696 β”‚
β”‚ 2019-01-01 β”† 83.12      β”† 4696 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”
```

`strategy=β€™nearestβ€™`λ΅ μ„¤μ •ν•λ©΄, populationμ 2016-03-01 λ‚ μ§λ” gdpμ 2017-01-01κ³Ό λ§¤μΉ­λκ³ , populationμ 2018-08-01 λ‚ μ§λ” gdpμ 2019-01-01κ³Ό λ§¤μΉ­λ©λ‹λ‹¤. μ΄μ²λΌ μ •ν™•ν μΌμΉν•μ§€ μ•λ” populationμ κ° λ‚ μ§κ°€ μ΄μ „μ΄λ“  μ΄ν›„λ“  μƒκ΄€μ—†μ΄ gdpμ—μ„ κ°€μ¥ κ°€κΉμ΄ λ‚ μ§μ™€ λ§¤μΉ­λλ―€λ΅ μ„μ λ‘ κ²°κ³Όλ¥Ό νΌν•©ν•μ—¬ μ κ³µν•©λ‹λ‹¤.

```python
print(population.join_asof(gdp, on="date", strategy="nearest"))
```

```
shape: (3, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† population β”† gdp  β”‚
β”‚ ---        β”† ---        β”† ---  β”‚
β”‚ date       β”† f64        β”† i64  β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2016-03-01 β”† 82.19      β”† 4164 β”‚
β”‚ 2018-08-01 β”† 82.66      β”† 4696 β”‚
β”‚ 2019-01-01 β”† 83.12      β”† 4696 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”
```

`by` λ§¤κ°λ³€μλ¥Ό μ‚¬μ©ν•λ©΄ asof μ΅°μΈ μ „μ— λ‹¤λ¥Έ μ—΄μ— λ¨Όμ € μ΅°μΈν•  μ μμµλ‹λ‹¤. κµ­κ°€λ³„λ΅ λ¨Όμ € μ΅°μΈν• λ‹¤μ λ‚ μ§λ³„λ΅ asof μ΅°μΈν•©λ‹λ‹¤.

```python
gdp_dates = pl.date_range(  # fmt: skip
    date(2016, 1, 1), date(2020, 1, 1), "1y", eager=True
)

gdp2 = pl.DataFrame(
    {
        "country": ["Germany"] * 5 + ["Netherlands"] * 5,
        "date": pl.concat([gdp_dates, gdp_dates]),
        "gdp": [4164, 4411, 4566, 4696, 4827, 784, 833, 914, 910, 909],
    }
).sort("country", "date")

pop2 = pl.DataFrame(
    {
        "country": ["Germany"] * 3 + ["Netherlands"] * 3,
        "date": [
            date(2016, 3, 1),
            date(2018, 8, 1),
            date(2019, 1, 1),
            date(2016, 3, 1),
            date(2018, 8, 1),
            date(2019, 1, 1),
        ],
        "population": [82.19, 82.66, 83.12, 17.11, 17.32, 17.40],
    }
).sort("country", "date")

# df.join_asof(df2, by="μ²«λ²μ§Έ μ΅°μΈ μ»¬λΌλ…", on="λ‘λ²μ§Έ μ΅°μΈ μ»¬λΌλ…", strategy="μ΅°μΈλ°©λ²•")
print(pop2.join_asof(gdp2, by="country", on="date", strategy="nearest"))
```

μ¶λ ¥ κ²°κ³Όλ¥Ό λ³΄μ‹λ©΄ populationμ κµ­κ°€κ°€ Germany 2016-03-01, λ‚ μ§λ” gdpμ κµ­κ°€κ°€ Germany 2016-01-01κ³Ό λ§¤μΉ­λκ³ , populationμ κµ­κ°€κ°€ Germany 2018-08-01 λ‚ μ§λ” gdpμ κµ­κ°€κ°€ Germany 2019-01-01κ³Ό λ§¤μΉ­λ©λ‹λ‹¤.

on λ§¤κ°λ³€μμ™€ λ§μ°¬κ°€μ§€λ΅ λ‘ λ°μ΄ν„°ν”„λ μ„μ μ»¬λΌλ…μ΄ λ‹¤λ¥Ό κ²½μ° by_left, by_right λ§¤κ°λ³€μμ— κ°κ°μ μ»¬λΌλ…μ„ μ…λ ¥ν•©λ‹λ‹¤.

```
shape: (6, 4)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
β”‚ country     β”† date       β”† population β”† gdp  β”‚
β”‚ ---         β”† ---        β”† ---        β”† ---  β”‚
β”‚ str         β”† date       β”† f64        β”† i64  β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ Germany     β”† 2016-03-01 β”† 82.19      β”† 4164 β”‚
β”‚ Germany     β”† 2018-08-01 β”† 82.66      β”† 4696 β”‚
β”‚ Germany     β”† 2019-01-01 β”† 83.12      β”† 4696 β”‚
β”‚ Netherlands β”† 2016-03-01 β”† 17.11      β”† 784  β”‚
β”‚ Netherlands β”† 2018-08-01 β”† 17.32      β”† 910  β”‚
β”‚ Netherlands β”† 2019-01-01 β”† 17.4       β”† 910  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”
```

λ‘ λ°μ΄ν„°ν”„λ μ„μ— μ»¬λΌλ…μ΄ λ™μΌν• κ²½μ° `suffix` λ§¤κ°λ³€μμ— μ΄λ¦„μ΄ μ¤‘λ³µλ μ—΄μ— μ¶”κ°€ν•  μ ‘λ―Έμ‚¬λ¥Ό μ…λ ¥ν•μ—¬ μ¶λ ¥ν•  μ μμµλ‹λ‹¤.

```python
#  'value' μ—΄μ΄ μλ” κ²½μ°
df1 = pl.DataFrame({
    "date": [date(2023, 1, 1), date(2023, 2, 1), date(2023, 3, 1)],
    "value": [100, 200, 300]
})

df2 = pl.DataFrame({
    "date": [date(2023, 1, 15), date(2023, 2, 15), date(2023, 3, 15)],
    "value": [150, 250, 350]
})

# suffixλ¥Ό μ‚¬μ©ν•μ—¬ μ¤‘λ³µ μ—΄ μ΄λ¦„ μ²λ¦¬
result = df1.join_asof(df2, on="date", suffix="_new")
print(result)
```

```
shape: (3, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† value β”† value_new  β”‚
β”‚ ---        β”† ---   β”† ---        β”‚
β”‚ date       β”† i64   β”† i64        β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2023-01-01 β”† 100   β”† null       β”‚
β”‚ 2023-02-01 β”† 200   β”† 150        β”‚
β”‚ 2023-03-01 β”† 300   β”† 250        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

- tolerance : μ«μ ν—μ© μ¤μ°¨λ΅ κ°’μ„ μ„¤μ •ν•μ—¬ κ°€κΉμ΄ μ΅°μΈν‚¤κ°€ λ²”μ„ λ‚΄μ— μλ” κ²½μ°μ—λ§ μ΅°μΈμ΄ μν–‰λ©λ‹λ‹¤. λ°μ΄ν„° νƒ€μ…μ΄ "Date", "Datetime", "Duration", "Time"μ μ—΄μ— λ€ν•΄ asof μ΅°μΈμ„ μν–‰ν•λ” κ²½μ° datetime.timedelta κ°μ²΄ λλ” μ•„λμ λ¬Έμμ—΄ μ–Έμ–΄λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

- 1ns(1λ‚λ…Έμ΄)
- 1us(1λ§μ΄ν¬λ΅μ΄)
- 1ms(1λ°€λ¦¬μ΄)
- 1s(1μ΄)
- 1m(1λ¶„)
- 1h(1μ‹κ°„)

ex) 3d12h4m25s
(3μΌ, 12μ‹κ°„ 4λ¶„ 25μ΄)

- 1d(1μ—­μΌ)
- 1w(1μ—­μ£Ό)
- 1mo(1μ—­μ›”)
- 1q(1μ—­λ¶„κΈ°)
- 1y(1μ—­μ—°λ„)

:::div{.callout}
'μ—­μΌ'μ΄λ€ λ‹¤μ λ‚ μ ν•΄λ‹Ή μ‹κ°„(μ„λ¨Ένƒ€μ„μΌλ΅ μΈν•΄ 24μ‹κ°„μ΄ μ•„λ‹ μ μμ)μ„ μλ―Έν•©λ‹λ‹¤. 'μ—­μ£Ό', 'μ—­μ›”', 'μ—­λ¶„κΈ°', 'μ—­μ—°λ„'λ„ λ§μ°¬κ°€μ§€μ…λ‹λ‹¤.

:::

```python
df1 = pl.DataFrame({
    "date": [date(2023, 1, 1), date(2023, 2, 1), date(2023, 3, 1)],
    "value": [100, 200, 300]
})

df2 = pl.DataFrame({
    "date": [date(2023, 1, 15), date(2023, 2, 15), date(2023, 3, 15)],
    "value": [150, 250, 350]
})

# 20μΌ μ΄λ‚΄μ λ°μ΄ν„° λ§¤μΉ­
print(df1.join_asof(
    df2,
    on="date",
    tolerance="20d",  # 20μΌλ΅ ν—μ© μ¤μ°¨ μ¦κ°€
    suffix="_new"
))
```

```
shape: (3, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† value β”† value_new   β”‚
β”‚ ---        β”† ---   β”† ---         β”‚
β”‚ date       β”† i64   β”† i64         β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2023-01-01 β”† 100   β”† null        β”‚
β”‚ 2023-02-01 β”† 200   β”† 150         β”‚
β”‚ 2023-03-01 β”† 300   β”† 250         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

λ€μ©λ‰ λ°μ΄ν„° μ…‹μ—μ„ λ³‘λ ¬ μ²λ¦¬ ν™μ„±ν™”ν•λ” λ°©λ²•μ— λ€ν•΄ μ•μ•„λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.

```python
from datetime import date

df1 = pl.DataFrame({
    "date": pl.date_range(date(2023, 1, 1), date(2023, 12, 31), "1d", eager=True),  # eager=True μ¶”κ°€
    "value": list(range(365))
})

df2 = pl.DataFrame({
    "date": pl.date_range(date(2023, 1, 15), date(2023, 12, 15), "1d", eager=True),  # eager=True μ¶”κ°€
    "value": list(range(335))
})

# λ³‘λ ¬ μ²λ¦¬ ν—μ©
result_allow = df1.join_asof(
    df2,
    on="date",
    allow_parallel=True,
    suffix="_new"
)
print(result_allow.head())

# λ³‘λ ¬ μ²λ¦¬ κ°•μ 
result_force = df1.join_asof(
    df2,
    on="date",
    force_parallel=True,
    suffix="_new"
)
print(result_force.head())
```

- allow_parallel : λ‘ λ°μ΄ν„°ν”„λ μ„μ„ μ΅°μΈν•  λ•, μ»΄ν“¨ν„°μ μ—¬λ¬ μ½”μ–΄λ¥Ό μ‚¬μ©ν•΄μ„ λ™μ‹μ—(λ³‘λ ¬λ΅) μ²λ¦¬ν• μ§€ μ—¬λ¶€λ¥Ό μ„¤μ •ν•©λ‹λ‹¤. Trueλ΅ μ„¤μ •ν•λ©΄ λ³‘λ ¬ μ²λ¦¬λ¥Ό ν—μ©ν•©λ‹λ‹¤.
- force_parallel : λ‘ λ°μ΄ν„°ν”„λ μ„μ„ μ΅°μΈν•  λ•, μ»΄ν“¨ν„°μ μ—¬λ¬ μ½”μ–΄λ¥Ό μ‚¬μ©ν•΄μ„ λ™μ‹μ—(λ³‘λ ¬λ΅) μ²λ¦¬ν•λ„λ΅ κ°•μ ν•©λ‹λ‹¤. μ„ νƒμ΄ μ•„λ‹ κ°•μ λ΅ λ³‘λ ¬ μ²λ¦¬λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.

```
shape: (5, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† value β”† value_new   β”‚
β”‚ ---        β”† ---   β”† ---         β”‚
β”‚ date       β”† i64   β”† i64         β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2023-01-01 β”† 0     β”† null        β”‚
β”‚ 2023-01-02 β”† 1     β”† null        β”‚
β”‚ 2023-01-03 β”† 2     β”† null        β”‚
β”‚ 2023-01-04 β”† 3     β”† null        β”‚
β”‚ 2023-01-05 β”† 4     β”† null        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
shape: (5, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† value β”† value_new   β”‚
β”‚ ---        β”† ---   β”† ---         β”‚
β”‚ date       β”† i64   β”† i64         β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2023-01-01 β”† 0     β”† null        β”‚
β”‚ 2023-01-02 β”† 1     β”† null        β”‚
β”‚ 2023-01-03 β”† 2     β”† null        β”‚
β”‚ 2023-01-04 β”† 3     β”† null        β”‚
β”‚ 2023-01-05 β”† 4     β”† null        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
df1 = pl.DataFrame({
    "date": [date(2023, 1, 1), date(2023, 2, 1), date(2023, 3, 1)],
    "value": [100, None, 300]
})

df2 = pl.DataFrame({
    "date": [date(2023, 1, 15), date(2023, 2, 15), date(2023, 3, 15)],
    "value": [150, 250, 350]
})

# coalesceλ¥Ό Trueλ΅ μ„¤μ •ν•μ—¬ μ΅°μΈ μ—΄ λ³‘ν•©
result = df1.join_asof(
    df2,
    on="date",
    coalesce=True,# None κ°’μ„ df2μ κ°’μΌλ΅ λ€μ²΄
    suffix="_new"
)
print(result)
```

- coalesce : μ΅°μΈν•  λ• κ°™μ€ μ΄λ¦„μ μ—΄λ“¤μ„ ν•λ‚λ΅ λ³‘ν•©ν•λ” μ„¤μ •μ…λ‹λ‹¤. λ‹¨μ μ—΄(col)μ΄ μ•„λ‹ λ‹¤λ¥Έ ν‘ν„μ‹μΌλ΅ μ΅°μΈν•λ©΄ μ΄ λ³‘ν•© κΈ°λ¥μ΄ ν•΄μ λ©λ‹λ‹¤.
  - True: ν•­μƒ μ΅°μΈ μ—΄μ„ λ³‘ν•©ν•©λ‹λ‹¤.
  - False: μ΅°μΈ μ—΄μ„ λ³‘ν•©ν•μ§€ μ•μµλ‹λ‹¤.

```
shape: (3, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ date       β”† value β”† value_new   β”‚
β”‚ ---        β”† ---   β”† ---         β”‚
β”‚ date       β”† i64   β”† i64         β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2023-01-01 β”† 100   β”† null        β”‚
β”‚ 2023-02-01 β”† null  β”† 150         β”‚
β”‚ 2023-03-01 β”† 300   β”† 250         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 1.1.8 merge_sorted

`merge_sorted` λ©”μ„λ“λ” μ •λ ¬λ λ‘ κ°μ λ°μ΄ν„°ν”„λ μ„μ„ κ°€μ Έμ™€ μ •λ ¬λ μ΅°μΈ ν‚¤λ΅ λ³‘ν•©ν•©λ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ„ μ •λ ¬λμ–΄ λ‚μµλ‹λ‹¤.

μ΄λ•, λ‘ λ°μ΄ν„°ν”„λ μ„μ μ¤ν‚¤λ§λ” λ™μΌν•΄μ•Όν•λ©°, κ°κ°€μ λ°μ΄ν„° ν”„λ μ„μ€ μ •λ ¬ν•  ν‚¤λ¥Ό κΈ°μ¤€μΌλ΅ μ •λ ¬λμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤.

```python
df0 = pl.DataFrame(
    {"name": ["steve", "elise", "bob"], "age": [42, 44, 18]}
).sort("age")

df1 = pl.DataFrame(
    {"name": ["anna", "megan", "steve", "thomas"], "age": [21, 33, 42, 20]}
).sort("age")

# λ°μ΄ν„°ν”„λ μ„1.merge_sorted(λ°μ΄ν„°ν”„λ μ„2, key="μ •λ ¬ν•  μ»¬λΌλ…")
print(df0.merge_sorted(df1, key="age"))
```

```
shape: (7, 2)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ name   β”† age β”‚
β”‚ ---    β”† --- β”‚
β”‚ str    β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ bob    β”† 18  β”‚
β”‚ thomas β”† 20  β”‚
β”‚ anna   β”† 21  β”‚
β”‚ megan  β”† 33  β”‚
β”‚ steve  β”† 42  β”‚
β”‚ steve  β”† 42  β”‚
β”‚ elise  β”† 44  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

## 1.2 λ°μ΄ν„° λ¶„ν•΄

### 1.2.1 explode

explode λ©”μ„λ“λ” μ§€μ •λ μ—΄μ„ λ¶„ν•΄ν•μ—¬ λ°μ΄ν„° ν”„λ μ„μ„ κΈ΄ ν•μ‹μΌλ΅ λ¶„ν•΄ν•©λ‹λ‹¤. λ¶„ν•΄λλ” κΈ°λ³Έ μ—΄μ€ λ¦¬μ¤νΈ λλ” λ°°μ—΄ λ°μ΄ν„° νƒ€μ…μ΄μ–΄μ•Ό ν•©λ‹λ‹¤.

```python
df = pl.DataFrame({
        "letters": ["a", "a", "b", "c"],
        "numbers": [[1], [2, 3], [4, 5], [6, 7, 8]],
    })
print(df.explode("numbers"))
```

```python
shape: (8, 2)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ letters β”† numbers β”‚
β”‚ ---     β”† ---     β”‚
β”‚ str     β”† i64     β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a       β”† 1       β”‚
β”‚ a       β”† 2       β”‚
β”‚ a       β”† 3       β”‚
β”‚ b       β”† 4       β”‚
β”‚ b       β”† 5       β”‚
β”‚ c       β”† 6       β”‚
β”‚ c       β”† 7       β”‚
β”‚ c       β”† 8       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 1.2.2 unnest

unnest λ©”μ„λ“λ” κ° ν•„λ“μ— λ€ν•΄ κµ¬μ΅°μ²΄ μ—΄μ„ λ³„λ„μ μ—΄λ΅ λ¶„ν•΄ν•©λ‹λ‹¤. μƒ μ—΄μ€ κΈ°μ΅΄ μ—΄μ μ„μΉμ— μλ” λ°μ΄ν„°ν”„λ μ„μ— μ†μ— μ¶”κ°€λ©λ‹λ‹¤.

```python
df = pl.DataFrame({
        "before": ["foo", "bar"],
        "t_a": [1, 2],
        "t_b": ["a", "b"],
        "t_c": [True, None],
        "t_d": [[1, 2], [3]],
        "after": ["baz", "womp"],
    }).select("before", pl.struct(pl.col("^t_.$")).alias("t_struct"), "after")

print(df.unnest("t_struct"))
```

- `pl.struct()`λ” μ΄ μ„ νƒλ μ—΄λ“¤μ„ ν•λ‚μ κµ¬μ΅°μ²΄λ΅ λ¬¶μµλ‹λ‹¤.
- `^t_.$` : "t\_"λ΅ μ‹μ‘ν•κ³  κ·Έ λ’¤μ— ν• λ¬Έμκ°€ μ¤λ” λ¨λ“  μ—΄μ„ μ„ νƒν•©λ‹λ‹¤.

```python
shape: (2, 6)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
β”‚ before β”† t_a β”† t_b β”† t_c  β”† t_d       β”† after β”‚
β”‚ ---    β”† --- β”† --- β”† ---  β”† ---       β”† ---   β”‚
β”‚ str    β”† i64 β”† str β”† bool β”† list[i64] β”† str   β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ foo    β”† 1   β”† a   β”† true β”† [1, 2]    β”† baz   β”‚
β”‚ bar    β”† 2   β”† b   β”† null β”† [3]       β”† womp  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”
```

# 2. λ°μ΄ν„° κ·Έλ£Ήν™”

## 2.1 group_by

κ·Έλ£Ήλ³„λ΅ μ§‘κ³„λ¥Ό μν–‰ν•©λ‹λ‹¤. μ»¬λΌλ…μ„ κΈ°μ¤€μΌλ΅ κ·Έλ£Ήν™”ν•κ³  aggλ΅ λ‹¤λ¥Έ μ—΄μ κ·Έλ£Ήν™”λ μ§‘κ³„λ¥Ό κ³„μ‚°ν•©λ‹λ‹¤.

```python
df = pl.DataFrame(
    {
        "a": ["a", "b", "a", "b", "c"],
        "b": [1, 2, 1, 3, 3],
        "c": [5, 4, 3, 2, 1],
    }
)

# df.group_by("μ»¬λΌλ…").agg(μ—°μ‚°)
print(df.group_by("a").agg(pl.col("b").sum()))
```

```python
shape: (3, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”‚
β”‚ --- β”† --- β”‚
β”‚ str β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ b   β”† 5   β”‚
β”‚ a   β”† 2   β”‚
β”‚ c   β”† 3   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

μ„μ— μ½”λ“λ¥Ό μ‹¤ν–‰ν• κ²ƒμ„ λ³΄λ©΄ κ·Έλ£Ήμ μμ„κ°€ μ…λ ¥κ³Ό μΌμΉν•μ§€ μ•λ” κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤. λ§μ•½, μΌμΉν•λ„λ΅ μ μ§€ν•λ ¤λ©΄ `maintain_order=True`λ΅ μ„¤μ •ν•©λ‹λ‹¤. Trueλ΅ μ„¤μ •ν•λ©΄ μ¤νΈλ¦¬λ° μ—”μ§„μ—μ„ μ‹¤ν–‰λ  κ°€λ¥μ„±μ΄ μ°¨λ‹¨λλ©°, Falseλ΅ μ„¤μ •ν–μ„ λ•λ³΄λ‹¤ λλ¦½λ‹λ‹¤. κ° κ·Έλ£Ή λ‚΄μ—μ„μ ν–‰ μμ„λ” κΈ°μ΅΄ μμ„μ™€ μΌμΉν•©λ‹λ‹¤.

```python
print(df.group_by("a", maintain_order=True).agg(pl.col("c")))
```

```python
shape: (3, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ a   β”† c         β”‚
β”‚ --- β”† ---       β”‚
β”‚ str β”† list[i64] β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a   β”† [5, 3]    β”‚
β”‚ b   β”† [4, 2]    β”‚
β”‚ c   β”† [1]       β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

κ·Έλ£Ήν™”ν•  μ¶”κ°€ μ—΄μ„ μ‰Όν‘(,)λ‚ λ¦¬μ¤νΈλ΅ μ „λ‹¬ν•μ—¬ μ—¬λ¬ μ—΄μ„ κΈ°μ¤€μΌλ΅ κ·Έλ£Ήν™” ν•  μ μμµλ‹λ‹¤. κ·Έλ£Ήν™” ν• μ»¬λΌλ…μ€ μ‚¬μ©λ μ»¬λΌλ…μΌλ΅ μ§‘κ³„μ— μ‚¬μ©ν•  μ μ—†μµλ‹λ‹¤.

```python
print(df.group_by(["a", "b"]).agg(pl.max("c")))
```

```python
shape: (4, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a   β”† 1   β”† 5   β”‚
β”‚ b   β”† 2   β”† 4   β”‚
β”‚ b   β”† 3   β”† 2   β”‚
β”‚ c   β”† 3   β”† 1   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

```python
print(df.group_by("a", pl.col("b") // 2).agg(pl.col("c").mean()))
```

```python
shape: (3, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† f64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ b   β”† 1   β”† 3.0 β”‚
β”‚ c   β”† 1   β”† 1.0 β”‚
β”‚ a   β”† 0   β”† 4.0 β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

group_by ν›„ λ°ν™λ κ°μ²΄λ” λ°λ³µ κ°€λ¥ν•λ©° κ° κ·Έλ£Ήμ μ»¬λΌλ…κ³Ό λ°μ΄ν„°λ¥Ό λ°ν™ν•©λ‹λ‹¤.

```python
for name, data in df.group_by("a"):
    print(name)
    print(data)
```

```python
a
shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a   β”† 1   β”† 5   β”‚
β”‚ a   β”† 1   β”† 3   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
b
shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ b   β”† 2   β”† 4   β”‚
β”‚ b   β”† 3   β”† 2   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
c
shape: (1, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ c   β”† 3   β”† 1   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

## **2.2 group_by_dynamic**

μ‹κ°„ κ°’(λλ” Int32, Int64 μ ν•μ μΈλ±μ¤ κ°’)μ„ κΈ°μ¤€μΌλ΅ κ·Έλ£Ήν™”ν•©λ‹λ‹¤.

every, period, offset μΈμλ΅ λ¬Έμμ—΄λ΅ κ·Έλ£Ήν™” ν•  κΈ°κ°„μ„ μ„¤μ •ν•  μ μμµλ‹λ‹¤.

- 1ns(1λ‚λ…Έμ΄)
- 1us(1λ§μ΄ν¬λ΅μ΄)
- 1ms(1λ°€λ¦¬μ΄)
- 1s(1μ΄)
- 1m(1λ¶„)
- 1h(1μ‹κ°„)

ex) 3d12h4m25s
(3μΌ, 12μ‹κ°„ 4λ¶„ 25μ΄)

- 1d(1μ—­μΌ)
- 1w(1μ—­μ£Ό)
- 1mo(1μ—­μ›”)
- 1q(1μ—­λ¶„κΈ°)
- 1y(1μ—­μ—°λ„)
    <aside>
    π’΅ 'μ—­μΌ'μ΄λ€ λ‹¤μ λ‚ μ ν•΄λ‹Ή μ‹κ°„(μ„λ¨Ένƒ€μ„μΌλ΅ μΈν•΄ 24μ‹κ°„μ΄ μ•„λ‹ μ μμ)μ„ μλ―Έν•©λ‹λ‹¤. 'μ—­μ£Ό', 'μ—­μ›”', 'μ—­λ¶„κΈ°', 'μ—­μ—°λ„'λ„ λ§μ°¬κ°€μ§€μ…λ‹λ‹¤.
    
    </aside>

μ‹κ°„μ΄ κ³„μ‚°λκ³  μ¶λ ¥ κ²°κ³Όμ— ν–‰μ΄ ν• λ‹Ήλ©λ‹λ‹¤. group_byκ³Ό λ‹¤λ¥Έ μ μ€ ν•λ‚μ ν–‰μ΄ μ—¬λ¬ κ·Έλ£Ήμ λ©¤λ²„κ°€ λ  μ μλ‹¤λ” μ μ…λ‹λ‹¤.

- [start, start + period)
- [start + every, start + every + period)
- [start + 2*every, start + 2*every + period)
- β€¦

μ—¬κΈ°μ„ startλ” start_by, offset, every λ§¤κ°λ³€μμ— λ”°λΌ κ°€μ¥ λΉ λ¥Έ μ‹κ°„μΌλ΅ κ²°μ •λ©λ‹λ‹¤.

```python
from datetime import datetime

df = pl.DataFrame(
    {
        "time": pl.datetime_range(
            start=datetime(2021, 12, 16),
            end=datetime(2021, 12, 16, 3),
            interval="30m",
            eager=True,
        ),
        "n": range(7),
    }
)

print(df)
```

```python
shape: (7, 2)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ time                β”† n   β”‚
β”‚ ---                 β”† --- β”‚
β”‚ datetime[ΞΌs]        β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-12-16 00:00:00 β”† 0   β”‚
β”‚ 2021-12-16 00:30:00 β”† 1   β”‚
β”‚ 2021-12-16 01:00:00 β”† 2   β”‚
β”‚ 2021-12-16 01:30:00 β”† 3   β”‚
β”‚ 2021-12-16 02:00:00 β”† 4   β”‚
β”‚ 2021-12-16 02:30:00 β”† 5   β”‚
β”‚ 2021-12-16 03:00:00 β”† 6   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

2021-12-16 00:00:00λ¶€ν„° 1μ‹κ°„ λ‹¨μ„λ΅ κ·Έλ£Ήν™”ν•©λ‹λ‹¤.

```python
# df.group_by_dynamic("μ»¬λΌλ…", every="κ°„κ²©", closed="λ‹«μ„ λ°©ν–¥").agg(pl.col("n"))
print(df.group_by_dynamic("time", every="1h", closed="right").agg(pl.col("n")))
```

```python
shape: (4, 2)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ time                β”† n         β”‚
β”‚ ---                 β”† ---       β”‚
β”‚ datetime[ΞΌs]        β”† list[i64] β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-12-15 23:00:00 β”† [0]       β”‚
β”‚ 2021-12-16 00:00:00 β”† [1, 2]    β”‚
β”‚ 2021-12-16 01:00:00 β”† [3, 4]    β”‚
β”‚ 2021-12-16 02:00:00 β”† [5, 6]    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

- μ»¬λΌλ… : κ·Έλ£Ήν™”μ— μ‚¬μ©λλ” μ—΄λ΅ λ°μ΄ν„° νƒ€μ…μ€ λ³΄ν†µ λ‚ μ§/μ‹κ°„ μ ν•μ…λ‹λ‹¤. μ΄λ•, κ·Έλ£Ήν™” ν•  μ—΄μ€ μ¤λ¦„μ°¨μμΌλ΅ μ •λ ¬ν•΄μ•Ό ν•©λ‹λ‹¤. μ¤λ¦„μ°¨μμΌλ΅ μ •λ ¬ν•μ§€ μ•μ„ κ²½μ° μ—λ¬κ°€ λ‚©λ‹λ‹¤.

  ```python
  new_row = pl.DataFrame(
      {
          "time": [datetime(2021, 12, 17, 2, 0, 0),datetime(2021, 12, 18, 2, 0, 0),datetime(2021, 12, 19, 2, 0, 0),datetime(2021, 12, 20, 2, 0, 0)],
          "n": [4,6,3,2]
      }
  )

  new_df = new_row.vstack(df)
  print(new_df)
  ```

  ```python
  shape: (11, 2)
  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
  β”‚ time                β”† n   β”‚
  β”‚ ---                 β”† --- β”‚
  β”‚ datetime[ΞΌs]        β”† i64 β”‚
  β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
  β”‚ 2021-12-17 02:00:00 β”† 4   β”‚
  β”‚ 2021-12-18 02:00:00 β”† 6   β”‚
  β”‚ 2021-12-19 02:00:00 β”† 3   β”‚
  β”‚ 2021-12-20 02:00:00 β”† 2   β”‚
  β”‚ 2021-12-16 00:00:00 β”† 0   β”‚
  β”‚ β€¦                   β”† β€¦   β”‚
  β”‚ 2021-12-16 01:00:00 β”† 2   β”‚
  β”‚ 2021-12-16 01:30:00 β”† 3   β”‚
  β”‚ 2021-12-16 02:00:00 β”† 4   β”‚
  β”‚ 2021-12-16 02:30:00 β”† 5   β”‚
  β”‚ 2021-12-16 03:00:00 β”† 6   β”‚
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
  ```

  ```python
  print(new_df.group_by_dynamic("time", every="1h", closed="right").agg(pl.col("n")))
  ```

  ```python
  InvalidOperationError: argument in operation 'group_by_dynamic' is not sorted, please sort the 'expr/series/column' first
  ```

- closed : μ‹κ°„ κ°„κ²©μ μ–΄λ μ½μ„ λ‹«μ„μ§€ μ •μν•©λ‹λ‹¤.(ν¬ν•¨κ΄€κ³„)
  - right :μ‹μ‘ κ°’μ€ `df[0,'time']`μ—μ„ -1μ‹κ°„ λ κ°’μ΄λ©°, μΆ…λ£ κ°’μ€ `df[-1,'time']` μ…λ‹λ‹¤. μ§‘κ³„ν•  λ•λ” μ‹μ‘ κ²½κ³„κ°’ < time β‰¤ μΆ…λ£ κ²½κ³„κ°’μ΄ λ©λ‹λ‹¤.
  - left(κΈ°λ³Έκ°’) : μ‹μ‘ κ°’μ€ `df[0,'time']`μ΄λ©°, μΆ…λ£ κ°’μ€ `df[-1,'time']`μ—μ„ +1μ‹κ°„ λ κ°’ μ…λ‹λ‹¤. μ§‘κ³„ν•  λ•λ” μ‹μ‘ κ²½κ³„κ°’ β‰¤ time < μΆ…λ£ κ²½κ³„κ°’μ΄ λ©λ‹λ‹¤.
    ```python
    print(df.group_by_dynamic("time", every="1h", closed="left").agg(pl.col("n")))
    ```
    ```python
    shape: (4, 2)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ time                β”† n         β”‚
    β”‚ ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2021-12-16 00:00:00 β”† [0, 1]    β”‚
    β”‚ 2021-12-16 01:00:00 β”† [2, 3]    β”‚
    β”‚ 2021-12-16 02:00:00 β”† [4, 5]    β”‚
    β”‚ 2021-12-16 03:00:00 β”† [6]       β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - both : μ‹μ‘ κ°’μ€ `df[0,'time']`μ—μ„ -1μ‹κ°„ λ κ°’μ΄λ©°, μΆ…λ£ κ°’μ€ `df[-1,'time']`μ—μ„ +1μ‹κ°„ λ κ°’ μ…λ‹λ‹¤. μ§‘κ³„ν•  λ•λ” μ‹μ‘ κ²½κ³„κ°’ β‰¤ time β‰¤ μΆ…λ£ κ²½κ³„κ°’μ΄ λ©λ‹λ‹¤. μ΄μ²λΌ time κ°’μ€ λ‘ κ²½κ³„μ— λ¨λ‘ μ†ν•©λ‹λ‹¤.
    ```python
    print(df.group_by_dynamic("time", every="1h", closed="both").agg(pl.col("n")))
    ```
    ```python
    shape: (5, 2)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ time                β”† n         β”‚
    β”‚ ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2021-12-15 23:00:00 β”† [0]       β”‚
    β”‚ 2021-12-16 00:00:00 β”† [0, 1, 2] β”‚
    β”‚ 2021-12-16 01:00:00 β”† [2, 3, 4] β”‚
    β”‚ 2021-12-16 02:00:00 β”† [4, 5, 6] β”‚
    β”‚ 2021-12-16 03:00:00 β”† [6]       β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - none : μ‹μ‘ κ°’μ€ `df[0,'time']` κ°’μ΄λ©°, μΆ…λ£ κ°’μ€ `df[-1,'time']` κ°’ μ…λ‹λ‹¤. μ§‘κ³„ν•  λ•λ” μ‹μ‘ κ²½κ³„κ°’ < time < μΆ…λ£ κ²½κ³„κ°’ μ΄ λ©λ‹λ‹¤. μ΄μ²λΌ time κ°’μ€ λ‘ κ²½κ³„μ— λ¨λ‘ ν¬ν•¨ν•μ§€ μ•μΌλ©°, μ¤‘κ°„μ— κ°’μ΄ μλ” κ²½μ°λ§ μ¶λ ¥ν•©λ‹λ‹¤.
    ```python
    print(df.group_by_dynamic("time", every="1h", closed="none").agg(pl.col("n")))
    ```
    ```python
    shape: (3, 2)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ time                β”† n         β”‚
    β”‚ ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2021-12-16 00:00:00 β”† [1]       β”‚
    β”‚ 2021-12-16 01:00:00 β”† [3]       β”‚
    β”‚ 2021-12-16 02:00:00 β”† [5]       β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
- offset : κ·Έλ£Ήν™” ν•  λ²”μ„λ¥Ό λ„“ν μ μμµλ‹λ‹¤. κΈ°λ³Έκ°’μ€ 0μ΄λ©°, start_byκ°€ 'datapoint'μΈ κ²½μ° μ μ©λμ§€ μ•μµλ‹λ‹¤.
  ```python
  print(df.group_by_dynamic("time", every="1h", include_boundaries=True, offset="10m").agg(pl.col("n")))
  ```
  ```python
  shape: (4, 4)
  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  β”‚ _lower_boundary     β”† _upper_boundary     β”† time                β”† n         β”‚
  β”‚ ---                 β”† ---                 β”† ---                 β”† ---       β”‚
  β”‚ datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† list[i64] β”‚
  β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
  β”‚ 2021-12-15 23:10:00 β”† 2021-12-16 00:10:00 β”† 2021-12-15 23:10:00 β”† [0]       β”‚
  β”‚ 2021-12-16 00:10:00 β”† 2021-12-16 01:10:00 β”† 2021-12-16 00:10:00 β”† [1, 2]    β”‚
  β”‚ 2021-12-16 01:10:00 β”† 2021-12-16 02:10:00 β”† 2021-12-16 01:10:00 β”† [3, 4]    β”‚
  β”‚ 2021-12-16 02:10:00 β”† 2021-12-16 03:10:00 β”† 2021-12-16 02:10:00 β”† [5, 6]    β”‚
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  ```
- label : μ¶λ ¥ κ²°κ³Όμ— μ‚¬μ©ν•  λΌλ²¨ μ •μν•  μ μμµλ‹λ‹¤.
  - left : μ‹μ‘ κ²½κ³„κ°’μ„ time κ°’μΌλ΅ μ„¤μ •ν•©λ‹λ‹¤.
    ```python
    print(df.group_by_dynamic(
        "time", every="1h", include_boundaries=True, closed="right", label='right'
    ).agg(pl.col("n")))
    ```
    ```python
    shape: (4, 4)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ _lower_boundary     β”† _upper_boundary     β”† time                β”† n         β”‚
    β”‚ ---                 β”† ---                 β”† ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2021-12-15 23:00:00 β”† 2021-12-16 00:00:00 β”† 2021-12-15 23:00:00 β”† [0]       β”‚
    β”‚ 2021-12-16 00:00:00 β”† 2021-12-16 01:00:00 β”† 2021-12-16 00:00:00 β”† [1, 2]    β”‚
    β”‚ 2021-12-16 01:00:00 β”† 2021-12-16 02:00:00 β”† 2021-12-16 01:00:00 β”† [3, 4]    β”‚
    β”‚ 2021-12-16 02:00:00 β”† 2021-12-16 03:00:00 β”† 2021-12-16 02:00:00 β”† [5, 6]    β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - right : μΆ…λ£ κ²½κ³„κ°’μ„ time κ°’μΌλ΅ μ„¤μ •ν•©λ‹λ‹¤.
    ```python
    print(df.group_by_dynamic(
        "time", every="1h", include_boundaries=True, closed="right", label='right'
    ).agg(pl.col("n")))
    ```
    ```python
    shape: (4, 4)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ _lower_boundary     β”† _upper_boundary     β”† time                β”† n         β”‚
    β”‚ ---                 β”† ---                 β”† ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2021-12-15 23:00:00 β”† 2021-12-16 00:00:00 β”† 2021-12-16 00:00:00 β”† [0]       β”‚
    β”‚ 2021-12-16 00:00:00 β”† 2021-12-16 01:00:00 β”† 2021-12-16 01:00:00 β”† [1, 2]    β”‚
    β”‚ 2021-12-16 01:00:00 β”† 2021-12-16 02:00:00 β”† 2021-12-16 02:00:00 β”† [3, 4]    β”‚
    β”‚ 2021-12-16 02:00:00 β”† 2021-12-16 03:00:00 β”† 2021-12-16 03:00:00 β”† [5, 6]    β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - datapoint : μ£Όμ–΄μ§„ time λ¦¬μ¤νΈμ—μ„ μ²« λ²μ§Έ κ°’μΌλ΅ λ μ΄λΈ”μ΄ κ²½κ³„ μ¤‘ ν•λ‚μ— μ„μΉν•  ν•„μ”κ°€ μ—†λ” κ²½μ°, datapointλ¥Ό μ„ νƒν•λ©΄ μ„±λ¥μ„ κ·Ήλ€ν™”ν•  μ μμµλ‹λ‹¤.
    ```python
    print(df.group_by_dynamic(
        "time", every="1h", include_boundaries=True, closed="right", label='datapoint'
    ).agg(pl.col("n")))
    ```
    ```python
    shape: (4, 4)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ _lower_boundary     β”† _upper_boundary     β”† time                β”† n         β”‚
    β”‚ ---                 β”† ---                 β”† ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2021-12-15 23:00:00 β”† 2021-12-16 00:00:00 β”† 2021-12-16 00:00:00 β”† [0]       β”‚
    β”‚ 2021-12-16 00:00:00 β”† 2021-12-16 01:00:00 β”† 2021-12-16 00:30:00 β”† [1, 2]    β”‚
    β”‚ 2021-12-16 01:00:00 β”† 2021-12-16 02:00:00 β”† 2021-12-16 01:30:00 β”† [3, 4]    β”‚
    β”‚ 2021-12-16 02:00:00 β”† 2021-12-16 03:00:00 β”† 2021-12-16 02:30:00 β”† [5, 6]    β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
- `include_boundaries=True`λ΅ μ„¤μ •ν•  κ²½μ° λ²”μ„μ μ‹μ‘κ³Ό μΆ…λ£λ¥Ό κ²°κ³Όμ— μ¶”κ°€ν•  μ μμµλ‹λ‹¤. μ΄λ ‡κ² ν•λ©΄ λ³‘λ ¬ μ²λ¦¬κ°€ λ” μ–΄λ ¤μ›μ§€λ―€λ΅ μ„±λ¥μ— μν–¥μ„ λ―ΈμΉ©λ‹λ‹¤.
  ```python
  print(df.group_by_dynamic(
      "time", every="1h", include_boundaries=True, closed="right"
  ).agg(pl.col("n").mean()))
  ```
  ```python
  shape: (4, 4)
  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
  β”‚ _lower_boundary     β”† _upper_boundary     β”† time                β”† n   β”‚
  β”‚ ---                 β”† ---                 β”† ---                 β”† --- β”‚
  β”‚ datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† f64 β”‚
  β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
  β”‚ 2021-12-15 23:00:00 β”† 2021-12-16 00:00:00 β”† 2021-12-15 23:00:00 β”† 0.0 β”‚
  β”‚ 2021-12-16 00:00:00 β”† 2021-12-16 01:00:00 β”† 2021-12-16 00:00:00 β”† 1.5 β”‚
  β”‚ 2021-12-16 01:00:00 β”† 2021-12-16 02:00:00 β”† 2021-12-16 01:00:00 β”† 3.5 β”‚
  β”‚ 2021-12-16 02:00:00 β”† 2021-12-16 03:00:00 β”† 2021-12-16 02:00:00 β”† 5.5 β”‚
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
  ```
- start_by : μ²« λ²μ§Έ μ‹μ‘ κ²½κ³„κ°’μ„ κ²°μ •ν•λ” λ°©λ²•μ„ μ„¤μ •ν•  μ μμµλ‹λ‹¤.

  - window(κΈ°λ³Έκ°’): κ°€μ¥ λΉ λ¥Έ μ‹κ°„μ„ κ°€μ Έμ™€μ„ λ§¤λ² μλΌλƒ…λ‹λ‹¤. μ£Όλ³„μ€ μ›”μ”μΌλ¶€ν„° μ‹μ‘λ©λ‹λ‹¤.
  - datapoint : μ²μ λ°κ²¬λ λ°μ΄ν„°λ¶€ν„° μ‹μ‘ν•©λ‹λ‹¤.
    ```python
    print(df.group_by_dynamic(
        "time", every="1h", include_boundaries=True, closed="right", start_by='datapoint'
    ).agg(pl.col("n")))
    ```
    ```python
    shape: (3, 4)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ _lower_boundary     β”† _upper_boundary     β”† time                β”† n         β”‚
    β”‚ ---                 β”† ---                 β”† ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2021-12-16 00:00:00 β”† 2021-12-16 01:00:00 β”† 2021-12-16 00:00:00 β”† [1, 2]    β”‚
    β”‚ 2021-12-16 01:00:00 β”† 2021-12-16 02:00:00 β”† 2021-12-16 01:00:00 β”† [3, 4]    β”‚
    β”‚ 2021-12-16 02:00:00 β”† 2021-12-16 03:00:00 β”† 2021-12-16 02:00:00 β”† [5, 6]    β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - sunday : μ£Όλ³„λ΅ κ·Έλ£Ήν™” ν•  λ•(everyμ— 'w'κ°€ ν¬ν•¨λ κ²½μ°), monday, tuesday, wednesday, thursday, friday, saturday, sunday κ°’μ΄ μΈμλ΅ λ“¤μ–΄κ° μ μμµλ‹λ‹¤.
    λ§μ•½, sundayλ¥Ό λ„£μ„ κ²½μ° μ‹μ‘ κ²½κ³„κ°’μ λ‚ μ§μ μ”μΌμ΄ μ „μ£Ό μΌμ”μΌλ¶€ν„° μ‹μ‘ν•κ² λ©λ‹λ‹¤. μ¶λ ¥ κ²°κ³Όλ” κ°€μ¥ λΉ λ¥Έ μ‹κ°„μ΄ λ²”μ„ μ•μ΄λ‚ μ•μ— μμ„ λ•κΉμ§€ λ’¤λ΅ μ΄λ™ν•©λ‹λ‹¤.

    ````python
    new_row = pl.DataFrame(
    {
    "time": [datetime(2021, 12, 17, 2, 0, 0),datetime(2021, 12, 18, 2, 0, 0),datetime(2021, 12, 19, 2, 0, 0),datetime(2021, 12, 20, 2, 0, 0)],
    "n": [4,6,3,2]
    }
    )

        new_df = df.vstack(new_row)
        print(new_df)
        ```

        ```python
        shape: (11, 2)
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
        β”‚ time                β”† n   β”‚
        β”‚ ---                 β”† --- β”‚
        β”‚ datetime[ΞΌs]        β”† i64 β”‚
        β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
        β”‚ 2021-12-16 00:00:00 β”† 0   β”‚
        β”‚ 2021-12-16 00:30:00 β”† 1   β”‚
        β”‚ 2021-12-16 01:00:00 β”† 2   β”‚
        β”‚ 2021-12-16 01:30:00 β”† 3   β”‚
        β”‚ 2021-12-16 02:00:00 β”† 4   β”‚
        β”‚ β€¦                   β”† β€¦   β”‚
        β”‚ 2021-12-16 03:00:00 β”† 6   β”‚
        β”‚ 2021-12-17 02:00:00 β”† 4   β”‚
        β”‚ 2021-12-18 02:00:00 β”† 6   β”‚
        β”‚ 2021-12-19 02:00:00 β”† 3   β”‚
        β”‚ 2021-12-20 02:00:00 β”† 2   β”‚
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
        ```

        ```python
        print(new_df.group_by_dynamic(
            "time", every="1w", include_boundaries=True, closed="right", start_by='sunday'
        ).agg(pl.col("n")))
        ```

        ```python
        shape: (2, 4)
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚ _lower_boundary     β”† _upper_boundary     β”† time                β”† n           β”‚
        β”‚ ---                 β”† ---                 β”† ---                 β”† ---         β”‚
        β”‚ datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† list[i64]   β”‚
        β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
        β”‚ 2021-12-12 00:00:00 β”† 2021-12-19 00:00:00 β”† 2021-12-12 00:00:00 β”† [0, 1, β€¦ 6] β”‚
        β”‚ 2021-12-19 00:00:00 β”† 2021-12-26 00:00:00 β”† 2021-12-19 00:00:00 β”† [3, 2]      β”‚
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        ```

        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%91%E1%85%B3%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%20%E1%84%89%E1%85%B5%E1%86%B7%E1%84%92%E1%85%AA%20-%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%92%E1%85%AA%2015779f9807ba8028aa48e10294d1cf85/Untitled.png)
    ````

λ‹¤λ¥Έ μ»¬λΌ κ·Έλ£Ήν™”μ™€ κ²°ν•©ν•  μλ„ μμµλ‹λ‹¤. group_byμ— μ»¬λΌλ…μ„ μ…λ ¥ν•μ—¬ μ–΄λ–¤ μ—΄μ„ κΈ°μ¤€μΌλ΅ κ·Έλ£Ήλ³„λ΅ μ§‘κ³„ν•  μ§€ μ •ν•  μ μμµλ‹λ‹¤. group_byκ°€ μ „λ‹¬λλ©΄ μ¶λ ¥ κ²°κ³Όλ” κ·Έλ£Ήν™” ν•  μ»¬λΌμ„ κΈ°μ¤€μΌλ΅ κ° κ·Έλ£Ή λ‚΄μ—μ„ μ¤λ¦„μ°¨μμΌλ΅ μ •λ ¬λ©λ‹λ‹¤.

```python
df = df.with_columns(groups=pl.Series(["a", "a", "a", "b", "b", "a", "a"]))
print(df)
```

```python
shape: (7, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ time                β”† n   β”† groups β”‚
β”‚ ---                 β”† --- β”† ---    β”‚
β”‚ datetime[ΞΌs]        β”† i64 β”† str    β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-12-16 00:00:00 β”† 0   β”† a      β”‚
β”‚ 2021-12-16 00:30:00 β”† 1   β”† a      β”‚
β”‚ 2021-12-16 01:00:00 β”† 2   β”† a      β”‚
β”‚ 2021-12-16 01:30:00 β”† 3   β”† b      β”‚
β”‚ 2021-12-16 02:00:00 β”† 4   β”† b      β”‚
β”‚ 2021-12-16 02:30:00 β”† 5   β”† a      β”‚
β”‚ 2021-12-16 03:00:00 β”† 6   β”† a      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
print(
    df.group_by_dynamic(
        "time",
        every="1h",
        closed="both",
        group_by="groups",
        include_boundaries=True,
    ).agg(pl.col("n"))
)
```

```python
shape: (7, 5)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ groups β”† _lower_boundary     β”† _upper_boundary     β”† time                β”† n         β”‚
β”‚ ---    β”† ---                 β”† ---                 β”† ---                 β”† ---       β”‚
β”‚ str    β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† datetime[ΞΌs]        β”† list[i64] β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a      β”† 2021-12-15 23:00:00 β”† 2021-12-16 00:00:00 β”† 2021-12-15 23:00:00 β”† [0]       β”‚
β”‚ a      β”† 2021-12-16 00:00:00 β”† 2021-12-16 01:00:00 β”† 2021-12-16 00:00:00 β”† [0, 1, 2] β”‚
β”‚ a      β”† 2021-12-16 01:00:00 β”† 2021-12-16 02:00:00 β”† 2021-12-16 01:00:00 β”† [2]       β”‚
β”‚ a      β”† 2021-12-16 02:00:00 β”† 2021-12-16 03:00:00 β”† 2021-12-16 02:00:00 β”† [5, 6]    β”‚
β”‚ a      β”† 2021-12-16 03:00:00 β”† 2021-12-16 04:00:00 β”† 2021-12-16 03:00:00 β”† [6]       β”‚
β”‚ b      β”† 2021-12-16 01:00:00 β”† 2021-12-16 02:00:00 β”† 2021-12-16 01:00:00 β”† [3, 4]    β”‚
β”‚ b      β”† 2021-12-16 02:00:00 β”† 2021-12-16 03:00:00 β”† 2021-12-16 02:00:00 β”† [4]       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
df = pl.DataFrame(
    {
        "idx": pl.int_range(0, 6, eager=True),
        "A": ["A", "A", "B", "B", "B", "C"],
    }
)
print(df)
```

```python
shape: (6, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ idx β”† A   β”‚
β”‚ --- β”† --- β”‚
β”‚ i64 β”† str β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 0   β”† A   β”‚
β”‚ 1   β”† A   β”‚
β”‚ 2   β”† B   β”‚
β”‚ 3   β”† B   β”‚
β”‚ 4   β”† B   β”‚
β”‚ 5   β”† C   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

- period: κ°„κ²©μ κΈΈμ΄λ¥Ό μλ―Έν•©λ‹λ‹¤. μ—†μμΈ κ²½μ° everyμ™€ κ°™μµλ‹λ‹¤. λ§μ•½, μ •μ μ—΄μ„ κ·Έλ£Ήν™”ν•λ ¤λ” κ²½μ° 1i(1 μΈλ±μ¤ μ) μΌλ΅ μ‘μ„±ν•©λ‹λ‹¤.
  ex) 1i(κΈΈμ΄ 1), 10i(κΈΈμ΄ 10)
  ```python
  print((
      df.group_by_dynamic(
          "idx",
          every="2i",
          period="3i",
          include_boundaries=True,
          closed="right",
      ).agg(pl.col("A").alias("A_agg_list"))
  ))
  ```
  ```python
  shape: (4, 4)
  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  β”‚ _lower_boundary β”† _upper_boundary β”† idx β”† A_agg_list      β”‚
  β”‚ ---             β”† ---             β”† --- β”† ---             β”‚
  β”‚ i64             β”† i64             β”† i64 β”† list[str]       β”‚
  β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
  β”‚ -2              β”† 1               β”† -2  β”† ["A", "A"]      β”‚
  β”‚ 0               β”† 3               β”† 0   β”† ["A", "B", "B"] β”‚
  β”‚ 2               β”† 5               β”† 2   β”† ["B", "B", "C"] β”‚
  β”‚ 4               β”† 7               β”† 4   β”† ["C"]           β”‚
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  ```
    <aside>
    π’΅ dtypeμ€ {Int32, Int64} μ¤‘ ν•λ‚μ΄μ–΄μ•Ό ν•©λ‹λ‹¤. Int32λ” μΌμ‹μ μΌλ΅ Int64λ΅ ν•λ³€ν™λλ―€λ΅ μ„±λ¥μ΄ μ¤‘μ”ν• κ²½μ° Int64 μ—΄μ„ μ‚¬μ©μ‹κΈΈ λ°”λλ‹λ‹¤.
    
    </aside>

λ‘ μ½”λ“λ” λ™μΌν•κ² μ‘λ™ν•μ§€λ§, Pandasλ” λ‹¬λ¦¬ Polarsλ” λΉ μ°½μ— μ¶”κ°€ ν–‰μ„ μ¶”κ°€ν•μ§€ μ•μµλ‹λ‹¤. index_columnμ κ°„κ²©μ„ κ· λ“±ν•κ² μ μ§€ν•΄μ•Ό ν•λ” κ²½μ° DataFrame.upsample()κ³Ό κ²°ν•©ν•μ—¬ μ‚¬μ©ν•μ‹κΈΈ λ°”λλ‹λ‹¤.

```python
# polars
from datetime import datetime
import polars as pl

df = pl.DataFrame(
    {
        "time": pl.datetime_range(
            start=datetime(2021, 12, 16),
            end=datetime(2021, 12, 16, 3),
            interval="30m",
            eager=True,
        ),
        "n": range(7),
    }
)

print(df.group_by_dynamic("time", every="1h").agg(pl.col("n").sum()))
```

```python
shape: (4, 2)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ time                β”† n   β”‚
β”‚ ---                 β”† --- β”‚
β”‚ datetime[ΞΌs]        β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-12-16 00:00:00 β”† 1   β”‚
β”‚ 2021-12-16 01:00:00 β”† 5   β”‚
β”‚ 2021-12-16 02:00:00 β”† 9   β”‚
β”‚ 2021-12-16 03:00:00 β”† 6   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
```

```python
# pandas
import pandas as pd
from datetime import datetime

df = pd.DataFrame(
    {
        "time": pl.datetime_range(
            start=datetime(2021, 12, 16),
            end=datetime(2021, 12, 16, 3),
            interval="30m",
            eager=True,
        ),
        "n": range(7),
    }
)

print(df.set_index("time").resample("h")["n"].sum().reset_index())
```

```
                 time  n
0 2021-12-16 00:00:00  1
1 2021-12-16 01:00:00  5
2 2021-12-16 02:00:00  9
3 2021-12-16 03:00:00  6
```

## **2.3 upsample**

μ—…μƒν”λ§μ€ λ§μ•½ μΉκµ¬μ™€ ν•λ‹¬μ— ν•λ² λ§λ‚κΈ°λ΅ ν•΄μ„ μ•„λμ™€ κ°™μ΄ κ³„νμ„ μ§°λ”λ° μΌμ£ΌμΌμ— ν•λ² λ§λ‚κΈ°λ΅ ν–μ„ κ²½μ°

| **λ‚ μ§**   | **μΈμ›** |
| ---------- | -------- |
| 2021-06-01 | 3        |
| 2021-07-01 | 2        |
| β€¦          | β€¦        |
| 2021-12-01 | 5        |

β€” upsample β†’

| **λ‚ μ§**   | **μΈμ›** |
| ---------- | -------- |
| 2021-06-01 | 3        |
| 2021-06-08 | null     |
| 2021-06-15 | null     |
| β€¦          |          |
| 2021-11-30 | null     |

λλ” 2μ›”κ³Ό 5μ›”μ— λ§λ‚μκ³  ν–λ”λ° 3, 4μ›”μ—λ„ λ§λ‚κΈ°λ΅ κ³„νμ„ λ³€κ²½ν–μ„ κ²½μ° λ°μ΄ν„°λ¥Ό μ•„λμ™€ κ°™μ΄ μ¶”κ°€ν•  λ• μ‚¬μ©ν•λ” λ©”μ„λ“μ…λ‹λ‹¤.

| **λ‚ μ§**   | **μΈμ›** |
| ---------- | -------- |
| 2021-02-01 | 3        |
| 2021-05-01 | 2        |

β€” upsample β†’

| **λ‚ μ§**   | **μΈμ›** |
| ---------- | -------- |
| 2021-02-01 | 3        |
| 2021-03-01 | null     |
| 2021-04-01 | null     |
| 2021-05-01 | 2        |

μ΄μ²λΌ νΉμ • κ°„κ²©μΌλ΅ λ°μ΄ν„°ν”„λ μ„μ„ μ—…μƒν”λ§ν•©λ‹λ‹¤. time_columnμ„ κΈ°μ¤€μΌλ΅ μ •λ ¬λλ©°, group_by μ—΄μ„ μ „λ‹¬ν•λ©΄ κ° κ·Έλ£Ή λ‚΄μ—μ„λ§ μ •λ ¬λ©λ‹λ‹¤.

- 1ns(1λ‚λ…Έμ΄)
- 1us(1λ§μ΄ν¬λ΅μ΄)
- 1ms(1λ°€λ¦¬μ΄)
- 1s(1μ΄)
- 1m(1λ¶„)
- 1h(1μ‹κ°„)

ex) 3d12h4m25s
(3μΌ, 12μ‹κ°„ 4λ¶„ 25μ΄)

- 1d(1μ—­μΌ)
- 1w(1μ—­μ£Ό)
- 1mo(1μ—­μ›”)
- 1q(1μ—­λ¶„κΈ°)
- 1y(1μ—­μ—°λ„)
    <aside>
    π’΅ 'μ—­μΌ'μ΄λ€ λ‹¤μ λ‚ μ ν•΄λ‹Ή μ‹κ°„(μ„λ¨Ένƒ€μ„μΌλ΅ μΈν•΄ 24μ‹κ°„μ΄ μ•„λ‹ μ μμ)μ„ μλ―Έν•©λ‹λ‹¤. 'μ—­μ£Ό', 'μ—­μ›”', 'μ—­λ¶„κΈ°', 'μ—­μ—°λ„'λ„ λ§μ°¬κ°€μ§€μ…λ‹λ‹¤.
    
    </aside>

```python
from datetime import datetime

df = pl.DataFrame(
    {
        "time": [
            datetime(2021, 6, 1),
            datetime(2021, 2, 1),
            datetime(2021, 4, 1),
            datetime(2021, 5, 1),
        ],
        "groups": ["A", "B", "A", "B"],
        "values": [0, 1, 2, 3],
    }
).set_sorted("time")

print(df)
```

```python
shape: (4, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ time                β”† groups β”† values β”‚
β”‚ ---                 β”† ---    β”† ---    β”‚
β”‚ datetime[ΞΌs]        β”† str    β”† i64    β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-02-01 00:00:00 β”† A      β”† 0      β”‚
β”‚ 2021-04-01 00:00:00 β”† B      β”† 1      β”‚
β”‚ 2021-05-01 00:00:00 β”† A      β”† 2      β”‚
β”‚ 2021-06-01 00:00:00 β”† B      β”† 3      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
# df.upsample(time_column="μ»¬λΌλ…", every="κ°„κ²©", group_by="κ·Έλ£Ήν™” ν•  μ»¬λΌλ…", maintain_order=True)
print(df.upsample(
    time_column="time", every="1mo", group_by="groups", maintain_order=True
))
```

- time_column : λ‚ μ§ λ²”μ„λ¥Ό κ²°μ •ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤. ν•΄λ‹Ή μ—΄μ„ μ •λ ¬ν• ν›„ μ‹¤ν–‰ν•μ…”μ•Ό ν•©λ‹λ‹¤. λ§μ•½ μ •λ ¬ν•μ§€ μ•μ„ κ²½μ° ν•΄λ‹Ή κ·Έλ£Ήμ— λ€ν• μ—…μƒν”λ§μ„ μ¶λ ¥ν•μ§€ μ•μµλ‹λ‹¤.
- every : λ¨λ“  κΈ°κ°„μ„ κ°„κ²©μ— λ§κ² μΌκ°­λ‹λ‹¤.
- group_by : νΉμ • μ—΄μ„ κΈ°μ¤€μΌλ΅ λ¨Όμ € κ·Έλ£Ήν™”ν• λ‹¤μ λ¨λ“  κ·Έλ£Ήμ— λ€ν•΄ μ—…μƒν”λ§ν•©λ‹λ‹¤.
- maintain_order : κΈ°λ³Έκ°’μ€ False μ΄λ©°, Trueλ΅ μ„¤μ •ν•  κ²½μ° μ›λ³Έ λ°μ΄ν„°ν”„λ μ„ μμ„λ¥Ό μ μ§€ν•©λ‹λ‹¤. λ‹¨, μ΄ κ³Όμ •μ€ μ†λ„κ°€ λλ¦½λ‹λ‹¤.

```
shape: (7, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ time                β”† groups β”† values β”‚
β”‚ ---                 β”† ---    β”† ---    β”‚
β”‚ datetime[ΞΌs]        β”† str    β”† i64    β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-02-01 00:00:00 β”† A      β”† 0      β”‚
β”‚ 2021-03-01 00:00:00 β”† null   β”† null   β”‚
β”‚ 2021-04-01 00:00:00 β”† null   β”† null   β”‚
β”‚ 2021-05-01 00:00:00 β”† A      β”† 2      β”‚
β”‚ 2021-04-01 00:00:00 β”† B      β”† 1      β”‚
β”‚ 2021-05-01 00:00:00 β”† null   β”† null   β”‚
β”‚ 2021-06-01 00:00:00 β”† B      β”† 3      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
from datetime import datetime

df = pl.DataFrame(
    {
        "time": [
            datetime(2021, 6, 1),
            datetime(2021, 2, 1),
            datetime(2021, 4, 1),
            datetime(2021, 5, 1),
        ],
        "groups": ["A", "B", "A", "B"],
        "values": [0, 1, 2, 3],
    }
).set_sorted("time")

print(df)
```

```
shape: (4, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ time                β”† groups β”† values β”‚
β”‚ ---                 β”† ---    β”† ---    β”‚
β”‚ datetime[ΞΌs]        β”† str    β”† i64    β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-06-01 00:00:00 β”† A      β”† 0      β”‚
β”‚ 2021-02-01 00:00:00 β”† B      β”† 1      β”‚
β”‚ 2021-04-01 00:00:00 β”† A      β”† 2      β”‚
β”‚ 2021-05-01 00:00:00 β”† B      β”† 3      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
```

```python
print(df.upsample(
    time_column="time", every="1mo", group_by="groups", maintain_order=True
))
```

```
shape: (4, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ time                β”† groups β”† values β”‚
β”‚ ---                 β”† ---    β”† ---    β”‚
β”‚ datetime[ΞΌs]        β”† str    β”† i64    β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2021-02-01 00:00:00 β”† B      β”† 1      β”‚
β”‚ 2021-03-01 00:00:00 β”† null   β”† null   β”‚
β”‚ 2021-04-01 00:00:00 β”† null   β”† null   β”‚
β”‚ 2021-05-01 00:00:00 β”† B      β”† 3      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## **2.4 rolling**

μ‹κ°„ λλ” μ •μ μ—΄μ„ κΈ°μ¤€μΌλ΅ λ΅¤λ§ κ·Έλ£Ήμ„ λ§λ“­λ‹λ‹¤. μΌμ •ν• κ°„κ²©μ κ²½μ° μ‚¬μ©ν•λ” group_by_dynamicκ³Ό λ‹¬λ¦¬ κ°λ³„ κ°’μ— μν•΄ κ²°μ •λ©λ‹λ‹¤.

μ‹κ³„μ—΄ <t_0, t_1, ..., t_n>μ΄ μλ” κ²½μ° κΈ°λ³Έμ μΌλ΅ μƒμ„±λλ” λ²”μ„λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.

- (t_0 - period, t_0]
- (t_1 - period, t_1]
- β€¦
- (t_n - period, t_n]

κΈ°λ³Έκ°’μ΄ μ•„λ‹ offsetμ„ μ „λ‹¬ν•λ©΄ λ²”μ„λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.

- (t_0 + offset, t_0 + offset + period]
- (t_1 + offset, t_1 + offset + period]
- β€¦
- (t_n + offset, t_n + offset + period]

period λ° offset μΈμλ” timedeltaμ—μ„ μƒμ„±ν•κ±°λ‚ μ•„λ λ¬Έμμ—΄μ„ μ‚¬μ©ν•μ—¬ μƒμ„±ν•©λ‹λ‹¤.

- 1ns(1λ‚λ…Έμ΄)
- 1us(1λ§μ΄ν¬λ΅μ΄)
- 1ms(1λ°€λ¦¬μ΄)
- 1s(1μ΄)
- 1m(1λ¶„)
- 1h(1μ‹κ°„)

ex) 3d12h4m25s
(3μΌ, 12μ‹κ°„ 4λ¶„ 25μ΄)

- 1d(1μ—­μΌ)
- 1w(1μ—­μ£Ό)
- 1mo(1μ—­μ›”)
- 1q(1μ—­λ¶„κΈ°)
- 1y(1μ—­μ—°λ„)
    <aside>
    π’΅ 'μ—­μΌ'μ΄λ€ λ‹¤μ λ‚ μ ν•΄λ‹Ή μ‹κ°„(μ„λ¨Ένƒ€μ„μΌλ΅ μΈν•΄ 24μ‹κ°„μ΄ μ•„λ‹ μ μμ)μ„ μλ―Έν•©λ‹λ‹¤. 'μ—­μ£Ό', 'μ—­μ›”', 'μ—­λ¶„κΈ°', 'μ—­μ—°λ„'λ„ λ§μ°¬κ°€μ§€μ…λ‹λ‹¤.
    
    </aside>

```python
dates = [
    "2020-01-01 13:45:48",
    "2020-01-01 16:42:13",
    "2020-01-01 16:45:09",
    "2020-01-02 18:12:48",
    "2020-01-03 19:45:32",
    "2020-01-08 23:16:43",
]

df = pl.DataFrame({"dt": dates, "a": [3, 7, 5, 9, 2, 1]}).with_columns(
    pl.col("dt").str.strptime(pl.Datetime).set_sorted()
)

# df.rolling(index_column="μ»¬λΌλ…", period="κΈΈμ΄").agg(μ§‘κ³„κ΄€λ ¨μ½”λ“)
out = df.rolling(index_column="dt", period="2d").agg(
    [
        pl.col("a"),
        pl.sum("a").alias("sum_a"),
        pl.min("a").alias("min_a"),
        pl.max("a").alias("max_a"),
    ]
)

assert out["sum_a"].to_list() == [3, 10, 15, 24, 11, 1]
assert out["max_a"].to_list() == [3, 7, 7, 9, 9, 1]
assert out["min_a"].to_list() == [3, 3, 3, 3, 2, 1]

print(out)
```

- index_column : μ‹κ°„μ„ κΈ°μ¤€μΌλ΅ κ·Έλ£Ήν™”ν•λ” λ° μ‚¬μ©λλ” μ—΄λ΅ λ³΄ν†µ λ‚ μ§/λ‚ μ§/μ‹κ°„ μ ν•μ…λ‹λ‹¤. μ΄λ•, κ·Έλ£Ήν™”ν•  μ—΄μ€ μ¤λ¦„μ°¨μμΌλ΅ μ •λ ¬ν•΄μ•Ό ν•©λ‹λ‹¤. μ¤λ¦„μ°¨μμΌλ΅ μ •λ ¬ν•μ§€ μ•μ„ κ²½μ° μ—λ¬κ°€ λ‚©λ‹λ‹¤.
- period : κΈΈμ΄, μμκ°€ μ•„λ‹ κ°’

```
shape: (6, 5)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
β”‚ dt                  β”† a           β”† sum_a β”† min_a β”† max_a β”‚
β”‚ ---                 β”† ---         β”† ---   β”† ---   β”† ---   β”‚
β”‚ datetime[ΞΌs]        β”† list[i64]   β”† i64   β”† i64   β”† i64   β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 2020-01-01 13:45:48 β”† [3]         β”† 3     β”† 3     β”† 3     β”‚
β”‚ 2020-01-01 16:42:13 β”† [3, 7]      β”† 10    β”† 3     β”† 7     β”‚
β”‚ 2020-01-01 16:45:09 β”† [3, 7, 5]   β”† 15    β”† 3     β”† 7     β”‚
β”‚ 2020-01-02 18:12:48 β”† [3, 7, β€¦ 9] β”† 24    β”† 3     β”† 9     β”‚
β”‚ 2020-01-03 19:45:32 β”† [9, 2]      β”† 11    β”† 2     β”† 9     β”‚
β”‚ 2020-01-08 23:16:43 β”† [1]         β”† 1     β”† 1     β”† 1     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”
```

- offset : μ§€μ •λ κΈ°κ°„μ„ μ΄λ™μ‹ν‚µλ‹λ‹¤. -period(κΈ°λ³Έκ°’)μ…λ‹λ‹¤. μ•„λ μ½”λ“λ” λ°μ΄ν„°λ¥Ό 1μΌμ”© μ®κΈ°λ©΄μ„ 2μΌ κΈ°κ°„ λ™μ•μ a κ°’μ„ λ¬¶μ€ κ²ƒμ…λ‹λ‹¤.
  ```
  out = df.rolling(index_column="dt", period="2d", offset='1d').agg(pl.col("a"))
  print(out)
  ```
  ```
  shape: (6, 2)
  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  β”‚ dt                  β”† a         β”‚
  β”‚ ---                 β”† ---       β”‚
  β”‚ datetime[ΞΌs]        β”† list[i64] β”‚
  β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
  β”‚ 2020-01-01 13:45:48 β”† [9, 2]    β”‚
  β”‚ 2020-01-01 16:42:13 β”† [9, 2]    β”‚
  β”‚ 2020-01-01 16:45:09 β”† [9, 2]    β”‚
  β”‚ 2020-01-02 18:12:48 β”† [2]       β”‚
  β”‚ 2020-01-03 19:45:32 β”† []        β”‚
  β”‚ 2020-01-08 23:16:43 β”† []        β”‚
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  ```
  | dt                  | period λ²”μ„                                | period μ μ© κ°’ | offset λ²”μ„                                | offset μ μ© κ°’ |
  | ------------------- | ------------------------------------------ | -------------- | ------------------------------------------ | -------------- |
  | 2020-01-01 13:45:48 | [2020-01-01 13:45:48, 2020-01-03 13:45:48] | [3,7,5,9]      | [2020-01-02 13:45:48, 2020-01-04 13:45:48] | [9,2]          |
  | 2020-01-01 16:42:13 | [2020-01-01 16:42:13, 2020-01-03 16:42:13] | [3,7,5,9]      | [2020-01-02 16:42:13, 2020-01-04 16:42:13] | [9,2]          |
  | 2020-01-01 16:45:09 | [2020-01-01 16:45:09, 2020-01-03 16:45:09] | [3,7,5,9]      | [2020-01-02 16:45:09, 2020-01-04 16:45:09] | [9,2]          |
  | 2020-01-02 18:12:48 | [2020-01-02 18:12:48, 2020-01-04 18:12:48] | [3,7,5,9]      | [2020-01-03 18:12:48, 2020-01-05 18:12:48] | [2]            |
  | 2020-01-03 19:45:32 | [2020-01-03 19:45:32, 2020-01-05 19:45:32] | [3,7,5,9]      | [2020-01-04 19:45:32, 2020-01-06 19:45:32] | []             |
  | 2020-01-08 23:16:43 | [2020-01-08 23:16:43, 2020-01-10 23:16:43] | [3,7,5,9]      | [2020-01-09 23:16:43, 2020-01-11 23:16:43] | []             |
- closed : μ‹κ°„ κ°„κ²©μ μ–΄λ μ½μ„ λ‹«μ„μ§€ μ •μν•©λ‹λ‹¤.(ν¬ν•¨κ΄€κ³„)

  ```python
  dates = [
      "2020-01-01 00:00:00",
      "2020-01-01 16:42:13",
      "2020-01-01 16:45:09",
      "2020-01-02 18:12:48",
      "2020-01-03 00:00:00",
      "2020-01-08 23:16:43",
  ]

  df = pl.DataFrame({"dt": dates, "a": [3, 7, 5, 9, 2, 1]}).with_columns(
      pl.col("dt").str.strptime(pl.Datetime).set_sorted()
  )

  print(df)
  ```

  ```python
  shape: (6, 2)
  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
  β”‚ dt                  β”† a   β”‚
  β”‚ ---                 β”† --- β”‚
  β”‚ datetime[ΞΌs]        β”† i64 β”‚
  β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
  β”‚ 2020-01-01 00:00:00 β”† 3   β”‚
  β”‚ 2020-01-01 16:42:13 β”† 7   β”‚
  β”‚ 2020-01-01 16:45:09 β”† 5   β”‚
  β”‚ 2020-01-02 18:12:48 β”† 9   β”‚
  β”‚ 2020-01-03 00:00:00 β”† 2   β”‚
  β”‚ 2020-01-08 23:16:43 β”† 1   β”‚
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”
  ```

  - `closed="right"` : μ‹μ‘ κ²½κ³„κ°’ < dt β‰¤ μΆ…λ£ κ²½κ³„κ°’μ΄ λ©λ‹λ‹¤.
    ```python
    out = df.rolling(index_column="dt", period="2d", closed='right').agg(pl.col("a"))
    print(out)
    ```
    ```python
    shape: (6, 2)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ dt                  β”† a           β”‚
    β”‚ ---                 β”† ---         β”‚
    β”‚ datetime[ΞΌs]        β”† list[i64]   β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2020-01-01 00:00:00 β”† [3]         β”‚
    β”‚ 2020-01-01 16:42:13 β”† [3, 7]      β”‚
    β”‚ 2020-01-01 16:45:09 β”† [3, 7, 5]   β”‚
    β”‚ 2020-01-02 18:12:48 β”† [3, 7, β€¦ 9] β”‚
    β”‚ 2020-01-03 00:00:00 β”† [7, 5, β€¦ 2] β”‚
    β”‚ 2020-01-08 23:16:43 β”† [1]         β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - `closed="left"`(κΈ°λ³Έκ°’) : μ‹μ‘ κ²½κ³„κ°’ β‰¤ time < μΆ…λ£ κ²½κ³„κ°’μ΄ λ©λ‹λ‹¤.
    ```python
    out = df.rolling(index_column="dt", period="2d", closed='left').agg(pl.col("a"))
    print(out)
    ```
    ```python
    shape: (6, 2)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ dt                  β”† a           β”‚
    β”‚ ---                 β”† ---         β”‚
    β”‚ datetime[ΞΌs]        β”† list[i64]   β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2020-01-01 00:00:00 β”† []          β”‚
    β”‚ 2020-01-01 16:42:13 β”† [3]         β”‚
    β”‚ 2020-01-01 16:45:09 β”† [3, 7]      β”‚
    β”‚ 2020-01-02 18:12:48 β”† [3, 7, 5]   β”‚
    β”‚ 2020-01-03 00:00:00 β”† [3, 7, β€¦ 9] β”‚
    β”‚ 2020-01-08 23:16:43 β”† []          β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - `closed="both"` : μ‹μ‘ κ²½κ³„κ°’ β‰¤ time β‰¤ μΆ…λ£ κ²½κ³„κ°’μ΄ λ©λ‹λ‹¤.
    ```python
    out = df.rolling(index_column="dt", period="2d", closed='both').agg(pl.col("a"))
    print(out)
    ```
    ```python
    shape: (6, 2)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ dt                  β”† a           β”‚
    β”‚ ---                 β”† ---         β”‚
    β”‚ datetime[ΞΌs]        β”† list[i64]   β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2020-01-01 00:00:00 β”† [3]         β”‚
    β”‚ 2020-01-01 16:42:13 β”† [3, 7]      β”‚
    β”‚ 2020-01-01 16:45:09 β”† [3, 7, 5]   β”‚
    β”‚ 2020-01-02 18:12:48 β”† [3, 7, β€¦ 9] β”‚
    β”‚ 2020-01-03 00:00:00 β”† [3, 7, β€¦ 2] β”‚
    β”‚ 2020-01-08 23:16:43 β”† [1]         β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```
  - `closed="none"` : μ‹μ‘ κ²½κ³„κ°’ < time < μΆ…λ£ κ²½κ³„κ°’μ΄ λ©λ‹λ‹¤.
    ```python
    out = df.rolling(index_column="dt", period="2d", closed='none').agg(pl.col("a"))
    print(out)
    ```
    ```python
    shape: (6, 2)
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ dt                  β”† a         β”‚
    β”‚ ---                 β”† ---       β”‚
    β”‚ datetime[ΞΌs]        β”† list[i64] β”‚
    β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
    β”‚ 2020-01-01 00:00:00 β”† []        β”‚
    β”‚ 2020-01-01 16:42:13 β”† [3]       β”‚
    β”‚ 2020-01-01 16:45:09 β”† [3, 7]    β”‚
    β”‚ 2020-01-02 18:12:48 β”† [3, 7, 5] β”‚
    β”‚ 2020-01-03 00:00:00 β”† [7, 5, 9] β”‚
    β”‚ 2020-01-08 23:16:43 β”† []        β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    ```

λ‹¤λ¥Έ μ»¬λΌ κ·Έλ£Ήν™”μ™€ κ²°ν•©ν•  μλ„ μμµλ‹λ‹¤. group_byμ— μ»¬λΌλ…μ„ μ…λ ¥ν•μ—¬ μ–΄λ–¤ μ—΄μ„ κΈ°μ¤€μΌλ΅ κ·Έλ£Ήλ³„λ΅ μ§‘κ³„ν• μ§€ μ •ν•  μ μμµλ‹λ‹¤. group_byκ°€ μ „λ‹¬λλ©΄ μ¶λ ¥ κ²°κ³Όλ” κ·Έλ£Ήν™” ν•  μ»¬λΌμ„ κΈ°μ¤€μΌλ΅ κ° κ·Έλ£Ή λ‚΄μ—μ„ μ¤λ¦„μ°¨μμΌλ΅ μ •λ ¬λ©λ‹λ‹¤.

```python
df = df.with_columns(
    pl.Series("groups", ['a', 'b', 'a', 'b', 'a', 'b'])
)
df
```

```

```

```python
out = df.rolling(index_column="dt", period="2d", group_by="groups").agg(pl.col("a"))
print(out)
```

```
shape: (6, 3)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ groups β”† dt                  β”† a         β”‚
β”‚ ---    β”† ---                 β”† ---       β”‚
β”‚ str    β”† datetime[ΞΌs]        β”† list[i64] β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a      β”† 2020-01-01 00:00:00 β”† [3]       β”‚
β”‚ a      β”† 2020-01-01 16:45:09 β”† [3, 5]    β”‚
β”‚ a      β”† 2020-01-03 00:00:00 β”† [5, 2]    β”‚
β”‚ b      β”† 2020-01-01 16:42:13 β”† [7]       β”‚
β”‚ b      β”† 2020-01-02 18:12:48 β”† [7, 9]    β”‚
β”‚ b      β”† 2020-01-08 23:16:43 β”† [1]       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

period λλ” offsetμ— μΈλ±μ¤ μΉ΄μ΄νΈλ¥Ό μ‚¬μ©ν•λ” κ²½μ° index_columnμ— μλ” κ°’μ„ κΈ°μ¤€μΌλ΅ ν•©λ‹λ‹¤.

```python
df = pl.DataFrame({"int": [0, 4, 5, 6, 8], "value": [1, 4, 2, 4, 1]})
print(df.rolling("int", period="3i").agg(pl.col("int").alias("aggregated")))
```

```
shape: (5, 2)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ int β”† aggregated β”‚
β”‚ --- β”† ---        β”‚
β”‚ i64 β”† list[i64]  β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ 0   β”† [0]        β”‚
β”‚ 4   β”† [4]        β”‚
β”‚ 5   β”† [4, 5]     β”‚
β”‚ 6   β”† [4, 5, 6]  β”‚
β”‚ 8   β”† [6, 8]     β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

μΈλ±μ¤ μλ¥Ό ν–‰ λ²νΈλ¥Ό κΈ°μ¤€μΌλ΅ ν•λ ¤λ©΄ rollingκ³Ό with_row_index()λ¥Ό κ²°ν•©ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.

μΈλ±μ¤μ— λ€ν• rollingμ κ²½μ° dtypeμ€ {UInt32, UInt64, Int32, Int64} μ¤‘ ν•λ‚μ΄μ–΄μ•Ό ν•©λ‹λ‹¤. μ²μμ— μΌμ‹μ μΌλ΅ Int64λ΅ ν•λ³€ν™λλ―€λ΅ μ„±λ¥μ΄ μ¤‘μ”ν• κ²½μ° Int64λ΅ μ‚¬μ©ν•΄μ£Όμ‹κΈΈ λ°”λλ‹λ‹¤.

## **2.5 partition_by**

μ§€μ •λ μ—΄μ„ κΈ°μ¤€μΌλ΅ κ·Έλ£Ήν™”ν•κ³  μ—¬λ¬ λ°μ΄ν„°ν”„λ μ„μΌλ΅ λ¶„ν• ν•μ—¬ κ·Έλ£Ήλ³„λ΅ λ°ν™ν•©λ‹λ‹¤.

```python
df = pl.DataFrame(
    {
        "a": ["a", "b", "a", "b", "c"],
        "b": [1, 2, 1, 3, 3],
        "c": [5, 4, 3, 2, 1],
    }
)

print(df.partition_by("a"))
```

- by : κ·Έλ£Ήν™”ν•  μ—΄λ΅ ν•΄λ‹Ή μ—΄μ„ κΈ°μ¤€μΌλ΅ νν‹°μ…μ— λ‹¨μΌ μ—΄ μ΄λ¦„μ„ μ „λ‹¬ν•©λ‹λ‹¤.
- maintain_order : κ·Έλ£Ήμ μμ„κ°€ μ…λ ¥ λ°μ΄ν„°μ™€ μΌμΉν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤. κΈ°λ³Έ λ¶„ν•  μ—°μ‚°λ³΄λ‹¤ λλ¦½λ‹λ‹¤.
- include_key : μ¶λ ¥ κ²°κ³Όμ— λ°μ΄ν„°ν”„λ μ„μ„ λ¶„ν• ν•λ”λ° μ‚¬μ©λλ” μ—΄μ„ ν¬ν•¨ν•©λ‹λ‹¤.
- as_dict : λ¦¬μ¤νΈ λ€μ‹  λ”•μ…”λ„λ¦¬λ¥Ό λ°ν™ν•©λ‹λ‹¤. λ”•μ…”λ„λ¦¬ ν‚¤λ” κ° κ·Έλ£Ήμ„ μ‹λ³„ν•λ” κ³ μ ν• κ·Έλ£Ή κ°’μ νν”μ…λ‹λ‹¤.

```
[shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a   β”† 1   β”† 5   β”‚
β”‚ a   β”† 1   β”† 3   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”,
shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ b   β”† 2   β”† 4   β”‚
β”‚ b   β”† 3   β”† 2   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”,
shape: (1, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ c   β”† 3   β”† 1   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”]
```

μ»¬λΌλ…μ„ λ¦¬μ¤νΈλ¥Ό μ „λ‹¬ν•κ±°λ‚ κ° μ»¬λΌλ…μ„ μμ„λ€λ΅ μ‘μ„±ν•μ—¬ μ—¬λ¬ μ—΄μ„ κΈ°μ¤€μΌλ΅ νν‹°μ…μ„ λ¶„ν• ν•©λ‹λ‹¤.

```
df.partition_by("a", "b")
```

```
[shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a   β”† 1   β”† 5   β”‚
β”‚ a   β”† 1   β”† 3   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”,
shape: (1, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ b   β”† 2   β”† 4   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”,
shape: (1, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ b   β”† 3   β”† 2   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”,
shape: (1, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ c   β”† 3   β”† 1   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”]
```

`as_dict=True`λ¥Ό μ§€μ •ν•μ—¬ νν‹°μ…μ„ λ”•μ…”λ„λ¦¬λ΅ λ°ν™ν•©λ‹λ‹¤.

```
import polars.selectors as cs
df.partition_by(cs.string(), as_dict=True)
```

```
{('a',): shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ a   β”† 1   β”† 5   β”‚
β”‚ a   β”† 1   β”† 3   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”,
('b',): shape: (2, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ b   β”† 2   β”† 4   β”‚
β”‚ b   β”† 3   β”† 2   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”,
('c',): shape: (1, 3)
β”β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”
β”‚ a   β”† b   β”† c   β”‚
β”‚ --- β”† --- β”† --- β”‚
β”‚ str β”† i64 β”† i64 β”‚
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•΅
β”‚ c   β”† 3   β”† 1   β”‚
β””β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”}
```
