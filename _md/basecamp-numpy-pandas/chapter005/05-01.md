---
chapter: Pandas :다섯 번째 걸음
title: 데이터 분석 기법
date: 2024-07-18
---
# 1. 기본 통계량 계산

pandas는 데이터프레임의 기본 통계량을 쉽게 계산할 수 있는 메서드를 제공합니다.

```python-exec
import pandas as pd
import numpy as np

df = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본'],
    '연간_소비량': [5.1, 4.2, 5.9, 2.8, 3.3],
    '카페_수': [25000, 32000, 18000, 12000, 22000]
})

# describe() 메서드를 사용한 종합적인 통계량 계산
print("기본 통계량:")
print(df.describe())

# 개별 통계량 계산
print("\\n개별 통계량:")
print("평균 연간 소비량:", df['연간_소비량'].mean())
print("연간 소비량 중앙값:", df['연간_소비량'].median())
print("연간 소비량 표준편차:", df['연간_소비량'].std())
print("카페 수 최대값:", df['카페_수'].max())
print("카페 수 최소값:", df['카페_수'].min())

# 특정 백분위수 계산
print("\\n75번째 백분위수:")
print(df.quantile(0.75))

# 상관관계 계산
print("\\n상관관계:")
print(df.corr())
```

# 2. 그룹화 연산 (groupby)

groupby 연산은 데이터를 특정 기준에 따라 그룹화하고, 각 그룹에 대해 집계 연산을 수행할 수 있게 해줍니다.

```python-exec
import pandas as pd

df = pd.DataFrame({
    '대륙': ['아시아', '유럽', '아시아', '북미', '유럽', '아시아', '북미', '유럽'],
    '국가': ['한국', '이탈리아', '일본', '미국', '프랑스', '중국', '캐나다', '독일'],
    '연간_소비량': [2.8, 5.9, 3.3, 4.2, 5.4, 3.0, 4.5, 5.8],
    '카페_수': [12000, 18000, 22000, 32000, 15000, 25000, 20000, 16000]
})

# 단일 열 기준 그룹화
print("대륙별 평균 연간 소비량:")
print(df.groupby('대륙')['연간_소비량'].mean())

# 다중 열 기준 그룹화
print("대륙별, 국가별 평균 연간 소비량:")
print(df.groupby(['대륙', '국가'])['연간_소비량'].mean())
```

```python-exec

# 여러 열에 대한 다양한 집계 함수 적용
print("대륙별 다양한 통계량:")
print(df.groupby('대륙').agg({
    '연간_소비량': ['mean', 'max'],
    '카페_수': ['sum', 'min']
}))

# 그룹 내 순위 계산
df['소비량_순위'] = df.groupby('대륙')['연간_소비량'].rank(ascending=False)
print("\\n대륙 내 연간 소비량 순위:")
print(df)
```

# 3. 데이터 집계  aggregate

aggregate 함수는 그룹화된 데이터에 대해 다양한 집계 연산을 수행할 수 있게 해줍니다. 여러 열에 대해 서로 다른 집계 함수를 동시에 적용할 수 있어 유연성이 높습니다.

```python-exec
import pandas as pd
import numpy as np

df = pd.DataFrame({
    '대륙': ['아시아', '유럽', '아시아', '북미', '유럽', '아시아', '북미', '유럽'],
    '국가': ['한국', '이탈리아', '일본', '미국', '프랑스', '중국', '캐나다', '독일'],
    '연간_소비량': [2.8, 5.9, 3.3, 4.2, 5.4, 3.0, 4.5, 5.8],
    '카페_수': [12000, 18000, 22000, 32000, 15000, 25000, 20000, 16000]
})

# 기본 aggregate 사용
print("대륙별 평균 연간 소비량:")
print(df.groupby('대륙')['연간_소비량'].agg('mean'))
```

```python-exec
print("대륙별 연간 소비량 통계:")
print(df.groupby('대륙')['연간_소비량'].agg(['mean', 'median', 'std']))
```

# 4 데이터변환 transform

transform 함수는 그룹 연산의 결과를 원본 데이터프레임의 형태와 크기로 변환하여 반환합니다. 이는 각 그룹의 집계 결과를 해당 그룹의 모든 행에 적용할 때 유용합니다

```python-exec
import pandas as pd
import numpy as np

df = pd.DataFrame({
    '대륙': ['아시아', '유럽', '아시아', '북미', '유럽', '아시아', '북미', '유럽'],
    '국가': ['한국', '이탈리아', '일본', '미국', '프랑스', '중국', '캐나다', '독일'],
    '연간_소비량': [2.8, 5.9, 3.3, 4.2, 5.4, 3.0, 4.5, 5.8],
    '카페_수': [12000, 18000, 22000, 32000, 15000, 25000, 20000, 16000]
})
```

```python-exec
# transform 함수 사용
print("transform을 사용한 대륙별 평균 연간 소비량:")
df['평균_소비량'] = df.groupby('대륙')['연간_소비량'].transform('mean')
print(df)
```

```python-exec
print("\ntransform을 사용한 대륙별 카페 수 합계:")
df['총_카페_수'] = df.groupby('대륙')['카페_수'].transform('sum')
print(df)
```

# 5. 피벗 테이블 (pivot_table)

피벗 테이블은 복잡한 데이터를 보기 쉽게 정리해주는 도구입니다. 엑셀의 피.벗 테이블과 비슷하다고 생각하시면 됩니다. 이 기능을 사용하면 데이터를 원하는 방식으로 재구성할 수 있습니다.

```python-exec
import pandas as pd
import numpy as np

# 샘플 데이터 생성
df = pd.DataFrame({
    '대륙': ['아시아', '유럽', '아시아', '북미', '유럽', '아시아', '북미', '유럽'] * 2,
    '국가': ['한국', '이탈리아', '일본', '미국', '프랑스', '중국', '캐나다', '독일'] * 2,
    '연도': [2022] * 8 + [2023] * 8,
    '연간_소비량': [2.8, 5.9, 3.3, 4.2, 5.4, 3.0, 4.5, 5.8,
                    3.0, 6.1, 3.5, 4.4, 5.6, 3.2, 4.7, 6.0],
    '카페_수': [12000, 18000, 22000, 32000, 15000, 25000, 20000, 16000,
                13000, 19000, 23000, 33000, 16000, 27000, 21000, 17000]
})

print("원본 데이터:")
print(df)

# 피벗 테이블 생성
pivot = pd.pivot_table(df, 
                       values=['연간_소비량', '카페_수'], 
                       index=['대륙', '국가'], 
                       columns='연도', 
                       aggfunc={'연간_소비량': 'mean', '카페_수': 'sum'},
                       fill_value=0)

print("\n피벗 테이블:")
print(pivot)
```

```python-exec
# 특정 값만 선택하여 피벗 테이블 생성
pivot_specific = pd.pivot_table(df, 
                                values='연간_소비량', 
                                index='대륙', 
                                columns='연도', 
                                aggfunc='mean')

print("\n대륙별, 연도별 평균 연간 소비량:")
print(pivot_specific)
```
:::div{.callout}
**Tip !**

피벗 테이블은 복잡한 데이터를 쉽게 정리해주는 도구예요. 예를 들어, 학교 매점에서 판매한 간식 데이터가 있다고 해볼까요? 이 데이터로 피벗 테이블을 만들면 '요일별로 어떤 간식이 가장 잘 팔렸는지' 또는 '학년별로 가장 인기 있는 간식은 무엇인지' 쉽게 알 수 있어요.
 :::

# 5. 크로스탭 (crosstab)

크로스탭은 두 가지 이상의 그룹 간의 관계를 쉽게 볼 수 있게 해주는 도구입니다. 이는 마치 데이터의 '교차점'을 보여주는 표라고 생각하면 됩니다.

```python-exec
import pandas as pd
import numpy as np

# 샘플 데이터 생성
df = pd.DataFrame({
    '대륙': ['아시아', '유럽', '아시아', '북미', '유럽', '아시아', '북미', '유럽'] * 2,
    '국가': ['한국', '이탈리아', '일본', '미국', '프랑스', '중국', '캐나다', '독일'] * 2,
    '연도': [2022] * 8 + [2023] * 8,
    '소비_수준': ['중', '고', '중', '고', '고', '저', '고', '고',
                  '중', '고', '중', '고', '고', '중', '고', '고']
})

print("원본 데이터:")
print(df)

# 기본 크로스탭
cross_tab = pd.crosstab(df['대륙'], df['소비_수준'])

print("\n대륙별 소비 수준 크로스탭:")
print(cross_tab)
```

```python-exec
# 다중 인덱스를 사용한 크로스탭
multi_cross_tab = pd.crosstab([df['대륙'], df['연도']], df['소비_수준'])

print("\n대륙 및 연도별 소비 수준 크로스탭:")
print(multi_cross_tab)
```

```python-exec

# 정규화된 크로스탭 (비율로 표시)
normalized_cross_tab = pd.crosstab(df['대륙'], df['소비_수준'], normalize='index')

print("\n대륙별 소비 수준 비율 크로스탭:")
print(normalized_cross_tab)
```
:::div{.callout}

**Tip !**

로스탭은 두 가지 정보의 관계를 보여주는 표예요. 같은 매점 데이터로 크로스탭을 만들면, '학년별로 선호하는 간식의 종류'를 한눈에 볼 수 있어요.

 :::


 이상으로 pandas를 활용한 다양한 데이터 분석 기법에 대해 살펴보았습니다. 기본 통계량 계산부터 시작하여 그룹화 연산, 데이터 집계 및 변환, 피벗 테이블, 그리고 크로스탭에 이르기까지 각 기법의 특징과 사용법을 알아보았습니다.