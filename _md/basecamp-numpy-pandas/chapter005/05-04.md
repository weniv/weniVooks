---
chapter: Pandas :다섯 번째 걸음
title: 데이터 분석과 시각화 심화
date: 2024-07-23
---

# 데이터 분석 개요

이 분석은 MovieLens 20M 데이터셋을 활용하여 영화 평점 데이터의 다양한 특성을 분석하고, 고급 시각화 기법을 통해 흥미로운 인사이트를 도출합니다. 중급 수준의 데이터 분석 기술과 함께 시각적으로 매력적인 그래프를 제공하여, 데이터의 패턴과 트렌드를 효과적으로 전달합니다.

# 1. 데이터 준비 및 기본 분석

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.express as px
import plotly.graph_objects as go
from wordcloud import WordCloud
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.decomposition import LatentDirichletAllocation
import networkx as nx

# 데이터 로딩
movies = pd.read_csv('movies.csv')
ratings = pd.read_csv('ratings.csv')
tags = pd.read_csv('tags.csv')

# 데이터 전처리
movies['year'] = pd.to_datetime(movies['title'].str.extract('(\(\d{4}\))')[0], format='(%Y)').dt.year
movies['genres'] = movies['genres'].fillna('').str.split('|')
ratings['timestamp'] = pd.to_datetime(ratings['timestamp'], unit='s')

print(movies.info())
print(ratings.info())
print(tags.info())
```

# 2. 평점 분석 및 시각화

## 2.1 평점 분포 (기본 시각화)

```python
plt.figure(figsize=(10, 6))
sns.histplot(ratings['rating'], bins=10, kde=True)
plt.title('Distribution of Movie Ratings')
plt.xlabel('Rating')
plt.ylabel('Count')
plt.show()
```

## 2.2 장르별 평점 분포 (고급 시각화: 바이올린 플롯)

```python
genre_ratings = ratings.merge(movies[['movieId', 'genres']], on='movieId')
genre_ratings = genre_ratings.explode('genres')

plt.figure(figsize=(15, 10))
sns.violinplot(x='genres', y='rating', data=genre_ratings)
plt.xticks(rotation=90)
plt.title('Distribution of Ratings by Genre')
plt.show()
```

# 3. 시계열 분석

## 3.1 시간에 따른 평점 추이 (기본 시각화)

```python
monthly_ratings = ratings.set_index('timestamp').resample('M')['rating'].mean()

plt.figure(figsize=(12, 6))
monthly_ratings.plot()
plt.title('Average Rating Over Time')
plt.xlabel('Date')
plt.ylabel('Average Rating')
plt.show()
```

## 3.2 연도별 개봉 영화 수와 평균 평점 (고급 시각화: 듀얼 축 그래프)

```python
yearly_stats = movies.groupby('year').agg({'movieId': 'count', 'title': 'first'})
yearly_ratings = ratings.merge(movies[['movieId', 'year']], on='movieId').groupby('year')['rating'].mean()
yearly_stats['avg_rating'] = yearly_ratings

fig, ax1 = plt.subplots(figsize=(15, 8))

ax1.set_xlabel('Year')
ax1.set_ylabel('Number of Movies', color='tab:blue')
ax1.plot(yearly_stats.index, yearly_stats['movieId'], color='tab:blue')
ax1.tick_params(axis='y', labelcolor='tab:blue')

ax2 = ax1.twinx()
ax2.set_ylabel('Average Rating', color='tab:orange')
ax2.plot(yearly_stats.index, yearly_stats['avg_rating'], color='tab:orange')
ax2.tick_params(axis='y', labelcolor='tab:orange')

plt.title('Number of Movies Released and Average Rating by Year')
fig.tight_layout()
plt.show()
```

# 4. 장르 분석

## 4.1 장르 분포 (기본 시각화)

```python
genre_counts = movies.explode('genres')['genres'].value_counts()

plt.figure(figsize=(12, 6))
genre_counts.plot(kind='bar')
plt.title('Distribution of Movie Genres')
plt.xlabel('Genre')
plt.ylabel('Count')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()
```

## 4.2 장르 조합의 네트워크 그래프 (고급 시각화)

```python
G = nx.Graph()
for genres in movies['genres']:
    for genre1 in genres:
        G.add_node(genre1)
        for genre2 in genres:
            if genre1 != genre2:
                if G.has_edge(genre1, genre2):
                    G[genre1][genre2]['weight'] += 1
                else:
                    G.add_edge(genre1, genre2, weight=1)

pos = nx.spring_layout(G)
edge_weights = [G[u][v]['weight'] / 50 for u,v in G.edges()]

plt.figure(figsize=(15, 15))
nx.draw(G, pos, with_labels=True, node_color='lightblue', 
        node_size=[v * 100 for v in dict(G.degree()).values()],
        width=edge_weights, edge_color='gray')
plt.title('Genre Combination Network')
plt.show()
```

# 5. 사용자 행동 분석

## 5.1 사용자별 평점 수 분포 (기본 시각화)

```python
user_rating_counts = ratings['userId'].value_counts()

plt.figure(figsize=(10, 6))
sns.histplot(user_rating_counts, bins=50, kde=True)
plt.title('Distribution of Ratings per User')
plt.xlabel('Number of Ratings')
plt.ylabel('Number of Users')
plt.show()
```

## 5.2 평점 히트맵: 요일 vs 시간대 (고급 시각화)

```python
ratings['day_of_week'] = ratings['timestamp'].dt.day_name()
ratings['hour'] = ratings['timestamp'].dt.hour

rating_pivot = ratings.pivot_table(values='rating', index='day_of_week', 
                                   columns='hour', aggfunc='mean')

plt.figure(figsize=(15, 10))
sns.heatmap(rating_pivot, cmap='YlOrRd', annot=True, fmt='.2f')
plt.title('Average Rating Heatmap: Day of Week vs Hour')
plt.show()
```

# 6. 태그 분석

## 6.1 상위 태그 (기본 시각화)

```python
tag_counts = tags['tag'].value_counts().head(20)

plt.figure(figsize=(12, 6))
tag_counts.plot(kind='bar')
plt.title('Top 20 Most Used Tags')
plt.xlabel('Tag')
plt.ylabel('Count')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()
```

## 6.2 연도별 태그 워드클라우드 (고급 시각화)

```python
from ipywidgets import interactive
import ipywidgets as widgets

def plot_wordcloud(year):
    year_tags = tags.merge(movies[['movieId', 'year']], on='movieId')
    year_tags = year_tags[year_tags['year'] == year]
    text = ' '.join(year_tags['tag'])
    wordcloud = WordCloud(width=800, height=400, background_color='white').generate(text)
    
    plt.figure(figsize=(10, 5))
    plt.imshow(wordcloud, interpolation='bilinear')
    plt.axis('off')
    plt.title(f'Movie Tags Wordcloud for Year {year}')
    plt.show()

interactive_plot = interactive(plot_wordcloud, year=widgets.IntSlider(min=1900, max=2024, step=1, value=2000))
display(interactive_plot)
```

# 7. 시계열 예측 모델

간단한 ARIMA 모델을 사용하여 평균 평점을 예측해봅시다.

```python
from statsmodels.tsa.arima.model import ARIMA

# 데이터 준비
data = monthly_ratings.dropna()

# ARIMA 모델 피팅
model = ARIMA(data, order=(1,1,1))
results = model.fit()

# 향후 12개월 예측
forecast = results.forecast(steps=12)

# 결과 시각화
plt.figure(figsize=(12, 6))
data.plot(label='Observed')
forecast.plot(label='Forecast')
plt.title('ARIMA Forecast of Average Ratings')
plt.xlabel('Date')
plt.ylabel('Average Rating')
plt.legend()
plt.show()
```

# 8. 결론

이 종합적인 분석을 통해 MovieLens 20M 데이터셋의 다양한 측면을 살펴보았습니다. 기본적인 통계 분석부터 시작하여 시간에 따른 트렌드, 장르 간 관계, 사용자 행동 패턴, 그리고 태그 사용의 변화까지 다각도로 데이터를 분석했습니다.

특히, 고급 시각화 기법을 활용하여 데이터의 숨겨진 패턴을 효과적으로 표현했습니다. 장르 조합의 네트워크 그래프, 평점 히트맵, 그리고 연도별 태그 워드클라우드 등은 데이터를 새로운 관점에서 바라볼 수 있게 해주었습니다.

이러한 분석 결과는 영화 추천 시스템 개발, 영화 산업 트렌드 파악, 사용자 행동 이해 등에 유용하게 활용될 수 있습니다. 더 나아가 고급 머신러닝 모델을 적용하여 개인화된 영화 추천이나 더 정확한 평점 예측 등을 수행할 수 있을 것입니다.
