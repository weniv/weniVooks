---
chapter: Pandas :네 번째 걸음
title: Pandas DataFrame 
date: 2024-07-17
---
# 1. 데이터프레임이란?
![피그잼](/images/essentials-numpy-pandas/chapter04/dataframe.png )

데이터프레임은 데이터 분석과 과학 분야에서 널리 사용되는 강력한 도구입니다. 이는 복잡한 데이터셋을 직관적이고 효율적으로 다룰 수 있게 해줍니다. 데이터프레임의 각 열은 일종의 시리즈(Series)로, 하나의 데이터 타입을 가집니다. 예를 들어, 한 열은 정수형, 다른 열은 문자열, 또 다른 열은 날짜 형식을 가질 수 있습니다. 데이터프레임의 인덱싱 시스템은 매우 유연합니다. 기본적으로 0부터 시작하는 정수 인덱스를 사용하지만, 사용자가 원하는 대로 커스텀 인덱스를 지정할 수 있습니다. 예를 들어, 날짜를 인덱스로 사용하여 시계열 데이터를 쉽게 다룰 수 있습니다.

```python
import pandas as pd
import numpy as np

np.random.seed(42)  # 재현 가능한 결과를 위해 시드 설정

df = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본', '프랑스', '독일', '캐나다', '호주', '스페인'],
    '연간_소비량_kg': np.random.uniform(2.0, 8.0, 10).round(1),
    '선호_종류': ['에스프레소', '아메리카노', '카푸치노', '카페라떼', '드립커피', '카페오레', '모카', '플랫화이트', '콜드브루', '마키아토'],
    '카페_수': np.random.randint(10000, 50000, 10),
    '평균_가격_달러': np.random.uniform(1.5, 5.0, 10).round(2),
    '커피_수입량_톤': np.random.randint(100000, 1000000, 10),
    '로스터리_수': np.random.randint(50, 500, 10),
    '커피_농장_면적_헥타르': [1500000, 0, 500000, 0, 0, 0, 0, 0, 0, 100000],
    '바리스타_인구': np.random.randint(5000, 100000, 10),
    '연간_카페인_섭취량_mg': np.random.randint(100000, 300000, 10)
})

print(df)
```

(출력결과: 사진)

# 2. DataFrame의 Index(인덱스)

DataFrame의 인덱스는 각 행을 고유하게 식별하는 레이블입니다. 인덱스는 데이터의 위치를 나타내며, 이를 통해 데이터를 빠르고 쉽게 검색, 정렬, 그리고 조작할 수 있습니다. DataFrame에는 명시적 인덱스와 묵시적 인덱스 총 두 가지 유형의 인덱스가 있습니다.

### 2.1 명시적 인덱스(Explicit Index)

명시적 인덱스는 사용자가 직접 지정한 인덱스입니다. 이는 데이터에 의미 있는 레이블을 부여하여 데이터의 해석과 관리를 용이하게 합니다. 예를 들어, 시계열 데이터의 경우 날짜를 인덱스로 사용하거나, 고유한 ID를 인덱스로 사용할 수 있습니다.

```python
# 명시적 인덱스를 가진 데이터프레임 생성
df_explicit = pd.DataFrame({
    '연간_소비량': [5.1, 4.2, 5.9, 2.8, 3.3, 5.4]
}, index=['브라질', '미국', '이탈리아', '한국', '일본', '프랑스'])

print(df_explicit)
```

### 2.2 묵시적 인덱스 (Implicit Index)

묵시적 인덱스는 DataFrame 생성 시 사용자가 별도로 인덱스를 지정하지 않았을 때 자동으로 생성되는 인덱스입니다. 이때 생성되는 인덱스의 기본 타입은 RangeIndex로, 0부터 시작하는 정수 인덱스입니다.  

### 

```python
# 현재 데이터프레임 출력 (묵시적 인덱스 사용 중)
print("묵시적 인덱스를 사용한 데이터프레임:")
print(df)
print("\n첫 번째 행 데이터:")
print(df.iloc[0])

```

## 2.3 데이터 프레임 변형 (pivot)

pivot 함수는 데이터프레임의 구조를 변경하여 특정 열의 고유한 값들을 새로운 열로 변환합니다. 이는 데이터를 더 넓은 형태로 재구성하는 데 유용합니다.

```python
# pivot을 사용하여 데이터 변형
df_pivot = df.pivot(index='국가', columns='연도', values='커피_소비량')

print("\npivot 후 데이터프레임:")
print(df_pivot)
```

### 2.4 데이터 프레임 변형 (melt)

melt 함수는 pivot의 반대 개념으로, "넓은" 형태의 데이터를 "긴" 형태로 변환합니다. 이는 여러 열을 두 개의 열(변수명과 값)로 재구성하는 데 사용됩니다.

```python
import pandas as pd

# 먼저, 넓은 형태의 데이터프레임 생성
df_wide = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본', '프랑스'],
    '2022': [5.1, 4.2, 5.9, 2.8, 3.3, 5.4],
    '2023': [5.3, 4.3, 6.1, 2.9, 3.4, 5.5]
})

print("원본 데이터프레임 (넓은 형태):")
print(df_wide)
```

```python
# melt를 사용하여 데이터 변형
df_melted = pd.melt(df_wide, 
                    id_vars=['국가'], 
                    var_name='연도', 
                    value_name='커피_소비량')

print("\nmelt 후 데이터프레임 (긴 형태):")
print(df_melted)
```

# **3. DataFrame의 데이터 접근**

DataFrame의 데이터 조회란 DataFrame 내의 특정 데이터를 선택하고 접근하는 과정을 말합니다. 이는 원하는 행, 열, 또는 특정 조건을 만족하는 데이터를 추출하거나 볼 수 있게 해주는 작업입니다. 데이터 조회는 데이터 분석의 기초가 되며, 효율적인 데이터 처리를 위해 필수적인 기술입니다.

### 3.1 loc(Label-based indexing)

loc 메서드는 DataFrame에서 라벨 기반 인덱싱을 사용하여 데이터에 접근하는 강력한 도구입니다. 이 방법을 사용하면 행과 열의 이름을 직접 지정하여 원하는 데이터를 쉽게 선택할 수 있습니다. 특히 문자열로 된 열 이름이나 인덱스를 다룰 때 매우 편리합니다. loc는 불리언 인덱싱도 지원하여 특정 조건을 만족하는 데이터만 골라내는 것도 간단합니다. 범위를 지정할 때는 시작점과 끝점을 모두 포함하는 특징이 있어, 원하는 데이터 구간을 정확히 선택할 수 있습니다. 또한, 여러 조건을 조합한 복잡한 데이터 선택도 가능해 데이터 분석 시 다양한 상황에 유연하게 대처할 수 있습니다.

```python
import pandas as pd
import numpy as np

np.random.seed(42)  # 재현 가능한 결과를 위해 시드 설정

df = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본', '프랑스', '독일', '캐나다', '호주', '스페인'],
    '연간_소비량_kg': np.random.uniform(2.0, 8.0, 10).round(1),
    '선호_종류': ['에스프레소', '아메리카노', '카푸치노', '카페라떼', '드립커피', '카페오레', '모카', '플랫화이트', '콜드브루', '마키아토'],
    '카페_수': np.random.randint(10000, 50000, 10),
    '평균_가격_달러': np.random.uniform(1.5, 5.0, 10).round(2),
    '커피_수입량_톤': np.random.randint(100000, 1000000, 10),
    '로스터리_수': np.random.randint(50, 500, 10),
    '커피_농장_면적_헥타르': [1500000, 0, 500000, 0, 0, 0, 0, 0, 0, 100000],
    '바리스타_인구': np.random.randint(5000, 100000, 10),
    '연간_카페인_섭취량_mg': np.random.randint(100000, 300000, 10)
})

print("\n모든 국가의 연간 소비량과 선호 종류:")
print(df.loc[:, ['국가', '연간_소비량_kg', '선호_종류']])
```

### 3.2 iloc (Integer-based indexing)

정수 인덱스를 사용합니다. 즉, 행과 열의 번호로 데이터에 접근합니다. 0부터 시작하는 인덱스를 사용합니다. 파이썬의 일반적인 슬라이싱 규칙을 따릅니다 (끝 인덱스는 포함되지 않습니다). 위치 기반으로 데이터를 빠르게 선택할 수 있습니다. 특정 범위의 행과 열을 쉽게 선택할 수 있습니다

```python
print("\n3번째 행, 4번째 열의 값:")
print(df.iloc[2, 3])
```

### 3.3 at를 사용한 데이터 접근

at는 loc의 스칼라 버전으로, 단일 값에 접근할 때 사용됩니다. loc와 마찬가지로 라벨 기반 인덱싱을 사용하지만, 단일 요소에 대해 더 빠른 성능을 제공합니다. 특정 행과 열의 교차점에 있는 하나의 값을 빠르게 가져오거나 설정할 때 유용합니다.

```python
import pandas as pd
import numpy as np

np.random.seed(42)  # 재현 가능한 결과를 위해 시드 설정

df = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본', '프랑스', '독일', '캐나다', '호주', '스페인'],
    '연간_소비량_kg': np.random.uniform(2.0, 8.0, 10).round(1),
    '선호_종류': ['에스프레소', '아메리카노', '카푸치노', '카페라떼', '드립커피', '카페오레', '모카', '플랫화이트', '콜드브루', '마키아토'],
    '카페_수': np.random.randint(10000, 50000, 10),
    '평균_가격_달러': np.random.uniform(1.5, 5.0, 10).round(2),
    '커피_수입량_톤': np.random.randint(100000, 1000000, 10),
    '로스터리_수': np.random.randint(50, 500, 10),
    '커피_농장_면적_헥타르': [1500000, 0, 500000, 0, 0, 0, 0, 0, 0, 100000],
    '바리스타_인구': np.random.randint(5000, 100000, 10),
    '연간_카페인_섭취량_mg': np.random.randint(100000, 300000, 10)
})

df.at[1, '평균_가격_달러'] = 5.5

print("\n미국의 수정된 평균 가격:")
print(df.at[1, '평균_가격_달러'])
```

### 3.4 iat를 사용한 데이터 접근

iat는 DataFrame이나 Series에서 단일 값에 접근할 때 사용하는 메서드로, 순수하게 정수 위치 기반 인덱싱만을 지원합니다. iloc의 스칼라 버전으로 볼 수 있으며, 오직 정수 인덱스만을 받아들입니다.

```python
df.iat[2, 3] = 40000
print("\n세 번째 행, 네 번째 열(카페 수)의 수정된 값:")
print(df.iat[2, 3])
```

### 3.5 다중 조건 인덱싱

다중 조건 인덱싱은 여러 조건을 동시에 적용하여 DataFrame에서 특정 데이터를 선택하는 방법입니다. 이 방법은 복잡한 조건을 사용하여 데이터를 필터링할 때 매우 유용합니다. 주로 loc와 함께 사용되며, 불리언 연산자를 활용하여 여러 조건을 결합합니다.

다중 조건을 사용할 때는 각 조건을 괄호로 묶고, 논리 연산자(&: 그리고, |: 또는)를 사용하여 조건들을 연결합니다. 이를 통해 매우 구체적인 데이터 서브셋을 추출할 수 있습니다.

```python
# 예시 1: 연간 소비량이 5kg 이상이고 평균 가격이 3달러 미만인 국가 조회
condition1 = (df['연간_소비량_kg'] >= 5) & (df['평균_가격_달러'] < 3)
result1 = df.loc[condition1, ['국가', '연간_소비량_kg', '평균_가격_달러']]
print("연간 소비량 5kg 이상, 평균 가격 3달러 미만인 국가:")
print(result1)

# 예시 2: 커피 농장이 있고(면적 > 0) 카페 수가 30,000개 이상인 국가 조회
condition2 = (df['커피_농장_면적_헥타르'] > 0) & (df['카페_수'] >= 30000)
result2 = df.loc[condition2, ['국가', '커피_농장_면적_헥타르', '카페_수']]
print("\n커피 농장이 있고 카페 수가 30,000개 이상인 국가:")
print(result2)
```

# 4. DataFrame 행, 열

DataFrame의 Column(열)은 세로로 늘어선 데이터의 집합으로, 각 열은 특정 속성이나 변수를 나타냅니다. 각 열은 고유한 이름(라벨)을 가지며, 동일한 데이터 타입을 갖는 것이 일반적입니다. Row(행)는 가로로 늘어선 데이터의 집합으로, 각 행은 하나의 관측치 또는 레코드를 나타냅니다.

## 4.1 DataFrame 행과 열 조회

DataFrame에서 데이터를 조회할 때는 행과 열 모두에 접근할 수 있습니다. 열 조회는 주로 열 이름을 사용하며, 행 조회는 인덱스나 위치를 사용합니다. 특정 조건에 맞는 데이터를 선택적으로 조회할 수도 있습니다.

### 4.1.1 특정 열 조회

```python
import pandas as pd
import numpy as np

np.random.seed(42)  # 재현 가능한 결과를 위해 시드 설정

df = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본', '프랑스', '독일', '캐나다', '호주', '스페인'],
    '연간_소비량_kg': np.random.uniform(2.0, 8.0, 10).round(1),
    '선호_종류': ['에스프레소', '아메리카노', '카푸치노', '카페라떼', '드립커피', '카페오레', '모카', '플랫화이트', '콜드브루', '마키아토'],
    '카페_수': np.random.randint(10000, 50000, 10),
    '평균_가격_달러': np.random.uniform(1.5, 5.0, 10).round(2),
    '커피_수입량_톤': np.random.randint(100000, 1000000, 10),
    '로스터리_수': np.random.randint(50, 500, 10),
    '커피_농장_면적_헥타르': [1500000, 0, 500000, 0, 0, 0, 0, 0, 0, 100000],
    '바리스타_인구': np.random.randint(5000, 100000, 10),
    '연간_카페인_섭취량_mg': np.random.randint(100000, 300000, 10)
})

# '국가'와 '연간_소비량_kg' 열 조회
print(df[['국가', '연간_소비량_kg']])
```

### 4.1.2 조건을 사용한 행 조회:

```python
# 연간 소비량이 5kg 이상인 국가 조회
print(df[df['연간_소비량_kg'] >= 5])
```

### 4.1.3 loc를 사용한 레이블 기반 인덱싱

```python
# '브라질'의 모든 정보 조회
print(df.loc[df['국가'] == '브라질'])
```

### 4.1.4 iloc를 사용한 정수 위치 기반 인덱싱

```python
# 처음 3개 행과 처음 4개 열 조회
print(df.iloc[:3, :4])
```

### 4.1.5 특정 조건을 만족하는 행에서 특정 열만 조회

```python
# 카페 수가 50,000개 이상인 국가의 이름과 카페 수 조회
print(df.loc[df['카페_수'] >= 50000, ['국가', '카페_수']])
```

# 5. DataFrame의 통계 및 연산

DataFrame의 통계 및 연산 기능은 데이터 분석에서 핵심적인 역할을 합니다. 이를 통해 데이터의 특성을 파악하고, 유용한 인사이트를 얻을 수 있습니다.

## 5.1 describe()

describe() 메서드는 pandas에서 데이터의 주요 통계 정보를 한눈에 파악할 수 있게 해주는 강력한 도구입니다. 이 메서드는 데이터프레임이나 시리즈에 적용되어 수치형 데이터의 중심 경향성, 분산, 분포 등을 요약해줍니다. 수치형 열에 대해서는 개수, 평균, 표준편차, 최솟값, 1사분위수(25%), 중앙값(50%), 3사분위수(75%), 최댓값을 계산하여 보여줍니다. 이를 통해 데이터의 전반적인 특성을 빠르게 이해할 수 있으며, 이상치의 존재 여부나 데이터의 대략적인 분포를 파악할 수 있습니다.

```python
import pandas as pd
import numpy as np

np.random.seed(42)  

df = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본', '프랑스', '독일', '캐나다', '호주', '스페인'],
    '연간_소비량_kg': np.random.uniform(2.0, 8.0, 10).round(1),
    '선호_종류': ['에스프레소', '아메리카노', '카푸치노', '카페라떼', '드립커피', '카페오레', '모카', '플랫화이트', '콜드브루', '마키아토'],
    '카페_수': np.random.randint(10000, 50000, 10),
    '평균_가격_달러': np.random.uniform(1.5, 5.0, 10).round(2),
    '커피_수입량_톤': np.random.randint(100000, 1000000, 10),
    '로스터리_수': np.random.randint(50, 500, 10),
    '커피_농장_면적_헥타르': [1500000, 0, 500000, 0, 0, 0, 0, 0, 0, 100000],
    '바리스타_인구': np.random.randint(5000, 100000, 10),
    '연간_카페인_섭취량_mg': np.random.randint(100000, 300000, 10)
})

print("기본 통계 요약:")
print(df.describe())

# 특정 백분위수 추가
print("특정 백분위수를 포함한 통계 요약:")
print(df.describe(percentiles=[.05, .25, .75, .95]))
```

### 5.2  그룹별 연산

groupby() 메서드는 데이터를 특정 기준에 따라 그룹으로 나누고, 각 그룹에 대해 연산을 수행할 수 있게 해주는 강력한 도구입니다. 이 메서드는 "split-apply-combine" 전략을 따르는데, 이는 데이터를 그룹으로 나누고(split), 각 그룹에 함수를 적용한 다음(apply), 결과를 하나의 데이터 구조로 결합(combine)하는 과정을 의미합니다.

```python
import pandas as pd
import numpy as np

np.random.seed(42)

df = pd.DataFrame({
    '국가': ['브라질', '미국', '이탈리아', '한국', '일본', '프랑스', '독일', '캐나다', '호주', '스페인'],
    '연간_소비량_kg': np.random.uniform(2.0, 8.0, 10).round(1),
    '선호_종류': ['에스프레소', '아메리카노', '카푸치노', '카페라떼', '드립커피', '카페오레', '모카', '플랫화이트', '콜드브루', '마키아토'],
    '카페_수': np.random.randint(10000, 50000, 10),
    '평균_가격_달러': np.random.uniform(1.5, 5.0, 10).round(2),
    '커피_수입량_톤': np.random.randint(100000, 1000000, 10),
    '로스터리_수': np.random.randint(50, 500, 10),
    '커피_농장_면적_헥타르': [1500000, 0, 500000, 0, 0, 0, 0, 0, 0, 100000],
    '바리스타_인구': np.random.randint(5000, 100000, 10),
    '연간_카페인_섭취량_mg': np.random.randint(100000, 300000, 10)
})

# 카페인 섭취량을 기준으로 국가 분류
df['카페인_섭취_수준'] = pd.qcut(df['연간_카페인_섭취량_mg'], q=3, labels=['낮음', '중간', '높음'])

grouped_caffeine = df.groupby('카페인_섭취_수준').agg({
    '연간_소비량_kg': 'mean',
    '카페_수': 'mean',
    '평균_가격_달러': 'mean',
    '바리스타_인구': 'mean'
}).round(2)

print("카페인 섭취 수준에 따른 분석:")
print(grouped_caffeine)
```

pandas의 DataFrame 핵심 개념과 주요 기능을 살펴보았습니다. DataFrame의 기본 구조와 생성 방법, 인덱싱과 데이터 접근 기법, 데이터 조작 및 변환 방법, 기본적인 통계 분석과 그룹 연산에 대해 학습하였습니다.
이러한 기능들은 실제 데이터 분석 과정에서 필수적으로 활용되는 도구입니다. pandas DataFrame은 데이터 과학과 분석 분야에서 광범위하게 사용되는 강력한 도구이며, 이를 숙달함으로써 효과적인 데이터 처리와 인사이트 도출이 가능해집니다.