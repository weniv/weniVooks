---
chapter: 비동기 프로그래밍
title: fetch와 async, await
date: 2024-04-04
---

# 1. fetch

fetch는 자바스크립트에서 제공하는 비동기 통신 API입니다. 이를 사용하면 서버에 네트워크 요청을 보내고 새로운 정보를 받아올 수 있습니다. Promise를 기반으로 구현되어 있어, `.then()`이나 `.catch()`를 통해 응답을 처리할 수 있습니다.

예제 코드에서는 `fetch()`를 사용하여 [http://test.api.weniv.co.kr/mall](http://test.api.weniv.co.kr/mall)에 GET 요청을 보내고, 응답 데이터를 받아와 다양한 방식으로 처리하는 과정을 보여줍니다. 응답 데이터는 `.json()` 메서드를 통해 자바스크립트 객체로 변환됩니다.

이후 `.then()`을 연쇄적으로 사용하여 데이터를 가공하는 과정을 거칩니다. 상품명 출력, 가격 필터링, DOM 요소 생성 및 화면 출력 등의 작업을 수행합니다. `.catch()`를 통해 에러 처리도 이루어집니다.

fetch는 네트워크 요청을 간편하게 처리할 수 있는 강력한 도구이며, 현대 자바스크립트에서 널리 사용되고 있습니다.

## 1.1 fetch로 쇼핑몰 데이터 받기

```jsx
fetch('http://test.api.weniv.co.kr/mall')
  .then((productData) => productData.json())
  .then((productData) => productData)
  .then((productData) => {
    console.log(productData.map((item) => item.productName));
    return productData;
  })
  .then((productData) => {
    const main = document.createElement('main');
    productData.forEach((item) => {
      const ProductCard = document.createElement('article');
      const productName = document.createElement('h2');
      const productPrice = document.createElement('p');

      productName.textContent = `상품명 : ${item.productName}`;
      productPrice.textContent = `가격 : ${item.price}`;

      ProductCard.appendChild(productName);
      ProductCard.appendChild(productPrice);

      main.appendChild(ProductCard);
    });
    document.body.appendChild(main);
  })
  .catch((error) => {
    alert('에러!');
    // error page로 리다이렉트
    console.log(error);
  });
```

# 2. async, await(에이씽크, 어웨잇)

async/await는 비동기 코드를 작성하는 새로운 방법입니다. 기존의 비동기 처리 방식인 콜백이나 프로미스와는 다르게, 동기 코드처럼 보이게 작성할 수 있어 더 읽기 쉽고 이해하기 쉽습니다.

함수 앞에 `async` 키워드를 붙이면 해당 함수는 항상 프로미스를 반환합니다. 함수 내부에서 `await` 키워드를 사용하면, 프로미스가 처리될 때까지 함수 실행을 일시 중지시키고, 결과 값을 반환합니다.

예제 코드에서 `async function getData()`는 비동기 함수를 정의합니다. 함수 내부에서 `await fetch()`를 사용하여 네트워크 요청을 보내고, 응답을 받아올 때까지 기다립니다. 이후 `await response.json()`을 통해 응답 데이터를 자바스크립트 객체로 변환합니다.

이렇게 async/await를 사용하면 비동기 코드를 마치 동기 코드처럼 작성할 수 있어, 코드의 가독성과 유지보수성이 크게 향상됩니다. 에러 처리도 일반 try/catch문을 사용할 수 있어 더 간편해집니다.

async/await는 ES2017에서 도입된 문법으로, 현대 자바스크립트에서 비동기 프로그래밍의 핵심으로 자리잡았습니다.

## 2.1 async, await 간단한 예제

async, await async/await를 사용한 간단한 예제를 살펴보겠습니다. 사용자 정보를 가져오는 비동기 함수를 작성해보죠.

```jsx
function fetchUser(userId) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      const user = {
        userId: userId,
        username: 'john-doe',
      };
      resolve(user);
    }, 1000);
  });
}

async function getUserInfo(userId) {
  try {
    const user = await fetchUser(userId);
    console.log(user.username);
  } catch (error) {
    console.error(error);
  }
}

getUserInfo(1);
```

위 코드에서 `fetchUser`는 프로미스를 반환하는 함수입니다. 사용자 ID를 인자로 받아 임의의 사용자 정보를 반환하는데, 1초의 지연 시간을 둡니다.

`getUserInfo`는 async 함수로 선언되었습니다. 내부에서 `await fetchUser(userId)`를 호출하여 사용자 정보를 가져오고, 이를 `user` 변수에 할당합니다. 이 때 `fetchUser`가 실행되고 프로미스가 처리될 때까지 `getUserInfo` 함수의 실행은 일시 중지됩니다.

사용자 정보를 성공적으로 받아오면 `user.username`을 출력합니다. 에러가 발생한 경우 `catch` 블록에서 에러를 처리할 수 있습니다.

마지막으로 `getUserInfo(1)`을 호출하여 비동기 함수를 실행합니다.

이처럼 async/await을 사용하면 비동기 코드를 동기 코드처럼 작성할 수 있어 더 직관적이고 이해하기 쉽습니다. 또한 에러 처리도 try/catch 문을 사용하여 간편하게 할 수 있습니다.

## 2.2 async, await으로 쇼핑몰 데이터 받기

```jsx
async function getData() {
  const response = await fetch(`http://test.api.weniv.co.kr/mall`);
  const productData = await response.json();
  console.log(productData);
  console.log(productData.map((item) => item.productName));
  console.log(
    productData.map((item) => item.price).filter((item) => item > 10000),
  );

  const main = document.createElement('main');
  productData.forEach((item) => {
    const ProductCard = document.createElement('article');
    const productName = document.createElement('h2');
    const productPrice = document.createElement('p');

    productName.textContent = `상품명 : ${item.productName}`;
    productPrice.textContent = `가격 : ${item.price}`;

    ProductCard.appendChild(productName);
    ProductCard.appendChild(productPrice);

    main.appendChild(ProductCard);
  });
  document.body.appendChild(main);
}

getData();
```

---

**참고자료**

::a[8. 비동기(콜백함수, 프로미스, await/async, fetch)]{class="btn-link" href="https://www.notion.so/8-await-async-fetch-835e5806f6be444aa02ccfd38cb7a9b7?pvs=21" target="\_blank"}
::a[알잘딱깔센 JavaScript 비동기 프로그래밍 - 비동기 너 내 동기가 돼라]{class="btn-link" href="https://www.notion.so/JavaScript-e171d97722484860aa5b162afae83cb1?pvs=21" target="\_blank"}
