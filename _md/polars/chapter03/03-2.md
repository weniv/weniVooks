---
chapter: 데이터 구조
title: DataFrame(데이터프레임)
date: 2024-06-20
---

# **2. DataFrame(데이터프레임)**

## 2.1 DataFrame이란?

`데이터프레임(DataFrame)`은 여러 개의 행과 열(Column)로 이루어진 테이블 형태로 데이터를 나타내는 2차원 데이터 배열 구조로 데이터 조작 및 분석에 유용합니다. 엑셀과 유사한 형태로 이루어져 있어 표 형태의 데이터를 다루기에 적합한 자료구조입니다.

행과 열에 레이블이 지정된 축을 사용하면 각 열에 다양한 데이터 유형이 포함될 수 있으므로 병합 및 집계와 같은 복잡한 데이터 작업이 훨씬 쉬워집니다.

DataFrame은 유연하고 직관적인 데이터 저장 및 작업 방식으로 인해 현대 데이터 분석에서 인기를 얻고 있습니다.

데이터프레임에서는 SQL과 유사한 쿼리를 수행할 수 있습니다. group_by, join, pivot을 할 수 있을 뿐만 아니라 사용자 정의 함수도 정의할 수 있습니다.

## **2.2** DataFrame 생성

### 2.2.1 Dictionary로 생성하기

```python
from datetime import datetime

data = {
    "integer": [1, 2, 3, 4, 5],
    "date": [
        datetime(2022, 1, 1),
        datetime(2022, 1, 2),
        datetime(2022, 1, 3),
        datetime(2022, 1, 4),
        datetime(2022, 1, 5),
    ],
    "float": [4.0, 5.0, 6.0, 7.0, 8.0],
    "string": ["a", "b", "c", "d", "e"],
}

# 데이터프레임 생성하기
df = pl.DataFrame(data)
print(df)
```

데이터프레임은 시리즈를 기반으로 하는 2차원 데이터 구조이며, 시리즈의 한 컬렉션(예: 리스트)을 추상화한 것으로 볼 수 있습니다.

- `pl.DataFrame(데이터)` : DataFrame을 정의할 수 있습니다.
  - 데이터 : 딕셔너리, numpy 배열, 시리즈 형태의 2차원 데이터를 넣어 데이터 프레임을 생성할 수 있습니다.

```
shape: (5, 4)
┌─────────┬─────────────────────┬───────┬────────┐
│ integer ┆ date                ┆ float ┆ string │
│ ---     ┆ ---                 ┆ ---   ┆ ---    │
│ i64     ┆ datetime[μs]        ┆ f64   ┆ str    │
╞═════════╪═════════════════════╪═══════╪════════╡
│ 1       ┆ 2022-01-01 00:00:00 ┆ 4.0   ┆ a      │
│ 2       ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b      │
│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   ┆ c      │
│ 4       ┆ 2022-01-04 00:00:00 ┆ 7.0   ┆ d      │
│ 5       ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e      │
└─────────┴─────────────────────┴───────┴────────┘
```

### 2.2.2 Series 리스트로 생성하기

```python
data = [
    pl.Series("col1", [1, 2], dtype=pl.Float32),
    pl.Series("col2", [3, 4], dtype=pl.Int64),
]
df2 = pl.DataFrame(data)
print(df2)
```

```python
shape: (2, 2)
┌──────┬──────┐
│ col1 ┆ col2 │
│ ---  ┆ ---  │
│ f32  ┆ i64  │
╞══════╪══════╡
│ 1.0  ┆ 3    │
│ 2.0  ┆ 4    │
└──────┴──────┘
```

### 2.2.3 중첩 리스트로 생성하기

중첩리스트 형태로 생성하고 스키마 설정하여 열 이름 지정합니다.

```python
data = [[1, 2, 3], [4, 5, 6]]
df3 = pl.DataFrame(data, schema=["a", "b", "c"])
print(df3)
```

```python
shape: (2, 3)
┌─────┬─────┬─────┐
│ a   ┆ b   ┆ c   │
│ --- ┆ --- ┆ --- │
│ i64 ┆ i64 ┆ i64 │
╞═════╪═════╪═════╡
│ 1   ┆ 2   ┆ 3   │
│ 4   ┆ 5   ┆ 6   │
└─────┴─────┴─────┘
```

### 2.2.4 데이터 타입(dtypes)

데이터 타입은 데이터프레임을 출력할 때 열 헤더에서 찾을 수 있습니다. dtypes으로 데이터프레임 안에 있는 데이터 타입(자료형)을 차례대로 뽑아낼 수 있습니다.

```python
print(df.dtypes)
```

```python
[Int64, Datetime(time_unit='us', time_zone=None), Float64, Utf8]
```

schema로도 컬럼명과 데이터 타입을 같이 확인할 수 있으며, 튜플 형태로 (컬럼명, 데이터 타입)으로 출력됩니다.

```python
print(df.schema)
```

```python
OrderedDict([('integer', Int64), ('date', Datetime(time_unit='us', time_zone=None)), ('float', Float64), ('string', Utf8)])
```

데이터프레임 생성시에 스키마를 이용하여 열의 타입을 지정할 수도 있습니다.

1. **{name:type}의 딕셔너리 형태**

   - 데이터 타입이 None이면 자동 추론됩니다.

   ```python
   data = {"col1": [0, 2], "col2": [3, 7]}
   df4 = pl.DataFrame(data, schema={"col1": pl.Float32, "col2": pl.Int64})
   print(df4)
   ```

   ```python
   shape: (2, 2)
   ┌──────┬──────┐
   │ col1 ┆ col2 │
   │ ---  ┆ ---  │
   │ f32  ┆ i64  │
   ╞══════╪══════╡
   │ 0.0  ┆ 3    │
   │ 2.0  ┆ 7    │
   └──────┴──────┘
   ```

2. **(name:type) 리스트 형태**

   - 데이터 타입이 None이면 자동 추론됩니다.

   ```python
   df5 = pl.DataFrame(data, schema=[("col1", pl.Float32), ("col2", pl.Int64)])
   print(df5)
   ```

   ```python
   shape: (2, 2)
   ┌──────┬──────┐
   │ col1 ┆ col2 │
   │ ---  ┆ ---  │
   │ f32  ┆ i64  │
   ╞══════╪══════╡
   │ 0.0  ┆ 3    │
   │ 2.0  ┆ 7    │
   └──────┴──────┘
   ```

3. **열 이름을 리스트로 지정한 경우**

   - 데이터 타입은 자동으로 유추됩니다.

   ```python
   data = np.array([(1, 2), (3, 4)], dtype=np.int64)
   df6 = pl.DataFrame(data, schema=["a", "b"], orient="col")
   print(df6)
   ```

   - orient
     - col(기본값) : 열을 기준으로 해석합니다.
     - row : 행을 기준으로 해석합니다.

   ```python
   shape: (2, 2)
   ┌─────┬─────┐
   │ a   ┆ b   │
   │ --- ┆ --- │
   │ i64 ┆ i64 │
   ╞═════╪═════╡
   │ 1   ┆ 3   │
   │ 2   ┆ 4   │
   └─────┴─────┘
   ```

기본 데이터의 이름과 일치하지 않는 열 이름 목록을 제공하면 제공된 이름이 해당 목록을 덮어씁니다. 스키마에 제공된 이름의 수는 데이터 차원 수와 일치해야 합니다. 기본값으로 설정하면 `None` 데이터에서 스키마가 추론됩니다.

## 2.3 데이터 살펴보기

데이터프레임의 데이터를 보는 방법을 알아봅시다. 이전 예시의 데이터프레임을 살펴보도록 하겠습니다.

### **2.3.1** 상단 값으로 데이터 확인**(Head)**

head 함수는 기본적으로 데이터프레임의 처음 5행을 가져옵니다. 아래 주석으로 된 코드와 같이 출력하고 싶은 행의 수를 지정할 수 있습니다.

```python
print(df.head())
# print(df.head(3))
# print(df.head(-3))
```

- **head(n)**: DataFrame의 처음부터 n개의 행을 출력합니다. 음수 값이 전달되면 마지막 절댓값 n행을 제외한 모든 행을 반환합니다.

```python
shape: (5, 4)
┌─────────┬─────────────────────┬───────┬────────┐
│ integer ┆ date                ┆ float ┆ string │
│ ---     ┆ ---                 ┆ ---   ┆ ---    │
│ i64     ┆ datetime[μs]        ┆ f64   ┆ str    │
╞═════════╪═════════════════════╪═══════╪════════╡
│ 1       ┆ 2022-01-01 00:00:00 ┆ 4.0   ┆ a      │
│ 2       ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b      │
│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   ┆ c      │
│ 4       ┆ 2022-01-04 00:00:00 ┆ 7.0   ┆ d      │
│ 5       ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e      │
└─────────┴─────────────────────┴───────┴────────┘
```

### **2.3.2** 하단 값으로 데이터 확인**(Tail)**

tail 함수는 데이터프레임의 마지막 5행을 가져옵니다. head와 마찬가지로 출력하고 싶은 행의 수를 지정할 수 있습니다.

```python
print(df.tail())
# print(df.tail(3))
# print(df.tail(-3))
```

- **tail(n)**: DataFrame의 마지막 n개의 행을 출력합니다. 음수 값이 전달되면 첫 번째 절댓값 n행을 제외한 모든 행을 반환합니다.

```python
shape: (5, 4)
┌─────────┬─────────────────────┬───────┬────────┐
│ integer ┆ date                ┆ float ┆ string │
│ ---     ┆ ---                 ┆ ---   ┆ ---    │
│ i64     ┆ datetime[μs]        ┆ f64   ┆ str    │
╞═════════╪═════════════════════╪═══════╪════════╡
│ 1       ┆ 2022-01-01 00:00:00 ┆ 4.0   ┆ a      │
│ 2       ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b      │
│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   ┆ c      │
│ 4       ┆ 2022-01-04 00:00:00 ┆ 7.0   ┆ d      │
│ 5       ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e      │
└─────────┴─────────────────────┴───────┴────────┘
```

### **2.3.3** 데이터 형태

shape, height, width 함수로 DataFrame의 크기(행/열 개수) 확인할 수 있습니다.

```python
print(df.shape)
```

```python
(5, 4)
```

```python
print(df.height) # 행 개수
```

```python
5
```

```python
print(df.width) # 열 개수
```

```python
4
```

### **2.3.4** 기술통계량(요약 통계)

`Describe` 함수는 시리즈 또는 데이터프레임의 각 열에 대한 기술통계량(요약 통계)를 반환합니다.

```python
print(df.describe())
```

```python
shape: (9, 5)
┌────────────┬──────────┬─────────────────────┬──────────┬────────┐
│ describe   ┆ integer  ┆ date                ┆ float    ┆ string │
│ ---        ┆ ---      ┆ ---                 ┆ ---      ┆ ---    │
│ str        ┆ f64      ┆ str                 ┆ f64      ┆ str    │
╞════════════╪══════════╪═════════════════════╪══════════╪════════╡
│ count      ┆ 5.0      ┆ 5                   ┆ 5.0      ┆ 5      │
│ null_count ┆ 0.0      ┆ 0                   ┆ 0.0      ┆ 0      │
│ mean       ┆ 3.0      ┆ null                ┆ 6.0      ┆ null   │
│ std        ┆ 1.581139 ┆ null                ┆ 1.581139 ┆ null   │
│ min        ┆ 1.0      ┆ 2022-01-01 00:00:00 ┆ 4.0      ┆ a      │
│ 25%        ┆ 2.0      ┆ null                ┆ 5.0      ┆ null   │
│ 50%        ┆ 3.0      ┆ null                ┆ 6.0      ┆ null   │
│ 75%        ┆ 4.0      ┆ null                ┆ 7.0      ┆ null   │
│ max        ┆ 5.0      ┆ 2022-01-05 00:00:00 ┆ 8.0      ┆ e      │
└────────────┴──────────┴─────────────────────┴──────────┴────────┘
```

## 2.4 DataFrame의 Column(컬럼, 열)

데이터프레임의 컬럼은 각 데이터의 속성을 나타냅니다. 각 칼럼을 선택하려면 `df[’컬럼 이름’]`을 이용하면 선택할 수 있습니다.

### 2.4.1 컬럼(열) 이름으로 조회

```python
# print(df[2]) -> Error
print(df['float'])
```

```python
shape: (5,)
Series: 'float' [f64]
[
	4.0
	5.0
	6.0
	7.0
	8.0
]
```

### 2.4.2 데이터 컬럼명 조회

컬럼명을 조회할 때에는 columns 메서드를 사용합니다.

```python
print(df.columns)
```

```python
['integer', 'date', 'float', 'string']
```

컬럼명을 변경하고 싶은 경우에는 아래 코드와 같이 df.columns에 리스트 형태로 값을 변경합니다.

```python
df.columns = ['id', 'date', 'score', 'grade']
print(df)
```

```python
shape: (5, 4)
┌─────┬─────────────────────┬───────┬───────┐
│ id  ┆ date                ┆ score ┆ grade │
│ --- ┆ ---                 ┆ ---   ┆ ---   │
│ i64 ┆ datetime[μs]        ┆ f64   ┆ str   │
╞═════╪═════════════════════╪═══════╪═══════╡
│ 1   ┆ 2022-01-01 00:00:00 ┆ 4.0   ┆ a     │
│ 2   ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b     │
│ 3   ┆ 2022-01-03 00:00:00 ┆ 6.0   ┆ c     │
│ 4   ┆ 2022-01-04 00:00:00 ┆ 7.0   ┆ d     │
│ 5   ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e     │
└─────┴─────────────────────┴───────┴───────┘
```

또는, rename으로 특정 컬럼명을 변경할 수 있습니다.

```python
df.rename({"id":"아이디"})
```

```python
shape: (5, 4)
아이디	date	score	grade
i64	datetime[μs]	f64	str
1	2022-01-01 00:00:00	4.0	"a"
2	2022-01-02 00:00:00	5.0	"b"
3	2022-01-03 00:00:00	6.0	"c"
4	2022-01-04 00:00:00	7.0	"d"
5	2022-01-05 00:00:00	8.0	"e"
```

```python
df.rename({"id":"아이디","date":"날짜"})
```

```python
shape: (5, 4)
아이디	날짜	score	grade
i64	datetime[μs]	f64	str
1	2022-01-01 00:00:00	4.0	"a"
2	2022-01-02 00:00:00	5.0	"b"
3	2022-01-03 00:00:00	6.0	"c"
4	2022-01-04 00:00:00	7.0	"d"
5	2022-01-05 00:00:00	8.0	"e"
```

### **2.4.3 샘플(Sample)**

sample을 사용하면 데이터프레임에서 임의의 n개의 행을 얻을 수 있습니다.

```python
print(df.sample(3))
```

```python
shape: (3, 4)
┌─────┬─────────────────────┬───────┬───────┐
│ id  ┆ date                ┆ score ┆ grade │
│ --- ┆ ---                 ┆ ---   ┆ ---   │
│ i64 ┆ datetime[μs]        ┆ f64   ┆ str   │
╞═════╪═════════════════════╪═══════╪═══════╡
│ 4   ┆ 2022-01-04 00:00:00 ┆ 7.0   ┆ d     │
│ 5   ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e     │
│ 3   ┆ 2022-01-03 00:00:00 ┆ 6.0   ┆ c     │
└─────┴─────────────────────┴───────┴───────┘
```

with_replacement를 True로 설정하면 값이 두 번이상 샘플링 되도록 설정할 수 있습니다.

```python
print(df.sample(3, with_replacement=True))
```

```python
shape: (3, 4)
┌─────┬─────────────────────┬───────┬───────┐
│ id  ┆ date                ┆ score ┆ grade │
│ --- ┆ ---                 ┆ ---   ┆ ---   │
│ i64 ┆ datetime[μs]        ┆ f64   ┆ str   │
╞═════╪═════════════════════╪═══════╪═══════╡
│ 2   ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b     │
│ 5   ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e     │
│ 2   ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b     │
└─────┴─────────────────────┴───────┴───────┘
```

shuffle를 True로 설정하면 샘플링된 행의 순서 상관없이 출력됩니다.

```python
print(df.sample(3, shuffle=True))
```

```python
shape: (3, 4)
┌─────┬─────────────────────┬───────┬───────┐
│ id  ┆ date                ┆ score ┆ grade │
│ --- ┆ ---                 ┆ ---   ┆ ---   │
│ i64 ┆ datetime[μs]        ┆ f64   ┆ str   │
╞═════╪═════════════════════╪═══════╪═══════╡
│ 1   ┆ 2022-01-01 00:00:00 ┆ 4.0   ┆ a     │
│ 5   ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e     │
│ 2   ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b     │
└─────┴─────────────────────┴───────┴───────┘
```

seed는 난수 생성기입니다. 없음(기본값)으로 설정하면 각 샘플 작업에 대해 무작위 seed가 생성됩니다.

```python
print(df.sample(3, seed=2))
```

```python
shape: (3, 4)
┌─────┬─────────────────────┬───────┬───────┐
│ id  ┆ date                ┆ score ┆ grade │
│ --- ┆ ---                 ┆ ---   ┆ ---   │
│ i64 ┆ datetime[μs]        ┆ f64   ┆ str   │
╞═════╪═════════════════════╪═══════╪═══════╡
│ 3   ┆ 2022-01-03 00:00:00 ┆ 6.0   ┆ c     │
│ 2   ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b     │
│ 5   ┆ 2022-01-05 00:00:00 ┆ 8.0   ┆ e     │
└─────┴─────────────────────┴───────┴───────┘
```

## 2.5 데이터 읽기, 생성

### 2.5.1 colab에서 데이터 생성

```python
%%writefile rawData.csv
사원번호,연차,입사연도,매출,순익
110,1,2015,1000000,100001
109,2,2016,2000000,200001
108,3,2017,3000000,300001
107,4,2018,4000000,400001
106,5,2019,8000000,800001
107,6,2020,16000000,1600001
```

### 2.5.2 데이터 읽기

CSV 파일 데이터를 읽어옵니다.

```python
pl.read_csv('rawData.csv')
```

![](/images/polars/chapter03/chapter03-2-1.png)

## 2.6 결측치 확인

```python
df_null = pl.DataFrame({
	  '이름': ['A', 'B', 'C'],
    '나이': [25, 35, 45],
    '성별': ['남', '여', None]
})

print(df_null)
```

```python
shape: (3, 3)
┌──────┬──────┬──────┐
│ 이름  ┆ 나이  ┆ 성별  │
│ ---  ┆ ---  ┆ ---  │
│ str  ┆ i64  ┆ str  │
╞══════╪══════╪══════╡
│ A    ┆ 25   ┆ 남   │
│ B    ┆ 35   ┆ 여   │
│ C    ┆ 45   ┆ null │
└──────┴──────┴──────┘
```

`null_count`는 열별로 null 값의 개수가 몇개 있는지 확인할 수 있습니다.

```python
df_null.null_count() # 결측값 개수 확인
```

```python
shape: (1, 3)
이름	나이	성별
u32	u32	u32
0	0	1
```

## 2.7 데이터 삭제

데이터프레임에서 값을 사용하는 방법은 여러 가지가 있습니다.

### 2.7.1 drop

`drop`는 데이터프레임에서 지정한 열(컬럼)을 삭제할 때 사용하는 함수입니다.

```python
df.drop('id')
```

`df.drop(’id’)`을 이용해 ‘id’ 열을 삭제합니다.

```python
shape: (5, 3)
date	score	grade
datetime[μs]	f64	str
2022-01-01 00:00:00	4.0	"a"
2022-01-02 00:00:00	5.0	"b"
2022-01-03 00:00:00	6.0	"c"
2022-01-04 00:00:00	7.0	"d"
2022-01-05 00:00:00	8.0	"e"
```

여러 컬럼명을 연달아 작성하여 전달하거나 리스트 형태로 전달하여 여러개의 컬럼을 삭제할 수 있습니다.

```python
df.drop('id','score')
# df.drop(['id','score'])
```

```python
shape: (5, 2)
date	grade
datetime[μs]	str
2022-01-01 00:00:00	"a"
2022-01-02 00:00:00	"b"
2022-01-03 00:00:00	"c"
2022-01-04 00:00:00	"d"
2022-01-05 00:00:00	"e"
```

폴라스 셀럭터를 사용하여 여러 컬럼을 삭제할 수 있습니다.

```python
import polars.selectors as cs

df.drop(cs.numeric())
```

셀럭터를 이용하여 숫자형 데이터를 삭제할 수 있습니다.

```python
shape: (5, 2)
date	grade
datetime[μs]	str
2022-01-01 00:00:00	"a"
2022-01-02 00:00:00	"b"
2022-01-03 00:00:00	"c"
2022-01-04 00:00:00	"d"
2022-01-05 00:00:00	"e"
```

### 2.6.2 drop_nulls

`drop_nulls`는 데이터프레임에서 결측값을 포함한 행을 삭제할 때 사용하는 함수입니다.

```python
df.drop_nulls()
```

```python
shape: (2, 3)
이름	나이	성별
str	i64	str
"A"	25	"남"
"B"	35	"여"
```

폴라스 셀렉터로 데이터 타입이 문자열인 열에 null이 있는 경우 행을 삭제할 수 있습니다.

```python
df_null.drop_nulls(subset=cs.string())
```

```python
shape: (2, 3)
이름	나이	성별
str	i64	str
"A"	25	"남"
"B"	35	"여"
```

---

```python
df_null2 = pl.DataFrame(
    {
        "a": [None, None, None, None],
        "b": [1, 2, None, 1],
        "c": [1, None, None, 1],
    }
)
print(df_null2)
```

```python
shape: (4, 3)
┌──────┬──────┬──────┐
│ a    ┆ b    ┆ c    │
│ ---  ┆ ---  ┆ ---  │
│ null ┆ i64  ┆ i64  │
╞══════╪══════╪══════╡
│ null ┆ 1    ┆ 1    │
│ null ┆ 2    ┆ null │
│ null ┆ null ┆ null │
│ null ┆ 1    ┆ 1    │
└──────┴──────┴──────┘
```

모든 값이 null인 경우에만 행을 삭제합니다.

```python
df_null2.filter(~pl.all_horizontal(pl.all().is_null()))
```

모든 값이 null인 경우 열을 삭제합니다.

```python
df_null2[[s.name for s in df_null2 if not (s.null_count() == df_null2.height)]]
```

---

## DataFrame의 Data(데이터)

데이터프레임의 데이터는 행과 열에 대한 값을 말합니다. 다양한 방법을 통해 데이터프레임의 값을 활용할 수 있습니다.

## slice 조회

slice는 데이터프레임 중 `인덱스 이름`을 가지고 데이터를 추출하는 방법입니다. `slice[row index, column index]`를 이용해서 값을 가져올 수 있습니다.

먼저, 행의 인덱스 값만 이용해서 데이터프레임의 데이터를 가져와보도록 하겠습니다.

```python
print(df.loc[0])
print(df.loc[0:2])
```

print(s4.shuffle(seed=1))

shape: (5,)
Series: 'a' [f64]
[
0.0
100.0
100.0
7.5
10.0
]
